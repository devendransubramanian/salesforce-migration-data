-- FUNCTION: public.get_child_articket_detail(character varying)

-- DROP FUNCTION IF EXISTS public.get_child_articket_detail(character varying);

CREATE OR REPLACE FUNCTION public.get_child_articket_detail(
	ticketid character varying)
    RETURNS TABLE(parentid bigint, id bigint, org_id integer, brand_id integer, org_brand_id integer, brand_name text, "Opportunity Name" text, is_visible_in_customer_portal boolean, requested_by bigint, requester text, assigned_to_user_id bigint, assignee text, "AR Rep" text, assigned_to_group_id integer, "group" text, contact_group_id bigint, contact_group text, resolution_due_on timestamp with time zone, ticket_status_id integer, status text, ticket_source_id integer, source text, update_count integer, note_count integer, attachment_count integer, work_log_count integer, total_time_logged integer, total_billable_time_logged integer, first_response_due_on timestamp with time zone, next_response_due_on timestamp with time zone, last_replied_on timestamp with time zone, last_replied_by_id bigint, last_replied_by text, last_replied_by_user_type_id integer, last_replied_by_user_type text, closed_on timestamp with time zone, closed_by bigint, closed_by_name text, created_on timestamp with time zone, created_by bigint, creator text, last_modified_on timestamp with time zone, last_modified_by bigint, "Last Modified By" text, is_spam boolean, is_active boolean, tsv tsvector, is_resolution_date_modified boolean, last_status_changed_on timestamp with time zone, is_first_response_updated boolean, ticket_type_option_id bigint, ticket_category_option_id bigint, ticket_priority_id integer, priority text, "Account Name" text, subject text, type text, category text, email character varying, "OpportunityOwner" text, time_spent bigint, unique_external_reference_id text, agentid bigint, notes text, isnotesprivate boolean, notetype text, assigned text, cf_amount numeric, cf_opp_dt_order_id character varying, cf_link_to_bold_order character varying, cf_expected_payment_date date, cf_group_car_rep character varying, cf_secondary_lead_source character varying, cf_contract_renewal_date date, cf_contract_renewal_amount numeric, cf_reinstate_reason text, cf_last_crr_rep_contact date, cf_country text, cf_date_reviewed date, cf_nonrenewal_reason text, cf_cleared_by_jv boolean, cf_order_sheet_status text, cf_case_number character varying, cf_downloaded_date timestamp without time zone, cf_key_order_issue text, cf_term_12_months boolean, cf_date_moved_to_not_renewing date, cf_adobe_sign_exp_date date, cf_next_cl_contact date, cf__of_years_in_next_payment_term numeric, cf__of_years_in_previous_payment_term numeric, cf_ap_processed_alliance_fee date, cf_days_to_pay_alliance_partner integer, cf_alliance_fee_tier text, cf_alliance_partner_order_status text, cf_biz_dev_reviewed date, cf_csr_returned_for_correction date, cf_dt_expiration_date timestamp without time zone, cf_original_license_type text, cf_opp_alliance_partner text, cf_return_details text, cf_original_closedwon_date timestamp without time zone, cf_current_subscription_term character varying, cf_last_customer_contact date, cf_opportunity_name character varying, cf_lead_source character varying, cf_next_ar_contact date, cf_opp_presale_contract_request boolean, cf_end_date date, cf_ren_audit_review text, cf_counsel_reviewed text, cf_flagged_by_mahas_team date, cf_submitted_for_approval timestamp without time zone, cf_order_reviewed_by character varying, cf_group_account_name character varying, cf_payment_frequency text, cf_submitted_to_counsel_review date, cf_2nd_contact_date timestamp without time zone, cf_case_type text, cf_return_notes character varying, cf_engagement_status text, cf_product text, cf_review_link character varying, cf_contract_license_ordered text, cf_ar_license_ordered text, cf_opp_has_problematic_pricing boolean, cf_renewal_amount_this_year numeric, cf_days_since_contact character varying, cf_my_call_list_est text, cf_order_sheet_name character varying, cf_date_signed_by_syncfusion timestamp without time zone, cf_invoice_due_date timestamp without time zone, cf_return_identified_by text, cf_contract_sent timestamp without time zone, cf_paralegal_contracts_to_returncancel timestamp without time zone, cf_total_contract_amount numeric, cf_order_sheet_incomplete timestamp without time zone, cf_salescr_action_needed timestamp without time zone, cf_link_to_return_opportunity character varying, cf_company character varying, cf_opportunity_category character varying, cf_product_or_plan text, cf_revenue_type text, cf_call_country text, cf_last_renewal_order_id character varying, cf_demo_scheduled timestamp without time zone, cf_reason_lost_comments character varying, cf_opportunity_source character varying, cf_download_country character varying, cf_reason_lost text, cf_alliance_partner_status text, cf_customerid character varying, cf_no_of_order_sheets_in_opp character varying, cf_previous_dt_order_amount numeric, cf_manager_at_time_of_sale character varying, cf_department character varying, cf_known_company_url character varying, cf_secondary_ap_contact character varying, cf_is_invoice_collectible text, cf_problematic_pricing_acct timestamp without time zone, cf_tier_1_country_code character varying, cf_renewal_status text, cf_renewal_confirmation text, cf_contract_reviewed text, cf_reason_returned text, cf_resolution text, cf_po_obtained_legal timestamp without time zone, cf_contact_lead_source character varying, cf_salescrr_issue_resolved timestamp without time zone, cf_primary_ap_contact character varying, cf_visual_compliance_run_by text, cf_crr_rep text, cf_crr_corrections_required character varying, cf_returnrebook boolean, cf_payment_confirmation_attached text, cf_tier_1_country_name character varying, cf_1st_contact_date timestamp without time zone, cf_email character varying, cf_submitted_for_processing timestamp without time zone, cf_rejected_to_rep timestamp without time zone, cf_returned_for_corrections timestamp without time zone, cf_order_sheet_processed timestamp without time zone, cf_record_type text, cf_upgrade_dollar_amount numeric, cf_total_sale_amount numeric, cf_month_one_amount numeric, cf_month_two_amount numeric, cf_month_three_amount numeric, cf_month_four_amount numeric, cf_month_five_amount numeric, cf_month_six_amount numeric, cf_month_seven_amount numeric, cf_month_eight_amount numeric, cf_month_nine_amount numeric, cf_month_ten_amount numeric, cf_month_eleven_amount numeric, cf_month_twelve_amount numeric, cf_fee_to_alliance_partner numeric, cf_contract_status text, cf_3rd_contact_date timestamp without time zone, cf_payment_method text, cf_bold_commissionable_amount numeric, cf_customer_invoice_details text, cf_stripe_order boolean, cf_year_one_contract_amount numeric, cf_case_resolution text, cf_sales_admin_correction_requested character varying, cf_date_agreement_effective timestamp without time zone, cf_date_agreement_expires date, cf_date_sent_to_customer timestamp without time zone, cf_date_estimate_sent_to_customer timestamp without time zone, cf_date_signed_by_customer timestamp without time zone, cf_case_car_rep character varying, cf_crr_split_amount numeric, cf_follow_up_date timestamp without time zone, cf_outstanding_amount numeric, cf_amount_collected_by_legal numeric, cf_payment_outcome text, cf_invoice_sent timestamp without time zone, cf_contract_complete_or_closed timestamp without time zone, cf_reason_for_no_contract character varying, cf_payment_obtained_legal timestamp without time zone, cf_review_site text, cf_order_info_needed integer[], cf_collection_legal_status text, cf_last_collections_contact timestamp without time zone, cf_total_invoice_amount numeric, cf_salescr_action_type text, cf_case_description character varying, cf_date_sent_to_jv timestamp without time zone, cf_date_fully_executed timestamp without time zone, cf_90_days_support timestamp without time zone, cf_weekly_call_day text, cf_last_ar_contact timestamp without time zone, cf_related_opp_account_name character varying, cf_related_opp_close_date timestamp without time zone, cf_on_hold_details character varying, cf_responsible_for_inv text, cf_due_date timestamp without time zone, cf_status text, cf_dt_order_id character varying, cf_salescrr_invoice_issue timestamp without time zone, cf_days_suppport_remaining character varying, cf_alliance_partner character varying, cf_manager character varying, cf_visual_compliance_run timestamp without time zone, cf_syncfusion_sales_rep character varying, cf_absolute_revenue character varying, cf_car_rep text, cf_next_contact_date timestamp without time zone, cf_opportunity_amount numeric, cf_task_subtype text, cf_day_log text, cf_time_activity_logged timestamp without time zone, cf_call_type text, cf_call_result character varying, cf_license_ordered text, cf_presale_contract_request timestamp without time zone, cf_assigned_to character varying, cf_ar_status text, cf_date_sent_to_legal timestamp without time zone, cf_order_entered date, cf_verified_return_in_dt boolean, cf_confirmed_order_csr date, cf_date_order_closed_paidret timestamp without time zone, cf_discount numeric, cf_email_subject character varying, cf_salescrr_issue_type text, cf_sales_rep_split_amount character varying, cf_cg_billing_postal_code character varying, cf_cg_known_company_url character varying, cf_problematic_pricing_opps boolean, cf_cg_billing_street character varying, cf_cg_billing_city character varying, cf_contact_license_type text, cf_group_billing_country character varying, cf_order_entered_by text, cf_reason_for_owner_change integer, cf_acct_has_problematic_pricing timestamp without time zone, cf_opp_acct_has_problematic_pricing timestamp without time zone, cf_channel text, cf_csr_confirmed_alliance_order timestamp without time zone, cf_submitted_for_bd_review timestamp without time zone, contactname character varying, "Invoice Age" double precision, stage text, "Amount After Discount" numeric, "Days To Expiration" double precision, "Days To Payment" double precision, "Days To Payment 2" double precision, "Days To Invoice Payment" double precision, "Days not renewing to closed" double precision, "Sales Admin Review Days" double precision, "Close Date to Processed" double precision, "Days to Process" double precision, "Close to Final CRRB Checks" double precision, "Close vs. Exp date" double precision, "Days Since Close Date" double precision, "Days Open" double precision, "Absolute Close Won Date" timestamp with time zone, "Upgrade Amount" numeric, "When was Alliance Partner Paid" text, "Opportunity Age" double precision, "Bold Team" text, "Collections or AR?" text, "Call time" text, "Follow Up Type" text, "Contract Result" text, "Eligible for Contract" text, "Contract" text, "CRRB Processing Time" text, "Days To Final CRRB Check" text, "Days to Process(str)" text, "Invoice Age(Str)" text, "Close to payment" text, "Eligible Date to Close" date, "DT Order Link" text, "Tier 1 Region" integer, "Adjusted Projected REN" numeric, "Percent Invoice Paid" numeric, "Days to Submit Order" double precision, "Days to Submit Order_bucket" text, "Annualized Revenue" double precision, "Closed By Expiration" text, "Link to Next REN Opportunity" character varying, "Link to Old REN Opportunity" character varying, cf_ren_contract_notes character varying, cf_collections_legal_notes character varying, cf_ar_notes character varying, cf_contract_retrieval_notes character varying, cf_comments character varying, cf_order_evaluation_notes character varying, cf_counsel_order_notes character varying, cf_notes_from_sales_leadership character varying, cf_notes_to_ar_manager character varying, cf_po_notes_legal character varying, cf_collections_correspondence character varying, cf_admin_internal_notes character varying, cf_paralegal_notes character varying, cf_rep_notes character varying, "Opportunity Owner Designation" character varying, "Opportunity Owner Role" character varying, "Opportunity Owner Department" character varying, "Opportunity Owner Workstation" character varying, "Opportunity Owner Division" character varying, "Opportunity Owner : Active" character varying, "Opportunity Owner : Manager" text, isreportingpersonasmaanager integer, "Opportunity Owner : Reporting Person" text, "User End Date" timestamp without time zone, "Opportunity Owner IsActive" boolean, "Car_Rep_Contact" character varying, "sales/cr-notes-with-legal" character varying, "Counsel-Notes" character varying, "Closed-Lost-Qualification-Notes" character varying, "SE-Notes" character varying, "CR-Notes" character varying, "Sales-Leadership-Notes" character varying, "About-This-Opportunity" character varying, "contract-notes" character varying, "project-notes" character varying, "case-comments" character varying, "project-name-cst" character varying) 
    LANGUAGE 'plpgsql'
    COST 100
    VOLATILE PARALLEL UNSAFE
    ROWS 1000

AS $BODY$

begin
	return query 

SELECT ticket_detail.parentid,ticket_detail.id,
    tnotes.org_id,
    tnotes.brand_id,
    tnotes.org_brand_id,
    tnotes.brand_name,
    tnotes."Opportunity Name",
    tnotes.is_visible_in_customer_portal,
    tnotes.requested_by,
    tnotes.requester,
    tnotes.assigned_to_user_id,
    tnotes.assignee,
    tnotes."AR Rep",
    tnotes.assigned_to_group_id,
    tnotes."group",
    tnotes.contact_group_id,
    tnotes.contact_group,
    tnotes.resolution_due_on,
    tnotes.ticket_status_id,
    tnotes.status,
    tnotes.ticket_source_id,
    tnotes.source,
    tnotes.update_count,
    tnotes.note_count,
    tnotes.attachment_count,
    tnotes.work_log_count,
    tnotes.total_time_logged,
    tnotes.total_billable_time_logged,
    tnotes.first_response_due_on,
    tnotes.next_response_due_on,
    tnotes.last_replied_on,
    tnotes.last_replied_by_id,
    tnotes.last_replied_by,
    tnotes.last_replied_by_user_type_id,
    tnotes.last_replied_by_user_type,
    tnotes.closed_on,
    tnotes.closed_by,
    tnotes.closed_by_name,
    tnotes.created_on,
    tnotes.created_by,
    tnotes.creator,
    tnotes.last_modified_on,
    tnotes.last_modified_by,
    tnotes."Last Modified By",
    tnotes.is_spam,
    tnotes.is_active,
    tnotes.tsv,
    tnotes.is_resolution_date_modified,
    tnotes.last_status_changed_on,
    tnotes.is_first_response_updated,
    tnotes.ticket_type_option_id,
    tnotes.ticket_category_option_id,
    tnotes.ticket_priority_id,
    tnotes.priority,
    tnotes."Account Name",
    tnotes.subject,
    tnotes.type,
    tnotes.category,
    tnotes.email,
    tnotes."OpportunityOwner",
    tnotes.time_spent,
    tnotes.unique_external_reference_id,
    tnotes.agentid,
    tnotes.notes::text,
    tnotes.isnotesprivate,
    tnotes.notetype,
    tnotes.assigned,
    tnotes.cf_amount,
    tnotes.cf_opp_dt_order_id,
    tnotes.cf_link_to_bold_order,
    tnotes.cf_expected_payment_date,
    tnotes.cf_group_car_rep,
    tnotes.cf_secondary_lead_source,
    tnotes.cf_contract_renewal_date,
    tnotes.cf_contract_renewal_amount,
    tnotes.cf_reinstate_reason,
    tnotes.cf_last_crr_rep_contact,
    tnotes.cf_country,
    tnotes.cf_date_reviewed,
    tnotes.cf_nonrenewal_reason,
    tnotes.cf_cleared_by_jv,
    tnotes.cf_order_sheet_status,
    tnotes.cf_case_number,
    tnotes.cf_downloaded_date,
    tnotes.cf_key_order_issue,
    tnotes.cf_term_12_months,
    tnotes.cf_date_moved_to_not_renewing,
    tnotes.cf_adobe_sign_exp_date,
    tnotes.cf_next_cl_contact,
    tnotes.cf__of_years_in_next_payment_term,
    tnotes.cf__of_years_in_previous_payment_term,
    tnotes.cf_ap_processed_alliance_fee,
    tnotes.cf_days_to_pay_alliance_partner,
    tnotes.cf_alliance_fee_tier,
    tnotes.cf_alliance_partner_order_status,
    tnotes.cf_biz_dev_reviewed,
    tnotes.cf_csr_returned_for_correction,
    tnotes.cf_dt_expiration_date,
    tnotes.cf_original_license_type,
    tnotes.cf_opp_alliance_partner,
    tnotes.cf_return_details,
    tnotes.cf_original_closedwon_date,
    tnotes.cf_current_subscription_term,
    tnotes.cf_last_customer_contact,
    tnotes.cf_opportunity_name,
    tnotes.cf_lead_source,
    tnotes.cf_next_ar_contact,
    tnotes.cf_opp_presale_contract_request,
    tnotes.cf_end_date,
    tnotes.cf_ren_audit_review,
    tnotes.cf_counsel_reviewed,
    tnotes.cf_flagged_by_mahas_team,
    tnotes.cf_submitted_for_approval,
    tnotes.cf_order_reviewed_by,
    tnotes.cf_group_account_name,
    tnotes.cf_payment_frequency,
    tnotes.cf_submitted_to_counsel_review,
    tnotes.cf_2nd_contact_date,
    tnotes.cf_case_type,
    tnotes.cf_return_notes,
    tnotes.cf_engagement_status,
    tnotes.cf_product,
    tnotes.cf_review_link,
    tnotes.cf_contract_license_ordered,
    tnotes.cf_ar_license_ordered,
    tnotes.cf_opp_has_problematic_pricing,
    tnotes.cf_renewal_amount_this_year,
    tnotes.cf_days_since_contact,
    tnotes.cf_my_call_list_est,
    tnotes.cf_order_sheet_name,
    tnotes.cf_date_signed_by_syncfusion,
    tnotes.cf_invoice_due_date,
    tnotes.cf_return_identified_by,
    tnotes.cf_contract_sent,
    tnotes.cf_paralegal_contracts_to_returncancel,
    tnotes.cf_total_contract_amount,
    tnotes.cf_order_sheet_incomplete,
    tnotes.cf_salescr_action_needed,
    tnotes.cf_link_to_return_opportunity,
    tnotes.cf_company,
    tnotes.cf_opportunity_category,
    tnotes.cf_product_or_plan,
    tnotes.cf_revenue_type,
    tnotes.cf_call_country,
    tnotes.cf_last_renewal_order_id,
    tnotes.cf_demo_scheduled,
    tnotes.cf_reason_lost_comments,
    tnotes.cf_opportunity_source,
    tnotes.cf_download_country,
    tnotes.cf_reason_lost,
    tnotes.cf_alliance_partner_status,
    tnotes.cf_customerid,
    tnotes.cf_no_of_order_sheets_in_opp,
    tnotes.cf_previous_dt_order_amount,
    tnotes.cf_manager_at_time_of_sale,
    tnotes.cf_department,
    tnotes.cf_known_company_url,
    tnotes.cf_secondary_ap_contact,
    tnotes.cf_is_invoice_collectible,
    tnotes.cf_problematic_pricing_acct,
    tnotes.cf_tier_1_country_code,
    tnotes.cf_renewal_status,
    tnotes.cf_renewal_confirmation,
    tnotes.cf_contract_reviewed,
    tnotes.cf_reason_returned,
    tnotes.cf_resolution,
    tnotes.cf_po_obtained_legal,
    tnotes.cf_contact_lead_source,
    tnotes.cf_salescrr_issue_resolved,
    tnotes.cf_primary_ap_contact,
    tnotes.cf_visual_compliance_run_by,
    tnotes.cf_crr_rep,
    tnotes.cf_crr_corrections_required,
    tnotes.cf_returnrebook,
    tnotes.cf_payment_confirmation_attached,
    tnotes.cf_tier_1_country_name,
    tnotes.cf_1st_contact_date,
    tnotes.cf_email,
    tnotes.cf_submitted_for_processing,
    tnotes.cf_rejected_to_rep,
    tnotes.cf_returned_for_corrections,
    tnotes.cf_order_sheet_processed,
    tnotes.cf_record_type,
    tnotes.cf_upgrade_dollar_amount,
    tnotes.cf_total_sale_amount,
    tnotes.cf_month_one_amount,
    tnotes.cf_month_two_amount,
    tnotes.cf_month_three_amount,
    tnotes.cf_month_four_amount,
    tnotes.cf_month_five_amount,
    tnotes.cf_month_six_amount,
    tnotes.cf_month_seven_amount,
    tnotes.cf_month_eight_amount,
    tnotes.cf_month_nine_amount,
    tnotes.cf_month_ten_amount,
    tnotes.cf_month_eleven_amount,
    tnotes.cf_month_twelve_amount,
    tnotes.cf_fee_to_alliance_partner,
    tnotes.cf_contract_status,
    tnotes.cf_3rd_contact_date,
    tnotes.cf_payment_method,
    tnotes.cf_bold_commissionable_amount,
    tnotes.cf_customer_invoice_details,
    tnotes.cf_stripe_order,
    tnotes.cf_year_one_contract_amount,
    tnotes.cf_case_resolution,
    tnotes.cf_sales_admin_correction_requested,
    tnotes.cf_date_agreement_effective,
    tnotes.cf_date_agreement_expires,
    tnotes.cf_date_sent_to_customer,
    tnotes.cf_date_estimate_sent_to_customer,
    tnotes.cf_date_signed_by_customer,
    tnotes.cf_case_car_rep,
    tnotes.cf_crr_split_amount,
    tnotes.cf_follow_up_date,
    tnotes.cf_outstanding_amount,
    tnotes.cf_amount_collected_by_legal,
    tnotes.cf_payment_outcome,
    tnotes.cf_invoice_sent,
    tnotes.cf_contract_complete_or_closed,
    tnotes.cf_reason_for_no_contract,
    tnotes.cf_payment_obtained_legal,
    tnotes.cf_review_site,
    tnotes.cf_order_info_needed,
    tnotes.cf_collection_legal_status,
    tnotes.cf_last_collections_contact,
    tnotes.cf_total_invoice_amount,
    tnotes.cf_salescr_action_type,
    tnotes.cf_case_description,
    tnotes.cf_date_sent_to_jv,
    tnotes.cf_date_fully_executed,
    tnotes.cf_90_days_support,
    tnotes.cf_weekly_call_day,
    tnotes.cf_last_ar_contact,
    tnotes.cf_related_opp_account_name,
    tnotes.cf_related_opp_close_date,
    tnotes.cf_on_hold_details,
    tnotes.cf_responsible_for_inv,
    tnotes.cf_due_date,
    tnotes.cf_status,
    tnotes.cf_dt_order_id,
    tnotes.cf_salescrr_invoice_issue,
    tnotes.cf_days_suppport_remaining,
    tnotes.cf_alliance_partner,
    tnotes.cf_manager,
    tnotes.cf_visual_compliance_run,
    tnotes.cf_syncfusion_sales_rep,
    tnotes.cf_absolute_revenue,
    tnotes.cf_car_rep,
    tnotes.cf_next_contact_date,
    tnotes.cf_opportunity_amount,
    tnotes.cf_task_subtype,
    tnotes.cf_day_log,
    tnotes.cf_time_activity_logged,
    tnotes.cf_call_type,
    tnotes.cf_call_result,
    tnotes.cf_license_ordered,
    tnotes.cf_presale_contract_request,
    tnotes.cf_assigned_to,
    tnotes.cf_ar_status,
    tnotes.cf_date_sent_to_legal,
    tnotes.cf_order_entered,
    tnotes.cf_verified_return_in_dt,
    tnotes.cf_confirmed_order_csr,
    tnotes.cf_date_order_closed_paidret,
    tnotes.cf_discount,
    tnotes.cf_email_subject,
    tnotes.cf_salescrr_issue_type,
    tnotes.cf_sales_rep_split_amount,
    tnotes.cf_cg_billing_postal_code,
    tnotes.cf_cg_known_company_url,
    tnotes.cf_problematic_pricing_opps,
    tnotes.cf_cg_billing_street,
    tnotes.cf_cg_billing_city,
    tnotes.cf_contact_license_type,
    tnotes.cf_group_billing_country,
    tnotes.cf_order_entered_by,
    tnotes.cf_reason_for_owner_change,
    tnotes.cf_acct_has_problematic_pricing,
    tnotes.cf_opp_acct_has_problematic_pricing,
    tnotes.cf_channel,
    tnotes.cf_csr_confirmed_alliance_order,
    tnotes.cf_submitted_for_bd_review,
    tnotes.contactname,
    tnotes."Invoice Age",
    tnotes.stage,
    tnotes."Amount After Discount",
    tnotes."Days To Expiration",
    tnotes."Days To Payment",
    tnotes."Days To Payment 2",
    tnotes."Days To Invoice Payment",
    tnotes."Days not renewing to closed",
    tnotes."Sales Admin Review Days",
    tnotes."Close Date to Processed",
    tnotes."Days to Process",
    tnotes."Close to Final CRRB Checks",
    tnotes."Close vs. Exp date",
    tnotes."Days Since Close Date",
    tnotes."Days Open",
    tnotes."Absolute Close Won Date",
    tnotes."Upgrade Amount",
    tnotes."When was Alliance Partner Paid",
    tnotes."Opportunity Age",
    tnotes."Bold Team",
    tnotes."Collections or AR?",
    tnotes."Call time",
    tnotes."Follow Up Type",
    tnotes."Contract Result",
    tnotes."Eligible for Contract",
    tnotes."Contract",
    tnotes."CRRB Processing Time",
    tnotes."Days To Final CRRB Check",
    tnotes."Days to Process(str)",
    tnotes."Invoice Age(Str)",
    tnotes."Close to payment",
    tnotes."Eligible Date to Close",
    tnotes."DT Order Link",
    tnotes."Tier 1 Region",
    tnotes."Adjusted Projected REN",
    tnotes."Percent Invoice Paid",
    tnotes."Days to Submit Order",
    tnotes."Days to Submit Order_bucket",
    tnotes."Annualized Revenue",
    tnotes."Closed By Expiration",
   tnotes."Link to Next REN Opportunity",
   tnotes."Link to Old REN Opportunity",
     tnotes.cf_ren_contract_notes,
    tnotes.cf_collections_legal_notes,
    tnotes.cf_ar_notes,
    tnotes.cf_contract_retrieval_notes,
    tnotes.cf_comments,
    tnotes.cf_order_evaluation_notes,
    tnotes.cf_counsel_order_notes,
    tnotes.cf_notes_from_sales_leadership,
    tnotes.cf_notes_to_ar_manager,
    tnotes.cf_po_notes_legal,
    tnotes.cf_collections_correspondence,
    tnotes.cf_admin_internal_notes,
    tnotes.cf_paralegal_notes,
    tnotes.cf_rep_notes,
		tnotes."Opportunity Owner Designation",
		tnotes."Opportunity Owner Role", 
		tnotes."Opportunity Owner Department",
		tnotes."Opportunity Owner Workstation",
		tnotes."Opportunity Owner Division",
		tnotes."Opportunity Owner : Active",
		tnotes."Opportunity Owner : Manager", 
		0 as isreportingpersonasmaanager, 
		tnotes."Opportunity Owner : Reporting Person",
		tnotes."User End Date", 
		tnotes."Opportunity Owner IsActive",
		tnotes."Car_Rep_Contact",
		tnotes."sales/cr-notes-with-legal",
	tnotes."Counsel-Notes",
	tnotes."Closed-Lost-Qualification-Notes" ,
	tnotes."SE-Notes",
	tnotes."CR-Notes",
	tnotes."Sales-Leadership-Notes",
	tnotes."About-This-Opportunity",
	tnotes."contract-notes",
	tnotes."project-notes",
	tnotes."case-comments",
	
	tnotes."project-name-cst"
   FROM dblink('host=35.236.243.204 port=5432 user=salesopreaduser password=b9c!l9M4#zQ dbname=org-538'::text, 
			   format('SELECT td.id as parentid, t.id
 
 FROM (select * from ticket_detail where  ticket_category_option_id in (4) and id in ( %s ) and is_active=true) td
    LEFT JOIN ticket_link tl ON tl.source_ticket_id = td.id  
     LEFT JOIN ticket_detail t ON t.id = tl.destination_ticket_id and t.ticket_category_option_id in (1568)	
     LEFT JOIN brand b ON b.org_brand_id = t.org_brand_id
     LEFT JOIN ticket_status tst ON tst.id = t.ticket_status_id
     LEFT JOIN ticket_source tso ON tso.id = t.ticket_source_id
     LEFT JOIN users requester ON requester.id = t.requested_by
     LEFT JOIN users replied ON replied.id = t.last_replied_by_id
     LEFT JOIN user_type rut ON rut.id = t.last_replied_by_user_type_id
     LEFT JOIN users creator ON creator.id = t.created_by
     LEFT JOIN users modifier ON modifier.id = t.last_modified_by
     LEFT JOIN ticket_priority tp ON tp.id = t.ticket_priority_id
     LEFT JOIN users assignee ON assignee.id = t.assigned_to_user_id
     LEFT JOIN user_group aug ON aug.id = t.assigned_to_group_id
     LEFT JOIN contact_group cg ON cg.id = t.contact_group_id
     LEFT JOIN users closed ON closed.id = t.closed_by
     LEFT JOIN agent ON t.assigned_to_user_id = agent.user_id
	 LEFt JOIN users owner on agent.user_id = owner.id and owner.user_type_id = 2
   LEFT JOIN (select ticket_id,SUM(time_spent) as time_spent from ticket_time_log group by ticket_id) timelog ON timelog.ticket_id = t.id 
 LEFT JOIN ticket_update tu ON tu.ticket_id = t.id AND tu.is_first_update = true
     LEFT JOIN ticket_update_type tut ON tut.id = tu.ticket_update_type_id,
     jsonb_to_record(t.custom_fields) fields("1001" numeric(36,6), "1522" character varying, "1489" character varying, "1490" date, "1336" character varying, "1540" character varying, "1491" date, "1492" numeric(36,6), "1493" bigint, "1494" date, "1092" bigint,  "1497" date, "1103" character varying, "1063" bigint, "1498" boolean, "1141" bigint, "1503" character varying, "1093" timestamp without time zone, "1499" bigint, "1500" boolean, "1495" date,  "1596" date, "1504" date, "1618" int, "1619" int,   "1510" date, "1623" int, "1512" bigint, "1513" bigint, "1514" date, "1515" date, "1044" character varying, "1066" timestamp without time zone, "1052" bigint, "1453" bigint, "1299" bigint, "1301" timestamp without time zone, "1501" character varying,  "1507" date, "1125" character varying, "1366" character varying, "1508" date,  "1516" boolean, "1517" date, "1519" bigint, "1520" bigint, "1521" date, "1151" timestamp without time zone,  "1496" integer[], "1373" character varying, "1226" bigint, "1509" date, "1384" timestamp without time zone, "1248" bigint, "1300" character varying, "1277" character varying, "1388" bigint, "1593" int[], "1400" character varying, "1142" timestamp without time zone, "1370" bigint, "1372" bigint, "1042" character varying, "1480" boolean, "1479" numeric(36,6), "1483" character varying, "1009" bigint, "1485" character varying, "1259" timestamp without time zone, "1326" timestamp without time zone, "1102" bigint, "1310" bigint, "1344" timestamp without time zone, "1347" timestamp without time zone, "1343" numeric(36,6), "1330" timestamp without time zone, "1338" timestamp without time zone,  "1010" character varying, "1139" character varying, "1542" character varying, "1111" bigint, "1005" bigint, "1094" bigint, "1544" character varying, "1404" timestamp without time zone, "1095" integer[], "1118" character varying, "1108" character varying, "1543" character varying, "1008" bigint, "1025" bigint, "1049" character varying, "1043" character varying, "1069" bigint, "1380" character varying, "1622" character varying, "1068" numeric(36,6), "1332" character varying, "1018" character varying, "1020" character varying, "1294" character varying, "1011" character varying, "1315" character varying, "1318" bigint, "1065" timestamp without time zone, "1047" character varying, "1050" bigint, "1060" bigint, "1051" bigint, "1296" bigint, "1021" bigint, "1320" timestamp without time zone, "1351" character varying, "1313" timestamp without time zone, "1314" character varying, "1054" character varying, "1121" timestamp without time zone, "1123" character varying, "1144" bigint, "1145" bigint, "1146" character varying, "1147" boolean, "1149" bigint, "1048" character varying, "1382" timestamp without time zone, "1137" character varying, "1169" character varying, "1170" bigint, "1153" timestamp without time zone, "1155" timestamp without time zone, "1156" timestamp without time zone, "1160" timestamp without time zone, "1046" bigint, "1179" numeric(36,6), "1180" numeric(36,6), "1174" numeric(36,6), "1177" numeric(36,6), "1337" bigint, "1385" timestamp without time zone, "1227" bigint, "1165" integer[], "1240" numeric(36,6), "1232" bigint, "1233" boolean, "1243" character varying, "1342" numeric(36,6), "1247" bigint, "1241" character varying, "1238" integer[], "1249" timestamp without time zone, "1254" date, "1255" timestamp without time zone, "1256" timestamp without time zone, "1257" timestamp without time zone, "1250" character varying, "1167" numeric(36,6), "1262" timestamp without time zone, "1328" numeric(36,6), "1322" numeric(36,6), "1323" bigint, "1316" timestamp without time zone, "1345" timestamp without time zone, "1546" character varying, "1321" timestamp without time zone, "1399" bigint, "1334" integer[], "1317" bigint, "1319" timestamp without time zone, "1327" numeric(36,6), "1340" bigint, "1263" character varying, "1260" timestamp without time zone, "1261" timestamp without time zone, "1268" timestamp without time zone, "1279" bigint, "1291" character varying, "1285" bigint, "1286" bigint, "1287" character varying, "1288" timestamp without time zone, "1308" timestamp without time zone, "1581" character varying, "1281" timestamp without time zone, "1283" character varying, "1309" bigint, "1430" timestamp without time zone, "1245" bigint,  "1307" character varying, "1350" character varying, "1311" timestamp without time zone, "1625" decimal(36,6), "1362" character varying, "1355" character varying, "1352" timestamp without time zone, "1365" character varying, "1367" numeric(36,6), "1354" character varying, "1335" character varying, "1394" timestamp without time zone, "1427" numeric(36,6), "1432" bigint, "1434" bigint, "1435" timestamp without time zone, "1436" bigint, "1588" character varying, "1371" bigint, "1418" timestamp without time zone, "1589" character varying, "1449" bigint, "1454" timestamp without time zone, "1459" date, "1460" boolean, "1461" date, "1462" timestamp without time zone, "1440" numeric(36,6), "1487" character varying, "1312" bigint, "1602" decimal(36,6), "1518" bigint,"1006" int,"1178" numeric(36,6), "1182" numeric(36,6), "1186" numeric(36,6), "1190" numeric(36,6), "1192" numeric(36,6), "1195" numeric(36,6), "1198" numeric(36,6), "1204" numeric(36,6), "1206" numeric(36,6), "1207" numeric(36,6), "1210" numeric(36,6),"1535" timestamp without time zone, "1536" timestamp without time zone,"1452" bigint,"1591" timestamp , "1592" timestamp,"11" varchar,"1626" varchar)
	  LEFT Join users carrep on carrep.email=fields."1335",
     jsonb_to_record(cg.custom_fields) contactgroup("1083" character varying, "1044" character varying, "1058" boolean, "1079" character varying, "1080" character varying, "1170" bigint, "1291" character varying)
			  
			   ',ticketid)) as ticket_detail(parentid bigint,id bigint)
     LEFT JOIN ticket_detail tnotes ON tnotes.id = ticket_detail.id
  
where ticket_detail.id>0 ;
	end;

$BODY$;

ALTER FUNCTION public.get_child_articket_detail(character varying)
    OWNER TO bolddeskuser;
