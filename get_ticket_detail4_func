-- FUNCTION: public.get_ticket_detail4(character varying)

-- DROP FUNCTION IF EXISTS public.get_ticket_detail4(character varying);

CREATE OR REPLACE FUNCTION public.get_ticket_detail4(
	ticketid character varying)
    RETURNS TABLE(id bigint, cf_responsible_for_inv text, cf_due_date timestamp without time zone, cf_status text, cf_dt_order_id character varying, cf_salescrr_invoice_issue timestamp without time zone, cf_days_suppport_remaining numeric, cf_alliance_partner character varying, cf_manager character varying, cf_visual_compliance_run timestamp without time zone, cf_syncfusion_sales_rep character varying, cf_absolute_revenue character varying, cf_car_rep text, cf_next_contact_date timestamp without time zone, cf_opportunity_amount numeric, cf_task_subtype text, cf_day_log text, cf_time_activity_logged timestamp without time zone, cf_call_type text, cf_call_result character varying, cf_license_ordered text, cf_presale_contract_request timestamp without time zone, cf_assigned_to character varying, cf_ar_status text, cf_date_sent_to_legal timestamp without time zone, cf_order_entered date, cf_verified_return_in_dt boolean, cf_confirmed_order_csr date, cf_date_order_closed_paidret timestamp without time zone, cf_discount numeric, cf_email_subject character varying, cf_salescrr_issue_type text, cf_sales_rep_split_amount character varying, cf_cg_billing_postal_code character varying, cf_cg_known_company_url character varying, cf_problematic_pricing_opps boolean, cf_cg_billing_street character varying, cf_cg_billing_city character varying, cf_contact_license_type text, cf_group_billing_country character varying, cf_order_entered_by text, cf_reason_for_owner_change integer, cf_acct_has_problematic_pricing timestamp without time zone, cf_opp_acct_has_problematic_pricing timestamp without time zone, cf_channel text, cf_csr_confirmed_alliance_order timestamp without time zone, cf_submitted_for_bd_review timestamp without time zone, contactname character varying, "Invoice Age" double precision, stage text, "Amount After Discount" numeric, "Days To Expiration" double precision, "Days To Payment" double precision, "Days To Payment 2" double precision, "Days To Invoice Payment" double precision, "Days not renewing to closed" double precision, "Sales Admin Review Days" double precision, "Close Date to Processed" double precision, "Days to Process" double precision, "Close to Final CRRB Checks" double precision, "Close vs. Exp date" double precision, "Days Since Close Date" double precision, "Days Open" double precision, "Absolute Close Won Date" timestamp with time zone, "Upgrade Amount" numeric, "When was Alliance Partner Paid" text, "Opportunity Age" double precision, "Bold Team" text, "Collections or AR?" text, "Call time" text, "Follow Up Type" text, "Contract Result" text, "Eligible for Contract" text, "Contract" text, "CRRB Processing Time" text, "Days To Final CRRB Check" text, "Days to Process(str)" text, "Invoice Age(Str)" text, "Close to payment" text, "Eligible Date to Close" date, "DT Order Link" text, "Tier 1 Region" integer, "Adjusted Projected REN" numeric, "Percent Invoice Paid" numeric, "Days to Submit Order" double precision, "Days to Submit Order_bucket" text, "Annualized Revenue" double precision, "Closed By Expiration" text, "Link to Next REN Opportunity" character varying, "Link to Old REN Opportunity" character varying) 
    LANGUAGE 'plpgsql'
    COST 100
    VOLATILE PARALLEL UNSAFE
    ROWS 1000

AS $BODY$

begin

	return query 
SELECT ticket_detail.id,

    ticket_detail.cf_responsible_for_inv,
    ticket_detail.cf_due_date,
    ticket_detail.cf_status,
    ticket_detail.cf_dt_order_id,
    ticket_detail.cf_salescrr_invoice_issue,
    ticket_detail.cf_days_suppport_remaining,
    ticket_detail.cf_alliance_partner,
    ticket_detail.cf_manager,
    ticket_detail.cf_visual_compliance_run,
    ticket_detail.cf_syncfusion_sales_rep,
    ticket_detail.cf_absolute_revenue,
    ticket_detail.cf_car_rep,
    ticket_detail.cf_next_contact_date,
    ticket_detail.cf_opportunity_amount,
    ticket_detail.cf_task_subtype,
    ticket_detail.cf_day_log,
    ticket_detail.cf_time_activity_logged,
    ticket_detail.cf_call_type,
    ticket_detail.cf_call_result,
    ticket_detail.cf_license_ordered,
    ticket_detail.cf_presale_contract_request,
    ticket_detail.cf_assigned_to,
    ticket_detail.cf_ar_status,
    ticket_detail.cf_date_sent_to_legal,
    ticket_detail.cf_order_entered,
    ticket_detail.cf_verified_return_in_dt,
    ticket_detail.cf_confirmed_order_csr,
    ticket_detail.cf_date_order_closed_paidret,
    ticket_detail.cf_discount,
    ticket_detail.cf_email_subject,
    ticket_detail.cf_salescrr_issue_type,
    ticket_detail.cf_sales_rep_split_amount,
    ticket_detail.cf_cg_billing_postal_code,
    ticket_detail.cf_cg_known_company_url,
    ticket_detail.cf_problematic_pricing_opps,
    ticket_detail.cf_cg_billing_street,
    ticket_detail.cf_cg_billing_city,
    ticket_detail.cf_contact_license_type,
    ticket_detail.cf_group_billing_country,
    ticket_detail.cf_order_entered_by,
    ticket_detail.cf_reason_for_owner_change,
    ticket_detail.cf_acct_has_problematic_pricing,
    ticket_detail.cf_opp_acct_has_problematic_pricing,
    ticket_detail.cf_channel,
    ticket_detail.cf_csr_confirmed_alliance_order,
    ticket_detail.cf_submitted_for_bd_review,
    ticket_detail.contactname,
    ticket_detail."Invoice Age",
    ticket_detail.stage,
    ticket_detail."Amount After Discount",
    ticket_detail."Days To Expiration",
    ticket_detail."Days To Payment",
    ticket_detail."Days To Payment 2",
    ticket_detail."Days To Invoice Payment",
    ticket_detail."Days not renewing to closed",
    ticket_detail."Sales Admin Review Days",
    ticket_detail."Close Date to Processed",
    ticket_detail."Days to Process",
    ticket_detail."Close to Final CRRB Checks",
    ticket_detail."Close vs. Exp date",
    ticket_detail."Days Since Close Date",
    ticket_detail."Days Open",
    ticket_detail."Absolute Close Won Date",
    ticket_detail."Upgrade Amount",
    ticket_detail."When was Alliance Partner Paid",
    ticket_detail."Opportunity Age",
    ticket_detail."Bold Team",
    ticket_detail."Collections or AR?",
    ticket_detail."Call time",
    ticket_detail."Follow Up Type",
    ticket_detail."Contract Result",
    ticket_detail."Eligible for Contract",
    ticket_detail."Contract",
    ticket_detail."CRRB Processing Time",
    ticket_detail."Days To Final CRRB Check",
    ticket_detail."Days to Process(str)",
    ticket_detail."Invoice Age(Str)",
    ticket_detail."Close to payment",
    ticket_detail."Eligible Date to Close",
    ticket_detail."DT Order Link",
    ticket_detail."Tier 1 Region",
    ticket_detail."Adjusted Projected REN",
    ticket_detail."Percent Invoice Paid",
    ticket_detail."Days to Submit Order",
    ticket_detail."Days to Submit Order_bucket",
    ticket_detail."Annualized Revenue",
    ticket_detail."Closed By Expiration",
    ticket_detail."Link to Next REN Opportunity",
    ticket_detail."Link to Old REN Opportunity"
    
   FROM dblink('host=35.236.243.204 port=5432 user=salesopreaduser password=b9c!l9M4#zQ dbname=org-538'::text, 
			   
			   format('SELECT t.id,

    ( SELECT field_option.option_value
           FROM field_option
          WHERE field_option.id = fields."1309") AS cf_responsible_for_inv,
    fields."1430" AS cf_due_date,
    ( SELECT field_option.option_value
           FROM field_option
          WHERE field_option.id = fields."1245") AS cf_status,
    fields."1307" AS cf_dt_order_id,
    fields."1311" AS cf_salescrr_invoice_issue,
    fields."1625" AS cf_days_suppport_remaining,
    fields."1362" AS cf_alliance_partner,
    fields."1355" AS cf_manager,
    fields."1352" AS cf_visual_compliance_run,
    fields."1365" AS cf_syncfusion_sales_rep,
    fields."1354" AS cf_absolute_revenue,
 carrep.name as cf_car_rep,
    fields."1394" AS cf_next_contact_date,
    fields."1427" AS cf_opportunity_amount,
    ( SELECT field_option.option_value
           FROM field_option
          WHERE field_option.id = fields."1432") AS cf_task_subtype,
    ( SELECT field_option.option_value
           FROM field_option
          WHERE field_option.id = fields."1434") AS cf_day_log,
    fields."1435" AS cf_time_activity_logged,
    ( SELECT field_option.option_value
           FROM field_option
          WHERE field_option.id = fields."1436") AS cf_call_type,
    fields."1588" AS cf_call_result,
    ( SELECT field_option.option_value
           FROM field_option
          WHERE field_option.id = fields."1371") AS cf_license_ordered,
    fields."1418" AS cf_presale_contract_request,
    fields."1589" AS cf_assigned_to,
    ( SELECT field_option.option_value
           FROM field_option
          WHERE field_option.id = fields."1449") AS cf_ar_status,
    fields."1454" AS cf_date_sent_to_legal,
    fields."1459" AS cf_order_entered,
    fields."1460" AS cf_verified_return_in_dt,
    fields."1461" AS cf_confirmed_order_csr,
    fields."1462" AS cf_date_order_closed_paidret,
    fields."1440" AS cf_discount,
    fields."1487" AS cf_email_subject,
    ( SELECT field_option.option_value
           FROM field_option
          WHERE field_option.id = fields."1312") AS cf_salescrr_issue_type,
    fields."1602" AS cf_sales_rep_split_amount,
    contactgroup."1083" AS cf_cg_billing_postal_code,
    contactgroup."1044" AS cf_cg_known_company_url,
    contactgroup."1058" AS cf_problematic_pricing_opps,
    contactgroup."1079" AS cf_cg_billing_street,
    contactgroup."1080" AS cf_cg_billing_city,
    ( SELECT field_option.option_value
           FROM field_option
          WHERE field_option.id = contactgroup."1170") AS cf_contact_license_type,
    contactgroup."1291" AS cf_group_billing_country,
    ( SELECT field_option.option_value
           FROM field_option
          WHERE field_option.id = fields."1518") AS cf_order_entered_by,
		  fields."1006" as cf_reason_for_owner_change,
		  contactgroup."1535" AS "cf_acct_has_problematic_pricing",
fields."1536" AS "cf_opp_acct_has_problematic_pricing",
( SELECT field_option.option_value
           FROM field_option
          WHERE field_option.id = fields."1452") AS cf_channel,
		  fields."1591" as "cf_csr_confirmed_alliance_order",

fields."1592" as "cf_submitted_for_bd_review",
 requester.name   AS contactname,
		  CASE WHEN fields."1462" is not null THEN date_part(''day'', fields."1326" - fields."1462") ELSE date_part(''day'', fields."1326" - CURRENT_DATE) END AS "Invoice Age",
CASE WHEN tst.label_for_agent = ''Closed'' THEN CASE WHEN ( SELECT field_option.option_value
           FROM field_option
          WHERE field_option.id = fields."1021") is null THEN tst.label_for_agent ELSE ( SELECT field_option.option_value
           FROM field_option
          WHERE field_option.id = fields."1021") END ELSE tst.label_for_agent END AS "stage",
CASE WHEN fields."1440" is null THEN fields."1001" ELSE (fields."1001" - ((fields."1001" * fields."1440")/100)) END AS "Amount After Discount",
CASE WHEN (CASE WHEN tst.label_for_agent = ''Closed'' THEN CASE WHEN ( SELECT field_option.option_value
           FROM field_option
          WHERE field_option.id = fields."1021") is null THEN tst.label_for_agent ELSE ( SELECT field_option.option_value
           FROM field_option
          WHERE field_option.id = fields."1021") END ELSE tst.label_for_agent END) = ''Closed Won'' then  date_part(''day'', fields."1066" - t.closed_on) else date_part(''day'', fields."1066" - CURRENT_DATE) end  AS "Days To Expiration",
CASE WHEN fields."1462" is not null THEN CASE WHEN fields."1320" is null THEN date_part(''day'',fields."1462" - t.closed_on ) ELSE date_part(''day'', fields."1462" -  fields."1320") END ELSE 0 END AS "Days To Payment",
CASE WHEN fields."1462" is not null THEN date_part(''day'', fields."1462" -  fields."1320") else (CASE WHEN fields."1459" is not null THEN date_part(''day'',fields."1462" - fields."1459" ) ELSE date_part(''day'', fields."1462" -  t.closed_on) END)  END AS "Days To Payment 2",
date_part(''day'', t.closed_on - fields."1462") AS "Days To Invoice Payment",
date_part(''day'', t.closed_on - fields."1495") AS "Days not renewing to closed",
date_part(''day'', fields."1153" - fields."1151") AS "Sales Admin Review Days",
date_part(''day'', fields."1153" - t.closed_on) AS "Close Date to Processed",
date_part(''day'', fields."1160"-fields."1153") AS "Days to Process",
date_part(''day'', fields."1461" - (case when tst.label_for_agent != ''Closed'' then t.resolution_due_on else t.closed_on end)) AS "Close to Final CRRB Checks",
date_part(''day'', fields."1066" - t.closed_on) AS "Close vs. Exp date",
date_part(''day'', CURRENT_DATE - (case when tst.label_for_agent != ''Closed'' then t.resolution_due_on else t.closed_on end)) AS "Days Since Close Date",
CASE WHEN tst.label_for_agent = ''Closed'' THEN date_part(''day'', t.closed_on - t.created_on) ELSE date_part(''day'', CURRENT_DATE - t.created_on) END AS "Days Open",
CASE WHEN fields."1301" is not null THEN fields."1301" ELSE t.closed_on END AS "Absolute Close Won Date",
fields."1327" - fields."1068" AS "Upgrade Amount",
CASE WHEN fields."1623" <= 0 THEN ''Paid Alliance partner before Syncfusion got paid'' ELSE ''Paid Alliance partner after Syncfusion got paid'' END AS "When was Alliance Partner Paid",
CASE WHEN tst.label_for_agent = ''Closed'' THEN date_part(''day'', t.closed_on - t.created_on) ELSE date_part(''day'', CURRENT_DATE - t.created_on) END AS "Opportunity Age",
CASE WHEN ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Bold Sign'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''BoldDesk'' THEN ''BoldSign/Desk'' WHEN ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Bold BI Cloud'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Bold BI Enterprise'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Bold BI Embedded'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Bold Reports Cloud'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Bold Reports On-Premise'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Bold Reports Embedded'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Bold BI Upgrade'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Bold Reports'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Bold BI On-Premise'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Bold BI New'' THEN ''Bold BI/Reports'' ELSE '''' END AS "Bold Team",
CASE WHEN (CASE WHEN fields."1462" is not null THEN date_part(''day'', fields."1326" - fields."1462") ELSE date_part(''day'', fields."1326" - CURRENT_DATE) END <= 120) THEN ''Invoice < 120 Days Past Due'' ELSE ''Invoice > 120 Days Past Due'' END AS "Collections or AR?",
'''' AS "Call time",
CASE WHEN (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1317") = ''Obtain PO'' THEN ''Obtain PO''
WHEN (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1317") = ''Delay Legal follow-up'' OR (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1317") = ''Legal Following up with Customer'' THEN ''Obtain INV Payment'' WHEN (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1317") = ''Payment Plan'' THEN ''Collections Payment Plan'' WHEN  (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1317") = ''Amy contacting stripe orders'' THEN ''Recurring Orders'' ELSE null END AS "Follow Up Type",
CASE WHEN (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") = ''Contract Complete'' THEN ''Contract Fully Executed''  WHEN (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") = ''No Signed Contract (>6 Mos)'' OR (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") = ''No Signed Contract, Sales Going for Renewal'' OR (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") = ''No Contract, Other'' OR (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") = ''Returned/Cancelled'' OR (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") =  ''No New Contract, Already Under Contract'' THEN ''No Contract Needed'' WHEN (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") = ''Opportunity Split'' OR  (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") = ''Old Record Update - JP'' OR (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") = ''Government Contract'' OR (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") = ''JV and MTH to discuss'' THEN null ELSE ''Contract In Progress'' END AS "Contract Result",
CASE WHEN ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Retail - ESEE'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Retail - Other'' THEN ''Not Eligible'' WHEN ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Global'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Division'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Consulting'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Project'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Maintenance & Support'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Bold BI Upgrade'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Bold Reports'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Bold BI On-Premise'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Bold BI New'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Multiple Bold Products (has Bold BI)'' OR ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") = ''Multiple Bold Products (no Bold BI)'' THEN ''Eligible'' ELSE ( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1371") END AS "Eligible for Contract",
CASE WHEN (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") = ''No Contract, Other'' OR (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") =  ''No New Contract, Already Under Contract'' THEN ''No Contract Needed''
 ELSE (CASE WHEN (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") = ''Opportunity Split'' OR  (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") = ''Old Record Update - JP'' OR (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") = ''Government Contract'' OR (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") = ''JV and MTH to discuss'' OR (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1337") = ''Returned/Cancelled'' THEN ''Others''  ELSE ''Contract Needed'' END) END AS "Contract",
CASE WHEN date_part(''day'', fields."1160"-fields."1153") <= 0.5 THEN ''Same Day'' WHEN date_part(''day'', fields."1160"-fields."1153") > 0.5 AND date_part(''day'', fields."1160"-fields."1153") <= 1 THEN ''1 Day'' WHEN date_part(''day'', fields."1160"-fields."1153") > 1 AND date_part(''day'', fields."1160"-fields."1153") <= 2 THEN ''2 Days'' WHEN date_part(''day'', fields."1160"-fields."1153") > 2 AND date_part(''day'', fields."1160"-fields."1153") <= 3 THEN ''3 Days'' WHEN date_part(''day'', fields."1160"-fields."1153") > 3 AND date_part(''day'', fields."1160"-fields."1153") <= 6 THEN ''4 - 6 Days'' WHEN date_part(''day'', fields."1160"-fields."1153") > 6 AND date_part(''day'', fields."1160"-fields."1153") <= 9 THEN ''7 - 9 Days'' ELSE (case when date_part(''day'', fields."1160"-fields."1153") >= 10 then ''10 or More Days'' else null end) END AS "CRRB Processing Time",
CASE WHEN date_part(''day'', fields."1461" - (case when tst.label_for_agent != ''Closed'' then t.resolution_due_on else t.closed_on end)) <= 0.5 THEN ''Same Day'' WHEN date_part(''day'', fields."1461" - (case when tst.label_for_agent != ''Closed'' then t.resolution_due_on else t.closed_on end)) > 0.5 AND date_part(''day'', fields."1461" - (case when tst.label_for_agent != ''Closed'' then t.resolution_due_on else t.closed_on end)) <= 1 THEN ''1 Day'' WHEN date_part(''day'', fields."1461" - (case when tst.label_for_agent != ''Closed'' then t.resolution_due_on else t.closed_on end)) > 1 AND date_part(''day'', fields."1461" - (case when tst.label_for_agent != ''Closed'' then t.resolution_due_on else t.closed_on end)) <= 2 THEN ''2 Days'' WHEN date_part(''day'', fields."1461" - (case when tst.label_for_agent != ''Closed'' then t.resolution_due_on else t.closed_on end)) > 2 AND date_part(''day'', fields."1461" - (case when tst.label_for_agent != ''Closed'' then t.resolution_due_on else t.closed_on end)) <= 3 THEN ''3 Days'' WHEN date_part(''day'', fields."1461" - (case when tst.label_for_agent != ''Closed'' then t.resolution_due_on else t.closed_on end)) > 3 AND date_part(''day'', fields."1461" - (case when tst.label_for_agent != ''Closed'' then t.resolution_due_on else t.closed_on end)) <= 6 THEN ''4 - 6 Days'' WHEN date_part(''day'', fields."1461" - (case when tst.label_for_agent != ''Closed'' then t.resolution_due_on else t.closed_on end)) > 6 AND date_part(''day'', fields."1461" - (case when tst.label_for_agent != ''Closed'' then t.resolution_due_on else t.closed_on end)) <= 9 THEN ''7 - 9 Days'' ELSE (case when date_part(''day'', fields."1461" - (case when tst.label_for_agent != ''Closed'' then t.resolution_due_on else t.closed_on end)) >= 10 then ''10 or More Days'' else null end) END AS "Days To Final CRRB Check",
CASE WHEN date_part(''day'', fields."1160"-fields."1153") <= 0.5 THEN ''Same Day'' WHEN date_part(''day'', fields."1160"-fields."1153") > 0.5 AND date_part(''day'', fields."1160"-fields."1153") <= 1 THEN ''1 Day'' WHEN date_part(''day'', fields."1160"-fields."1153") > 1 AND date_part(''day'', fields."1160"-fields."1153") <= 2 THEN ''2 Days'' WHEN date_part(''day'', fields."1160"-fields."1153") > 2 AND date_part(''day'', fields."1160"-fields."1153") <= 3 THEN ''3 Days'' ELSE (case when date_part(''day'', fields."1160"-fields."1153")>3 then ''More than 3 Days'' else null end) END AS "Days to Process(str)",
CASE WHEN (CASE WHEN fields."1462" is not null THEN date_part(''day'', fields."1326" - fields."1462") ELSE date_part(''day'', fields."1326" - CURRENT_DATE) END) <= 89 THEN ''Orders Less than 90 Days Past Due'' WHEN (CASE WHEN fields."1462" is not null THEN date_part(''day'', fields."1326" - fields."1462") ELSE date_part(''day'', fields."1326" - CURRENT_DATE) END) > 89 AND (CASE WHEN fields."1462" is not null THEN date_part(''day'', fields."1326" - fields."1462") ELSE date_part(''day'', fields."1326" - CURRENT_DATE) END) <= 100 THEN ''Orders 90 - 100 Days Past Due'' WHEN (CASE WHEN fields."1462" is not null THEN date_part(''day'', fields."1326" - fields."1462") ELSE date_part(''day'', fields."1326" - CURRENT_DATE) END) > 100 AND (CASE WHEN fields."1462" is not null THEN date_part(''day'', fields."1326" - fields."1462") ELSE date_part(''day'', fields."1326" - CURRENT_DATE) END) <= 105 THEN ''Orders 100 - 105 Days Past Due'' WHEN (CASE WHEN fields."1462" is not null THEN date_part(''day'', fields."1326" - fields."1462") ELSE date_part(''day'', fields."1326" - CURRENT_DATE) END) > 105 AND (CASE WHEN fields."1462" is not null THEN date_part(''day'', fields."1326" - fields."1462") ELSE date_part(''day'', fields."1326" - CURRENT_DATE) END) <= 110 THEN ''Orders 106 - 110 Days Past Due'' WHEN (CASE WHEN fields."1462" is not null THEN date_part(''day'', fields."1326" - fields."1462") ELSE date_part(''day'', fields."1326" - CURRENT_DATE) END) > 110 AND (CASE WHEN fields."1462" is not null THEN date_part(''day'', fields."1326" - fields."1462") ELSE date_part(''day'', fields."1326" - CURRENT_DATE) END) <= 115 THEN ''Orders 111 - 115 Days Past Due'' ELSE ''Orders 116 - 120 Days Past Due - Review and Update for Possible Move to Collections'' END AS "Invoice Age(Str)",
CASE WHEN date_part(''day'', t.closed_on - fields."1462") <= 3 THEN ''0-3'' WHEN date_part(''day'', t.closed_on - fields."1462") > 3 AND date_part(''day'', t.closed_on - fields."1462") <= 10 THEN ''4 - 10 Days'' WHEN date_part(''day'', t.closed_on - fields."1462") > 10 AND  date_part(''day'', t.closed_on - fields."1462") <= 20 THEN ''10 - 20 Days'' WHEN date_part(''day'', t.closed_on - fields."1462") > 20 AND  date_part(''day'', t.closed_on - fields."1462") <= 30 THEN ''20 - 30 Days'' WHEN date_part(''day'', t.closed_on - fields."1462") > 30 AND date_part(''day'', t.closed_on - fields."1462") <= 40 THEN ''30 - 40 Days'' WHEN date_part(''day'', t.closed_on - fields."1462") > 40 AND  date_part(''day'', t.closed_on - fields."1462") <= 50 THEN ''40 - 50 Days'' WHEN date_part(''day'', t.closed_on - fields."1462") > 50 AND  date_part(''day'', t.closed_on - fields."1462") <= 60 THEN ''50 - 60 Days'' WHEN date_part(''day'', t.closed_on - fields."1462") > 60 AND  date_part(''day'', t.closed_on - fields."1462") <= 70 THEN ''60 - 70 Days'' WHEN date_part(''day'', t.closed_on - fields."1462") > 70 AND  date_part(''day'', t.closed_on - fields."1462") <= 80 THEN ''70 - 80 Days'' WHEN date_part(''day'', t.closed_on - fields."1462") > 80 AND  date_part(''day'', t.closed_on - fields."1462") <= 90 THEN ''80 - 90 Days'' ELSE ( case when date_part(''day'', t.closed_on - fields."1462") >=90 then ''More than 90 Days'' else null end) END AS "Close to payment",
to_date(CASE WHEN (CONCAT((CASE WHEN date_part(''month'', fields."1066") = 1 THEN date_part(''year'', fields."1066") - 1 ELSE date_part(''year'', fields."1066") END) ::varchar,''-'',(CASE WHEN date_part(''month'', fields."1066") = 1 THEN 12 ELSE date_part(''month'', fields."1066") - 1 END) ::varchar,''-'',''01'')) =''--01'' THEN null ELSE (CONCAT((CASE WHEN date_part(''month'', fields."1066") = 1 THEN date_part(''year'', fields."1066") - 1 ELSE date_part(''year'', fields."1066") END) ::varchar,''-'',(CASE WHEN date_part(''month'', fields."1066") = 1 THEN 12 ELSE date_part(''month'', fields."1066") - 1 END)::varchar,''-'',''01'')) END, ''YYYY-MM-DD'') AS "Eligible Date to Close",
CONCAT(''https://intranet.syncfusion.com/order/'', fields."1522") AS "DT Order Link",
Case (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1092") WHEN ''AE'' THEN 1 WHEN ''BE'' THEN 1 WHEN ''BH'' THEN 1 WHEN ''CH'' THEN 1 WHEN ''DE'' THEN 1 WHEN ''DK'' THEN 1 WHEN ''ES'' THEN 1 WHEN ''FI'' THEN 1 WHEN ''FR'' THEN 1 WHEN ''GR'' THEN 1 WHEN ''IE'' THEN 1 WHEN ''IL'' THEN 1 WHEN ''JO'' THEN 1 WHEN ''KW'' THEN 1 WHEN ''LU'' THEN 1 WHEN ''NL'' THEN 1 WHEN ''NO'' THEN 1 WHEN ''OM'' THEN 1 WHEN ''PL'' THEN 1 WHEN ''PT'' THEN 1 WHEN ''QA'' THEN 1 WHEN ''SA'' THEN 1 WHEN ''SE'' THEN 1 WHEN ''TR'' THEN 1 WHEN ''US'' THEN 2
WHEN ''UK'' THEN 1 WHEN ''ZA'' THEN 1 WHEN ''AN'' THEN 2 WHEN ''BR'' THEN 2 WHEN ''KY'' THEN 2 WHEN ''MX'' THEN 2 WHEN ''UM'' THEN 2 WHEN ''AS'' THEN 3 WHEN ''AU'' THEN 3 WHEN ''BN'' THEN 3 WHEN ''HK'' THEN 3 WHEN ''IS'' THEN 3 WHEN ''IT'' THEN 3 WHEN ''JP'' THEN 3 WHEN ''KR'' THEN 3 WHEN ''LI'' THEN 3 WHEN ''MY'' THEN 3 WHEN ''NZ'' THEN 3 WHEN ''SG'' THEN 3 WHEN ''United Arab Emirates'' THEN 1 WHEN ''Belgium'' THEN 1 WHEN ''Bahrain'' THEN 1
WHEN ''Switzerland'' THEN 1 WHEN ''Germany'' THEN 1 WHEN ''Denmark'' THEN 1 WHEN ''Spain'' THEN 1 WHEN ''Finland'' THEN 1 WHEN ''France'' THEN 1 WHEN ''Greece'' THEN 1 WHEN ''Ireland'' THEN 1 WHEN ''Israel'' THEN 1 WHEN ''Jordan'' THEN 1 WHEN ''Kuwait'' THEN 1
WHEN ''Luxembourg'' THEN 1 WHEN ''Netherlands'' THEN 1 WHEN ''Norway'' THEN 1 WHEN ''Oman'' THEN 1 WHEN ''Poland'' THEN 1 WHEN ''Portugal'' THEN 1 WHEN ''Qatar'' THEN 1 WHEN ''Saudi Arabia'' THEN 1 WHEN ''Sweden'' THEN 1 WHEN ''Turkey'' THEN 1 WHEN ''United Kingdom'' THEN 1 WHEN ''South Africa'' THEN 1 WHEN ''Netherlands Antilles'' THEN 2 WHEN ''Brazil'' THEN 2 WHEN ''Cayman Islands'' THEN 2 WHEN ''Mexico'' THEN 2 WHEN ''United States'' THEN 2 WHEN ''United States Minor Outlying Islands'' THEN 2 WHEN ''American Samoa'' THEN 3 WHEN ''Australia'' THEN 3 WHEN ''Brunei Darussalam'' THEN 3 WHEN ''Hong Kong'' THEN 3 WHEN ''Iceland'' THEN 3 WHEN ''Italy'' THEN 3 WHEN ''Japan'' THEN 3 WHEN ''Korea (South)'' THEN 3 WHEN ''Malaysia'' THEN 3 WHEN ''New Zealand (Aotearoa)'' THEN 3 WHEN ''Singapore'' THEN 3 ELSE 0 END AS "Tier 1 Region",
CASE WHEN fields."1068" is not null AND NOT((SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1052") = ''Retail'' OR (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1052") = '''') THEN (CASE WHEN fields."1492" is not null THEN (CASE WHEN fields."1619" is not null THEN (CASE WHEN fields."1618" is not null THEN fields."1492"/NULLIF(fields."1618", 0) ELSE fields."1492"/NULLIF(fields."1619", 0) END) ELSE fields."1492" END) ELSE (CASE WHEN fields."1619" is not null THEN fields."1068"/NULLIF(fields."1619", 0) ELSE fields."1068" END) END) ELSE (CASE WHEN fields."1479" is not null AND (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1052") = ''Retail'' OR (SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1052") = '''' THEN fields."1479" ELSE fields."1068" END) END AS "Adjusted Projected REN",
((fields."1327" - fields."1328")/NULLIF(fields."1327", 0)) * 100 AS "Percent Invoice Paid",
date_part(''day'', fields."1151" - t.created_on) AS "Days to Submit Order",
CASE WHEN date_part(''day'', fields."1151" - t.created_on) <= 0.5 THEN ''Same Day'' WHEN date_part(''day'', fields."1151" - t.created_on) > 0.5 AND date_part(''day'', fields."1151" - t.created_on) <= 1 THEN ''1 Day'' WHEN date_part(''day'', fields."1151" - t.created_on) > 1 AND date_part(''day'', fields."1151" - t.created_on) <= 2 THEN ''2 Days'' WHEN date_part(''day'', fields."1151" - t.created_on) > 2 AND date_part(''day'', fields."1151" - t.created_on) <= 3 THEN ''3 Days'' WHEN date_part(''day'', fields."1151" - t.created_on) > 3 AND date_part(''day'', fields."1151" - t.created_on) <= 6 THEN ''4 - 6 Days'' WHEN date_part(''day'', fields."1151" - t.created_on) > 6 AND date_part(''day'', fields."1151" - t.created_on) <= 9 THEN ''7 - 9 Days'' ELSE (case when date_part(''day'', fields."1151" - t.created_on) >= 10 then ''10 or More Days'' else null end) END AS "Days to Submit Order_bucket",

fields."1174"::double precision + fields."1178"::double precision + fields."1182"::double precision + fields."1186"::double precision + fields."1190"::double precision + fields."1192"::double precision + fields."1195"::double precision + fields."1198"::double precision + fields."1204"::double precision + fields."1206"::double precision + fields."1207"::double precision + fields."1210"::double precision as "Annualized Revenue",
case when date_part(''day'', fields."1066" - t.closed_on) <= -30 Then ''Closed more than  30 days after Expiration Date'' else (case when date_part(''day'', fields."1066" - t.closed_on) > -30 and date_part(''day'', fields."1066" - t.closed_on) <= -1 Then ''Closed 1 to 30 days after Expiration Date'' else (case when date_part(''day'', fields."1066" - t.closed_on) > -1 Then ''Closed by Expiration Date'' else null end) end) end as "Closed By Expiration",
null as "Link to Next REN Opportunity",
null as "Link to Old REN Opportunity"

   FROM (select * from ticket_detail where  id in (%s) and is_active=true ) t
     LEFT JOIN brand b ON b.org_brand_id = t.org_brand_id
     LEFT JOIN ticket_status tst ON tst.id = t.ticket_status_id
     LEFT JOIN ticket_source tso ON tso.id = t.ticket_source_id
     LEFT JOIN users requester ON requester.id = t.requested_by
     LEFT JOIN users replied ON replied.id = t.last_replied_by_id
     LEFT JOIN user_type rut ON rut.id = t.last_replied_by_user_type_id
     LEFT JOIN users creator ON creator.id = t.created_by
     LEFT JOIN users modifier ON modifier.id = t.last_modified_by
     LEFT JOIN ticket_priority tp ON tp.id = t.ticket_priority_id
     LEFT JOIN users assignee ON assignee.id = t.assigned_to_user_id
     LEFT JOIN user_group aug ON aug.id = t.assigned_to_group_id
     LEFT JOIN contact_group cg ON cg.id = t.contact_group_id
     LEFT JOIN users closed ON closed.id = t.closed_by
     LEFT JOIN agent ON t.assigned_to_user_id = agent.user_id
	 LEFt JOIN users owner on agent.user_id = owner.id and owner.user_type_id = 2
  
 LEFT JOIN ticket_update tu ON tu.ticket_id = t.id AND tu.is_first_update = true
     LEFT JOIN ticket_update_type tut ON tut.id = tu.ticket_update_type_id,
     jsonb_to_record(t.custom_fields) fields("1001" numeric(36,6), "1522" character varying, "1489" character varying, "1490" date, "1336" character varying, "1540" character varying, "1491" date, "1492" numeric(36,6), "1493" bigint, "1494" date, "1092" bigint,  "1497" date, "1103" character varying, "1063" bigint, "1498" boolean, "1141" bigint, "1503" character varying, "1093" timestamp without time zone, "1499" bigint, "1500" boolean, "1495" date,   "1504" date, "1618" decimal(36,6), "1619" decimal(36,6),   "1510" date, "1623" int, "1512" bigint, "1513" bigint, "1514" date, "1515" date, "1044" character varying, "1066" timestamp without time zone, "1052" bigint, "1453" bigint, "1299" bigint, "1301" timestamp without time zone, "1501" character varying,  "1507" date, "1125" character varying, "1366" character varying, "1508" date,  "1516" boolean, "1517" date, "1519" bigint, "1520" bigint, "1521" date, "1151" timestamp without time zone,  "1496" integer[], "1373" character varying, "1226" bigint, "1509" date, "1384" timestamp without time zone, "1248" bigint, "1300" character varying, "1277" character varying, "1388" bigint, "1593" int[], "1400" character varying, "1142" timestamp without time zone, "1370" bigint, "1372" bigint, "1042" character varying, "1480" boolean, "1479" numeric(36,6), "1483" character varying, "1009" bigint, "1485" character varying, "1259" timestamp without time zone, "1326" timestamp without time zone, "1102" bigint, "1310" bigint, "1344" timestamp without time zone, "1347" timestamp without time zone, "1343" numeric(36,6), "1330" timestamp without time zone, "1338" timestamp without time zone,  "1010" character varying, "1139" character varying, "1542" character varying, "1111" bigint, "1005" bigint, "1094" bigint, "1544" character varying, "1404" timestamp without time zone, "1095" integer[], "1118" character varying, "1108" character varying, "1543" character varying, "1008" bigint, "1025" bigint, "1049" character varying, "1043" character varying, "1069" bigint, "1380" character varying, "1622" character varying, "1068" numeric(36,6), "1332" character varying, "1018" character varying, "1020" character varying, "1294" character varying, "1011" character varying, "1315" character varying, "1318" bigint, "1065" timestamp without time zone, "1047" character varying, "1050" bigint, "1060" bigint, "1051" bigint, "1296" bigint, "1021" bigint, "1320" timestamp without time zone, "1351" character varying, "1313" timestamp without time zone, "1314" character varying, "1054" character varying, "1121" timestamp without time zone, "1123" character varying, "1144" bigint, "1145" bigint, "1146" character varying, "1147" boolean, "1149" bigint, "1048" character varying, "1382" timestamp without time zone, "1137" character varying, "1169" character varying, "1170" bigint, "1153" timestamp without time zone, "1155" timestamp without time zone, "1156" timestamp without time zone, "1160" timestamp without time zone, "1046" bigint, "1179" numeric(36,6), "1180" numeric(36,6), "1174" numeric(36,6), "1177" numeric(36,6), "1337" bigint, "1385" timestamp without time zone, "1227" bigint, "1165" integer[], "1240" numeric(36,6), "1232" bigint, "1233" boolean, "1243" character varying, "1342" numeric(36,6), "1247" bigint, "1241" character varying, "1238" integer[], "1249" timestamp without time zone, "1254" date, "1255" timestamp without time zone, "1256" timestamp without time zone, "1257" timestamp without time zone, "1250" character varying, "1167" numeric(36,6), "1262" timestamp without time zone, "1328" numeric(36,6), "1322" numeric(36,6), "1323" bigint, "1316" timestamp without time zone, "1345" timestamp without time zone, "1546" character varying, "1321" timestamp without time zone, "1399" bigint, "1334" integer[], "1317" bigint, "1319" timestamp without time zone, "1327" numeric(36,6), "1340" bigint, "1263" character varying, "1260" timestamp without time zone, "1261" timestamp without time zone, "1268" timestamp without time zone, "1279" bigint, "1291" character varying, "1285" bigint, "1286" bigint, "1287" character varying, "1288" timestamp without time zone, "1308" timestamp without time zone, "1581" character varying, "1281" timestamp without time zone, "1283" character varying, "1309" bigint, "1430" timestamp without time zone, "1245" bigint,  "1307" character varying, "1350" character varying, "1311" timestamp without time zone, "1625" decimal(36,6), "1362" character varying, "1355" character varying, "1352" timestamp without time zone, "1365" character varying, "1367" numeric(36,6), "1354" character varying, "1335" character varying, "1394" timestamp without time zone, "1427" numeric(36,6), "1432" bigint, "1434" bigint, "1435" timestamp without time zone, "1436" bigint, "1588" character varying, "1371" bigint, "1418" timestamp without time zone, "1589" character varying, "1449" bigint, "1454" timestamp without time zone, "1459" date, "1460" boolean, "1461" date, "1462" timestamp without time zone, "1440" numeric(36,6), "1487" character varying, "1312" bigint, "1602" decimal(36,6), "1518" bigint,"1006" int,"1178" numeric(36,6), "1182" numeric(36,6), "1186" numeric(36,6), "1190" numeric(36,6), "1192" numeric(36,6), "1195" numeric(36,6), "1198" numeric(36,6), "1204" numeric(36,6), "1206" numeric(36,6), "1207" numeric(36,6), "1210" numeric(36,6),"1535" timestamp without time zone, "1536" timestamp without time zone,"1452" bigint,"1591" timestamp , "1592" timestamp,"11" varchar,"1626" varchar,"1431" timestamp,"1433" boolean,"1441" bigint,"1442" bigint,"1443" bigint,"1587" varchar

,	 "1175" decimal(36,6),
"1617" bigint,
"1184" varchar,
"1183" bigint,
"1329" varchar,
"1150" varchar,
"1191" bigint,
"1188" timestamp,
"1573" varchar,
"1194" decimal(36,6),
"1205" decimal(36,6),
"1200" decimal(36,6),
"1199" decimal(36,6),
"1203" decimal(36,6),
"1202" decimal(36,6),
"1201" decimal(36,6),
"1197" decimal(36,6),
"1196" decimal(36,6),
"1225" bigint,
"1239" varchar,
"1237" bigint,
"1236" bigint,
"1360" varchar,
"1356" varchar,
"1358" varchar,
"1357" varchar,
"1353" timestamp,
"1361" varchar,
"1574" varchar,
"1208" varchar,
"1176" decimal(36,6),
"1553" varchar,
"1552" varchar,
"1193" int[],
"1554" varchar,
"1561" varchar,
"1559" varchar,
"1557" varchar,
"1558" varchar,
"1560" varchar,
"1563" varchar,
"1562" varchar,
"1564" varchar,
"1565" varchar,
"1572" varchar,
"1571" varchar,
"1575" varchar,
"1576" varchar,
"1578" varchar,
"1555" varchar,
"1577" varchar,
"1556" varchar,
"1189" timestamp,
"1173" bigint,
"1172" bigint,
"1171" bigint,
"1211" bigint,
"1228" bigint,
"1023" varchar,
"1024" date,
"1026" date,
"1027" bigint,
"1028" boolean,
"1029" varchar,
"1030" varchar,
"1035" varchar,
"1036" varchar,
"1037" varchar,
"1038" varchar,
"1039" varchar,
"1040" varchar,
"1041" varchar,
"7" varchar,
"8" varchar,
"19" varchar,
"6" bigint,
"41" varchar,
"9" bigint,
"35" varchar,
"21" varchar,
"10" bigint,
"12" varchar,
"13" varchar,
"37" varchar,
"1013" boolean,
"1015" varchar,
"1017" date,
"1019" bigint,
"1106" varchar,
"1594" varchar,
"1603" varchar,
"1293" varchar,
"1295" varchar,
"1379" varchar,
"1484" bigint,
																												   "1611" varchar,
"24" varchar,
"1107" bigint,
"1143" bigint,
"1596" date,
"1251" varchar,
"1252" varchar,
"1253" varchar,
"1258" bigint,
"1265" varchar,
"1266" varchar,
"1267" varchar,
"1269" timestamp,
"1270" decimal(36,6),
"1271" decimal(36,6),
"1278" bigint,
"1284" timestamp,
"1304" timestamp,
"1598" varchar,
"1599" varchar,
"1377" varchar,
"1383" bigint,
"1386" bigint,
"1387" timestamp,
"1390" varchar,
"1391" varchar,
"1392" bigint,
"1393" varchar,
"1397" varchar,
"1398" varchar,
"1401" timestamp,
"1402" timestamp,
"1403" bigint,
"1405" varchar,
"1419" varchar,
"1420" bigint,
"1421" bigint,
"1422" bigint,
"1424" bigint,
"1425" varchar,
"1429" decimal(36,6),
"1604" varchar,
"1445" decimal(36,6),
"1605" varchar,
"1464" date,
"1465" varchar,
"1466" varchar,
"1467" varchar,
"1468" varchar,
"1469" varchar,
"1472" varchar,
"1473" bigint,
"1474" bigint,
"1475" bigint,
"1476" date,
"1477" bigint,
"1481" varchar,
"1624" decimal(36,6),
"1606" varchar,
"1525" timestamp,
"1527" decimal(36,6),
"1528" decimal(36,6),
"1529" varchar,
"1531" varchar,
"1533" bigint,
"1534" decimal(36,6),
"1532" varchar,
"1547" varchar,
"1548" varchar,
"1524" bigint,
"1607" varchar,
"1608" varchar,
"1523" varchar,
"1530" varchar,
"1526" varchar,
"1609" varchar,
"1549" varchar,
"1610" varchar,
"1566" varchar,
"1567" varchar,
"1568" varchar,
"1569" varchar,
"1570" varchar,
"1579" varchar,
"1580" varchar,
"1584" varchar,
"1585" varchar,
"1586" varchar,
"1612" varchar,
"1613" varchar,
"1614" varchar,
"1235" bigint,
"1213" decimal(36,6))
	  LEFT Join users carrep on carrep.email=fields."1335",
     jsonb_to_record(cg.custom_fields) contactgroup("1170" bigint,
"1044" varchar,
"1058" boolean,
"1059" timestamp,
"1064" bigint,
"1071" bigint,
"1074" timestamp,
"1079" varchar,
"1080" varchar,
"1081" varchar,
"1083" varchar,
"1084" varchar,
"1085" varchar,
"1087" varchar,
"1088" varchar,
"22" varchar,
"29" varchar,
"30" varchar,
"14" varchar,
"15" varchar[],
"34" varchar,
"1101" bigint,
"1550" varchar,
"1242" varchar,
"1291" varchar,
"1292" varchar,
"1336" varchar,
"1363" bigint,
"1551" varchar,
"1535" date,
"1583" varchar )
	,jsonb_to_record(requester.custom_fields) contact("1626" varchar,
"1023" varchar,
"1024" date,
"1025" bigint,
"1026" date,
"1027" bigint,
"1028" boolean,
"1029" varchar,
"1030" varchar,
"1035" varchar,
"1036" varchar,
"1037" varchar,
"1038" varchar,
"1039" varchar,
"1040" varchar,
"1041" varchar,
"7" varchar,
"8" varchar,
"19" varchar,
"11" varchar,
"6" bigint,
"41" varchar,
"9" bigint,
"35" varchar,
"10" bigint,
"12" varchar,
"13" varchar,
"37" varchar,
"1013" boolean,
"1015" varchar,
"1017" date,
"1018" varchar,
"1019" bigint,
"1020" varchar,
"1106" varchar,
"1594" varchar,
"1603" varchar,
"1293" varchar,
"1295" varchar,
"1351" varchar,
"1379" varchar,
"1380" bigint,
"1484" bigint)	  
			   ',ticketid)) as 
			   ticket_detail(
			   id bigint,

 cf_responsible_for_inv text,
 cf_due_date timestamp without time zone,
 cf_status text,
 cf_dt_order_id character varying,
 cf_salescrr_invoice_issue timestamp without time zone,
 cf_days_suppport_remaining decimal(36,6),
 cf_alliance_partner character varying,
 cf_manager character varying,
 cf_visual_compliance_run timestamp without time zone,
 cf_syncfusion_sales_rep character varying,
 cf_absolute_revenue character varying,
 cf_car_rep text,
 cf_next_contact_date timestamp without time zone,
 cf_opportunity_amount numeric(36,6),
 cf_task_subtype text,
 cf_day_log text,
 cf_time_activity_logged timestamp without time zone,
 cf_call_type text,
 cf_call_result character varying,
 cf_license_ordered text,
 cf_presale_contract_request timestamp without time zone,
 cf_assigned_to character varying,
 cf_ar_status text,
 cf_date_sent_to_legal timestamp without time zone,
 cf_order_entered date,
 cf_verified_return_in_dt boolean,
 cf_confirmed_order_csr date,
 cf_date_order_closed_paidret timestamp without time zone,
 cf_discount numeric(36,6),
 cf_email_subject character varying,
 cf_salescrr_issue_type text,
 cf_sales_rep_split_amount character varying,
 cf_cg_billing_postal_code character varying,
 cf_cg_known_company_url character varying,
 cf_problematic_pricing_opps boolean,
 cf_cg_billing_street character varying,
 cf_cg_billing_city character varying,
 cf_contact_license_type text,
 cf_group_billing_country character varying,
 cf_order_entered_by text,
 cf_reason_for_owner_change integer,
 cf_acct_has_problematic_pricing timestamp without time zone,
 cf_opp_acct_has_problematic_pricing timestamp without time zone,
 cf_channel text,
 cf_csr_confirmed_alliance_order timestamp without time zone,
 cf_submitted_for_bd_review timestamp without time zone,
 contactname character varying,
 "Invoice Age" double precision,
 stage text,
 "Amount After Discount" numeric(36,6),
 "Days To Expiration" double precision,
 "Days To Payment" double precision,
 "Days To Payment 2" double precision,
 "Days To Invoice Payment" double precision,
 "Days not renewing to closed" double precision,
 "Sales Admin Review Days" double precision,
 "Close Date to Processed" double precision,
 "Days to Process" double precision,
 "Close to Final CRRB Checks" double precision,
 "Close vs. Exp date" double precision,
 "Days Since Close Date" double precision,
 "Days Open" double precision,
 "Absolute Close Won Date" timestamp with time zone,
 "Upgrade Amount" numeric(36,6),
 "When was Alliance Partner Paid" text,
 "Opportunity Age" double precision,
 "Bold Team" text,
 "Collections or AR?" text,
 "Call time" text,
 "Follow Up Type" text,
 "Contract Result" text,
 "Eligible for Contract" text,
 "Contract" text,
 "CRRB Processing Time" text,
 "Days To Final CRRB Check" text,
 "Days to Process(str)" text,
 "Invoice Age(Str)" text,
 "Close to payment" text,
 "Eligible Date to Close" date,
 "DT Order Link" text,
 "Tier 1 Region" integer,
 "Adjusted Projected REN" numeric(36,6),
 "Percent Invoice Paid" numeric(36,6),
 "Days to Submit Order" double precision,
 "Days to Submit Order_bucket" text,
 "Annualized Revenue" double precision,
 "Closed By Expiration" text,
 "Link to Next REN Opportunity" character varying,
 "Link to Old REN Opportunity" character varying)

 ;

	end;
$BODY$;

ALTER FUNCTION public.get_ticket_detail4(character varying)
    OWNER TO bolddeskuser;
