-- FUNCTION: public.get_ticket_detail2(character varying)

-- DROP FUNCTION IF EXISTS public.get_ticket_detail2(character varying);

CREATE OR REPLACE FUNCTION public.get_ticket_detail2(
	ticketid character varying)
    RETURNS TABLE(id bigint, email character varying, "Opportunity Owner Designation" character varying, "Opportunity Owner Role" character varying, "Opportunity Owner Department" character varying, "Opportunity Owner Workstation" character varying, "Opportunity Owner Division" character varying, "Opportunity Owner : Active" character varying, "Opportunity Owner : Manager" text, isreportingpersonasmaanager integer, "Opportunity Owner : Reporting Person" text, "User End Date" timestamp without time zone, "Opportunity Owner IsActive" boolean, "Car_Rep_Contact" character varying, cf_completed_datetime timestamp without time zone, cf_reminder_set boolean, cf_task_type character varying, cf_task_status character varying, cf_task_record_type character varying, cf_related_to character varying, cf_reseller_amount numeric, cf_bold_referral_partner character varying, cf_projectdivision_name character varying, cf_include_third_party_contractors character varying, cf_external_reference_id character varying, cf_special_instructionsnotes character varying, cf_contract_term character varying, cf_contract_start_date timestamp without time zone, cf_portal_admin_direct_trac_id_packflat character varying, cf_year_one_fee numeric, cf_year_eight_fee numeric, cf_year_five_fee numeric, cf_year_four_fee numeric, cf_year_nine_fee numeric, cf_year_seven_fee numeric, cf_year_six_fee numeric, cf_year_three_fee numeric, cf_year_two_fee numeric, cf_payment_terms character varying, cf_order_id_to_renew character varying, cf_premium_support character varying, cf_tss_support character varying, cf_bold_tenant_id_or_portal_name character varying, cf_account_name character varying, cf_associated_dt_order character varying, cf_current_opportunity_stage character varying, cf_order_visual_compliance_run timestamp without time zone, cf_reseller character varying, cf_portal_admin_country character varying, cf_portal_admin_full_name_packflat character varying, cf_contracted_amount_reseller_orders numeric, cf_application_name character varying, cf_main_project_contact_full_name character varying, cf_optional_renewal_years integer[], cf_official_company_name character varying, cf_end_user_1_direct_trac_id character varying, cf_end_user_4_full_name character varying, cf_end_user_2_full_name character varying, cf_end_user_3_full_name character varying, cf_end_user_5_full_name character varying, cf_end_user_3_direct_trac_id character varying, cf_end_user_2_direct_trac_id character varying, cf_end_user_4_direct_trac_id character varying, cf_end_user_5_direct_trac_id character varying, cf_main_project_contact_direct_trac_id character varying, cf_bill_toap_dt_customer_id character varying, cf_taxvat_id character varying, cf_po_number character varying, cf_enterpriseportal_id character varying, cf_contract_signatory_full_name character varying, cf_contract_signatory_dt_customer_id character varying, cf_end_user_1_full_name character varying, cf_next_renewal_date timestamp without time zone, cf_is_there_a_reseller_involved character varying, cf_is_this_an_upgrade character varying, cf_license_type character varying, cf_portal_admin_time_zone character varying, cf_are_vendor_forms_needed character varying, cf_secondary_email character varying, cf_submitted_to_fully_execute character varying, cf_agreement_fully_executed character varying, cf_bold_referral_partner_status character varying, cf_microsoft_mvp character varying, cf_microsoft_mvp_profile_url character varying, cf_billing_street character varying, cf_billing_state character varying, cf_billing_city character varying, cf_billing_postal_code character varying, cf_mailing_street character varying, cf_mailing_state character varying, cf_mailing_city character varying, cf_mailing_postal_code character varying, "contactPhoneNo" character varying, "contactMobileNo" character varying, "contactJobTitle" character varying, "contactGroup" character varying, "contactNotes" character varying, "contactGroupAccessScopeId" character varying, "contactExternalReferenceId" character varying, "contactTag" character varying, "timeZoneId" character varying, "contactDisplayName" character varying, "emailId" character varying, "contactAddress" character varying) 
    LANGUAGE 'plpgsql'
    COST 100
    VOLATILE PARALLEL UNSAFE
    ROWS 1000

AS $BODY$

begin

	return query 
SELECT ticket_detail.id,
ticket_detail.email,
   
		rdu."Opportunity Owner Designation",
		rdu."Opportunity Owner Role", 
		rdu."Opportunity Owner Department",
		rdu."Opportunity Owner Workstation",
		rdu."Opportunity Owner Division",
		ticket_detail."Opportunity Owner : Active",
		rdu."Opportunity Owner : Manager", 
		0 as isreportingpersonasmaanager, 
		rdu."Opportunity Owner : Reporting Person",
		rdu."User End Date", 
		ticket_detail."Opportunity Owner IsActive",
		ticket_detail."Car_Rep_Contact",
		
	ticket_detail.cf_completed_datetime,
	ticket_detail.cf_reminder_set,
	ticket_detail.cf_task_type,
	ticket_detail.cf_task_status,
	ticket_detail.cf_task_record_type,
	ticket_detail.cf_related_to,
	ticket_detail."cf_reseller_amount",
ticket_detail."cf_bold_referral_partner",
ticket_detail."cf_projectdivision_name",
ticket_detail."cf_include_third_party_contractors",
ticket_detail."cf_external_reference_id",
ticket_detail."cf_special_instructionsnotes",
ticket_detail."cf_contract_term",
ticket_detail."cf_contract_start_date",
ticket_detail."cf_portal_admin_direct_trac_id_packflat",
ticket_detail."cf_year_one_fee",
ticket_detail."cf_year_eight_fee",
ticket_detail."cf_year_five_fee",
ticket_detail."cf_year_four_fee",
ticket_detail."cf_year_nine_fee",
ticket_detail."cf_year_seven_fee",
ticket_detail."cf_year_six_fee",
ticket_detail."cf_year_three_fee",
ticket_detail."cf_year_two_fee",
ticket_detail."cf_payment_terms",
ticket_detail."cf_order_id_to_renew",
ticket_detail."cf_premium_support",
ticket_detail."cf_tss_support",
ticket_detail."cf_bold_tenant_id_or_portal_name",
ticket_detail."cf_account_name",
ticket_detail."cf_associated_dt_order",
ticket_detail."cf_current_opportunity_stage",
ticket_detail."cf_order_visual_compliance_run",
ticket_detail."cf_reseller",
ticket_detail."cf_portal_admin_country",
ticket_detail."cf_portal_admin_full_name_packflat",
ticket_detail."cf_contracted_amount_reseller_orders",
ticket_detail."cf_application_name",
ticket_detail."cf_main_project_contact_full_name",
ticket_detail."cf_optional_renewal_years",
ticket_detail."cf_official_company_name",
ticket_detail."cf_end_user_1_direct_trac_id",
ticket_detail."cf_end_user_4_full_name",
ticket_detail."cf_end_user_2_full_name",
ticket_detail."cf_end_user_3_full_name",
ticket_detail."cf_end_user_5_full_name",
ticket_detail."cf_end_user_3_direct_trac_id",
ticket_detail."cf_end_user_2_direct_trac_id",
ticket_detail."cf_end_user_4_direct_trac_id",
ticket_detail."cf_end_user_5_direct_trac_id",
ticket_detail."cf_main_project_contact_direct_trac_id",
ticket_detail."cf_bill_toap_dt_customer_id",
ticket_detail."cf_taxvat_id",
ticket_detail."cf_po_number",
ticket_detail."cf_enterpriseportal_id",
ticket_detail."cf_contract_signatory_full_name",
ticket_detail."cf_contract_signatory_dt_customer_id",
ticket_detail."cf_end_user_1_full_name",
ticket_detail."cf_next_renewal_date",
ticket_detail."cf_is_there_a_reseller_involved",
ticket_detail."cf_is_this_an_upgrade",
ticket_detail."cf_license_type",
ticket_detail."cf_portal_admin_time_zone",
ticket_detail."cf_are_vendor_forms_needed",
ticket_detail."cf_secondary_email",
ticket_detail."cf_submitted_to_fully_execute",
ticket_detail."cf_agreement_fully_executed",
ticket_detail."cf_bold_referral_partner_status",
ticket_detail."cf_microsoft_mvp",
ticket_detail."cf_microsoft_mvp_profile_url",
ticket_detail."cf_billing_street",
ticket_detail."cf_billing_state",
ticket_detail."cf_billing_city",
ticket_detail."cf_billing_postal_code",
ticket_detail."cf_mailing_street",
ticket_detail."cf_mailing_state",
ticket_detail."cf_mailing_city",
ticket_detail."cf_mailing_postal_code",
ticket_detail."contactPhoneNo",
ticket_detail."contactMobileNo",
ticket_detail."contactJobTitle",
ticket_detail."contactGroup",
ticket_detail."contactNotes",
ticket_detail."contactGroupAccessScopeId",
ticket_detail."contactExternalReferenceId",
ticket_detail."contactTag",
ticket_detail."timeZoneId",
ticket_detail."contactDisplayName",
ticket_detail."emailId",
ticket_detail."contactAddress"
   FROM dblink('host=35.236.243.204 port=5432 user=salesopreaduser password=b9c!l9M4#zQ dbname=org-538'::text, 
			   
			   format('SELECT t.id,
   owner.email,
(case when owner.user_status_id = 1 then ''true'' else ''false'' end)::boolean as "Opportunity Owner IsActive",
case when owner.user_status_id = 1 then owner.name else null end as "Opportunity Owner : Active",
contact."1626" as "Car_Rep_Contact",
																													fields."1431" as cf_completed_datetime,
fields."1433" as cf_reminder_set,
( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1441") as cf_task_type,
( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1442") as cf_task_status,
( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1443") as cf_task_record_type,
fields."1587" as cf_related_to,
 fields."1175"  as "cf_reseller_amount",
( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1617") as "cf_bold_referral_partner",
fields."1184"  as "cf_projectdivision_name",
( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1183") as "cf_include_third_party_contractors",
fields."1329"  as "cf_external_reference_id",
fields."1150"  as "cf_special_instructionsnotes",
( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1191") as "cf_contract_term",
fields."1188"  as "cf_contract_start_date",
fields."1573"  as "cf_portal_admin_direct_trac_id_packflat",
fields."1194"  as "cf_year_one_fee",
fields."1205"  as "cf_year_eight_fee",
fields."1200"  as "cf_year_five_fee",
fields."1199"  as "cf_year_four_fee",
fields."1203"  as "cf_year_nine_fee",
fields."1202"  as "cf_year_seven_fee",
fields."1201"  as "cf_year_six_fee",
fields."1197"  as "cf_year_three_fee",
fields."1196"  as "cf_year_two_fee",
( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1225") as "cf_payment_terms",
fields."1239"  as "cf_order_id_to_renew",
( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1237") as "cf_premium_support",
( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1236") as "cf_tss_support",
fields."1360"  as "cf_bold_tenant_id_or_portal_name",
fields."1356"  as "cf_account_name",
fields."1358"  as "cf_associated_dt_order",
fields."1357"  as "cf_current_opportunity_stage",
fields."1353"  as "cf_order_visual_compliance_run",
fields."1361"  as "cf_reseller",
fields."1574"  as "cf_portal_admin_country",
fields."1208"  as "cf_portal_admin_full_name_packflat",
fields."1176"  as "cf_contracted_amount_reseller_orders",
fields."1553"  as "cf_application_name",
fields."1552"  as "cf_main_project_contact_full_name",
fields."1193"  as "cf_optional_renewal_years",
fields."1554"  as "cf_official_company_name",
fields."1561"  as "cf_end_user_1_direct_trac_id",
fields."1559"  as "cf_end_user_4_full_name",
fields."1557"  as "cf_end_user_2_full_name",
fields."1558"  as "cf_end_user_3_full_name",
fields."1560"  as "cf_end_user_5_full_name",
fields."1563"  as "cf_end_user_3_direct_trac_id",
fields."1562"  as "cf_end_user_2_direct_trac_id",
fields."1564"  as "cf_end_user_4_direct_trac_id",
fields."1565"  as "cf_end_user_5_direct_trac_id",
fields."1572"  as "cf_main_project_contact_direct_trac_id",
fields."1571"  as "cf_bill_toap_dt_customer_id",
fields."1575"  as "cf_taxvat_id",
fields."1576"  as "cf_po_number",
fields."1578"  as "cf_enterpriseportal_id",
fields."1555"  as "cf_contract_signatory_full_name",
fields."1577"  as "cf_contract_signatory_dt_customer_id",
fields."1556"  as "cf_end_user_1_full_name",
fields."1189"  as "cf_next_renewal_date",
( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1173") as "cf_is_there_a_reseller_involved",
( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1172") as "cf_is_this_an_upgrade",
( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1171") as "cf_license_type",
( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1211") as "cf_portal_admin_time_zone",
( SELECT field_option.option_value FROM field_option WHERE field_option.id = fields."1228") as "cf_are_vendor_forms_needed",
contact."1023"  as "cf_secondary_email",
contact."1024"  as "cf_submitted_to_fully_execute",
contact."1026"  as "cf_agreement_fully_executed",
( SELECT field_option.option_value FROM field_option WHERE field_option.id = contact."1027") as "cf_bold_referral_partner_status",
contact."1028"  as "cf_microsoft_mvp",
contact."1029"  as "cf_microsoft_mvp_profile_url",
contact."1030"  as "cf_billing_street",
contact."1035"  as "cf_billing_state",
contact."1036"  as "cf_billing_city",
contact."1037"  as "cf_billing_postal_code",
contact."1038"  as "cf_mailing_street",
contact."1039"  as "cf_mailing_state",
contact."1040"  as "cf_mailing_city",
contact."1041"  as "cf_mailing_postal_code",
 requester.phone_no as "contactPhoneNo",
 requester.mobile  as "contactMobileNo",
 requester.job_title   as "contactJobTitle",
cg.name as "contactGroup",
requester.notes  as "contactNotes",
( SELECT field_option.option_value FROM field_option WHERE field_option.id = contact."9") as "contactGroupAccessScopeId",
contact."35"  as "contactExternalReferenceId",
fields."21"  as "contactTag",
 ( SELECT field_option.option_value FROM field_option WHERE field_option.id =requester.time_zone_id)  as "timeZoneId",
 requester.display_name   as "contactDisplayName",
 requester.email  as "emailId",
 requester.address as "contactAddress"
   FROM (select * from ticket_detail where  id in (%s) and is_active=true ) t
     LEFT JOIN brand b ON b.org_brand_id = t.org_brand_id
     LEFT JOIN ticket_status tst ON tst.id = t.ticket_status_id
     LEFT JOIN ticket_source tso ON tso.id = t.ticket_source_id
     LEFT JOIN users requester ON requester.id = t.requested_by
     LEFT JOIN users replied ON replied.id = t.last_replied_by_id
     LEFT JOIN user_type rut ON rut.id = t.last_replied_by_user_type_id
     LEFT JOIN users creator ON creator.id = t.created_by
     LEFT JOIN users modifier ON modifier.id = t.last_modified_by
     LEFT JOIN ticket_priority tp ON tp.id = t.ticket_priority_id
     LEFT JOIN users assignee ON assignee.id = t.assigned_to_user_id
     LEFT JOIN user_group aug ON aug.id = t.assigned_to_group_id
     LEFT JOIN contact_group cg ON cg.id = t.contact_group_id
     LEFT JOIN users closed ON closed.id = t.closed_by
     LEFT JOIN agent ON t.assigned_to_user_id = agent.user_id
	 LEFt JOIN users owner on agent.user_id = owner.id and owner.user_type_id = 2
 LEFT JOIN ticket_update tu ON tu.ticket_id = t.id AND tu.is_first_update = true
     LEFT JOIN ticket_update_type tut ON tut.id = tu.ticket_update_type_id,
     jsonb_to_record(t.custom_fields) fields("1001" numeric(36,6), "1522" character varying, "1489" character varying, "1490" date, "1336" character varying, "1540" character varying, "1491" date, "1492" numeric(36,6), "1493" bigint, "1494" date, "1092" bigint,  "1497" date, "1103" character varying, "1063" bigint, "1498" boolean, "1141" bigint, "1503" character varying, "1093" timestamp without time zone, "1499" bigint, "1500" boolean, "1495" date,   "1504" date, "1618" decimal(36,6), "1619" decimal(36,6),   "1510" date, "1623" int, "1512" bigint, "1513" bigint, "1514" date, "1515" date, "1044" character varying, "1066" timestamp without time zone, "1052" bigint, "1453" bigint, "1299" bigint, "1301" timestamp without time zone, "1501" character varying,  "1507" date, "1125" character varying, "1366" character varying, "1508" date,  "1516" boolean, "1517" date, "1519" bigint, "1520" bigint, "1521" date, "1151" timestamp without time zone,  "1496" integer[], "1373" character varying, "1226" bigint, "1509" date, "1384" timestamp without time zone, "1248" bigint, "1300" character varying, "1277" character varying, "1388" bigint, "1593" int[], "1400" character varying, "1142" timestamp without time zone, "1370" bigint, "1372" bigint, "1042" character varying, "1480" boolean, "1479" numeric(36,6), "1483" character varying, "1009" bigint, "1485" character varying, "1259" timestamp without time zone, "1326" timestamp without time zone, "1102" bigint, "1310" bigint, "1344" timestamp without time zone, "1347" timestamp without time zone, "1343" numeric(36,6), "1330" timestamp without time zone, "1338" timestamp without time zone,  "1010" character varying, "1139" character varying, "1542" character varying, "1111" bigint, "1005" bigint, "1094" bigint, "1544" character varying, "1404" timestamp without time zone, "1095" integer[], "1118" character varying, "1108" character varying, "1543" character varying, "1008" bigint, "1025" bigint, "1049" character varying, "1043" character varying, "1069" bigint, "1380" character varying, "1622" character varying, "1068" numeric(36,6), "1332" character varying, "1018" character varying, "1020" character varying, "1294" character varying, "1011" character varying, "1315" character varying, "1318" bigint, "1065" timestamp without time zone, "1047" character varying, "1050" bigint, "1060" bigint, "1051" bigint, "1296" bigint, "1021" bigint, "1320" timestamp without time zone, "1351" character varying, "1313" timestamp without time zone, "1314" character varying, "1054" character varying, "1121" timestamp without time zone, "1123" character varying, "1144" bigint, "1145" bigint, "1146" character varying, "1147" boolean, "1149" bigint, "1048" character varying, "1382" timestamp without time zone, "1137" character varying, "1169" character varying, "1170" bigint, "1153" timestamp without time zone, "1155" timestamp without time zone, "1156" timestamp without time zone, "1160" timestamp without time zone, "1046" bigint, "1179" numeric(36,6), "1180" numeric(36,6), "1174" numeric(36,6), "1177" numeric(36,6), "1337" bigint, "1385" timestamp without time zone, "1227" bigint, "1165" integer[], "1240" numeric(36,6), "1232" bigint, "1233" boolean, "1243" character varying, "1342" numeric(36,6), "1247" bigint, "1241" character varying, "1238" integer[], "1249" timestamp without time zone, "1254" date, "1255" timestamp without time zone, "1256" timestamp without time zone, "1257" timestamp without time zone, "1250" character varying, "1167" numeric(36,6), "1262" timestamp without time zone, "1328" numeric(36,6), "1322" numeric(36,6), "1323" bigint, "1316" timestamp without time zone, "1345" timestamp without time zone, "1546" character varying, "1321" timestamp without time zone, "1399" bigint, "1334" integer[], "1317" bigint, "1319" timestamp without time zone, "1327" numeric(36,6), "1340" bigint, "1263" character varying, "1260" timestamp without time zone, "1261" timestamp without time zone, "1268" timestamp without time zone, "1279" bigint, "1291" character varying, "1285" bigint, "1286" bigint, "1287" character varying, "1288" timestamp without time zone, "1308" timestamp without time zone, "1581" character varying, "1281" timestamp without time zone, "1283" character varying, "1309" bigint, "1430" timestamp without time zone, "1245" bigint,  "1307" character varying, "1350" character varying, "1311" timestamp without time zone, "1625" decimal(36,6), "1362" character varying, "1355" character varying, "1352" timestamp without time zone, "1365" character varying, "1367" numeric(36,6), "1354" character varying, "1335" character varying, "1394" timestamp without time zone, "1427" numeric(36,6), "1432" bigint, "1434" bigint, "1435" timestamp without time zone, "1436" bigint, "1588" character varying, "1371" bigint, "1418" timestamp without time zone, "1589" character varying, "1449" bigint, "1454" timestamp without time zone, "1459" date, "1460" boolean, "1461" date, "1462" timestamp without time zone, "1440" numeric(36,6), "1487" character varying, "1312" bigint, "1602" decimal(36,6), "1518" bigint,"1006" int,"1178" numeric(36,6), "1182" numeric(36,6), "1186" numeric(36,6), "1190" numeric(36,6), "1192" numeric(36,6), "1195" numeric(36,6), "1198" numeric(36,6), "1204" numeric(36,6), "1206" numeric(36,6), "1207" numeric(36,6), "1210" numeric(36,6),"1535" timestamp without time zone, "1536" timestamp without time zone,"1452" bigint,"1591" timestamp , "1592" timestamp,"11" varchar,"1626" varchar,"1431" timestamp,"1433" boolean,"1441" bigint,"1442" bigint,"1443" bigint,"1587" varchar

,	 "1175" decimal(36,6),
"1617" bigint,
"1184" varchar,
"1183" bigint,
"1329" varchar,
"1150" varchar,
"1191" bigint,
"1188" timestamp,
"1573" varchar,
"1194" decimal(36,6),
"1205" decimal(36,6),
"1200" decimal(36,6),
"1199" decimal(36,6),
"1203" decimal(36,6),
"1202" decimal(36,6),
"1201" decimal(36,6),
"1197" decimal(36,6),
"1196" decimal(36,6),
"1225" bigint,
"1239" varchar,
"1237" bigint,
"1236" bigint,
"1360" varchar,
"1356" varchar,
"1358" varchar,
"1357" varchar,
"1353" timestamp,
"1361" varchar,
"1574" varchar,
"1208" varchar,
"1176" decimal(36,6),
"1553" varchar,
"1552" varchar,
"1193" int[],
"1554" varchar,
"1561" varchar,
"1559" varchar,
"1557" varchar,
"1558" varchar,
"1560" varchar,
"1563" varchar,
"1562" varchar,
"1564" varchar,
"1565" varchar,
"1572" varchar,
"1571" varchar,
"1575" varchar,
"1576" varchar,
"1578" varchar,
"1555" varchar,
"1577" varchar,
"1556" varchar,
"1189" timestamp,
"1173" bigint,
"1172" bigint,
"1171" bigint,
"1211" bigint,
"1228" bigint,
"1023" varchar,
"1024" date,
"1026" date,
"1027" bigint,
"1028" boolean,
"1029" varchar,
"1030" varchar,
"1035" varchar,
"1036" varchar,
"1037" varchar,
"1038" varchar,
"1039" varchar,
"1040" varchar,
"1041" varchar,
"7" varchar,
"8" varchar,
"19" varchar,
"6" bigint,
"41" varchar,
"9" bigint,
"35" varchar,
"21" varchar,
"10" bigint,
"12" varchar,
"13" varchar,
"37" varchar,
"1013" boolean,
"1015" varchar,
"1017" date,
"1019" bigint,
"1106" varchar,
"1594" varchar,
"1603" varchar,
"1293" varchar,
"1295" varchar,
"1379" varchar,
"1484" bigint,
																												   "1611" varchar,
"24" varchar,
"1107" bigint,
"1143" bigint,
"1596" date,
"1251" varchar,
"1252" varchar,
"1253" varchar,
"1258" bigint,
"1265" varchar,
"1266" varchar,
"1267" varchar,
"1269" timestamp,
"1270" decimal(36,6),
"1271" decimal(36,6),
"1278" bigint,
"1284" timestamp,
"1304" timestamp,
"1598" varchar,
"1599" varchar,
"1377" varchar,
"1383" bigint,
"1386" bigint,
"1387" timestamp,
"1390" varchar,
"1391" varchar,
"1392" bigint,
"1393" varchar,
"1397" varchar,
"1398" varchar,
"1401" timestamp,
"1402" timestamp,
"1403" bigint,
"1405" varchar,
"1419" varchar,
"1420" bigint,
"1421" bigint,
"1422" bigint,
"1424" bigint,
"1425" varchar,
"1429" decimal(36,6),
"1604" varchar,
"1445" decimal(36,6),
"1605" varchar,
"1464" date,
"1465" varchar,
"1466" varchar,
"1467" varchar,
"1468" varchar,
"1469" varchar,
"1472" varchar,
"1473" bigint,
"1474" bigint,
"1475" bigint,
"1476" date,
"1477" bigint,
"1481" varchar,
"1624" decimal(36,6),
"1606" varchar,
"1525" timestamp,
"1527" decimal(36,6),
"1528" decimal(36,6),
"1529" varchar,
"1531" varchar,
"1533" bigint,
"1534" decimal(36,6),
"1532" varchar,
"1547" varchar,
"1548" varchar,
"1524" bigint,
"1607" varchar,
"1608" varchar,
"1523" varchar,
"1530" varchar,
"1526" varchar,
"1609" varchar,
"1549" varchar,
"1610" varchar,
"1566" varchar,
"1567" varchar,
"1568" varchar,
"1569" varchar,
"1570" varchar,
"1579" varchar,
"1580" varchar,
"1584" varchar,
"1585" varchar,
"1586" varchar,
"1612" varchar,
"1613" varchar,
"1614" varchar,
"1235" bigint,
"1213" decimal(36,6))
	  LEFT Join users carrep on carrep.email=fields."1335",
     jsonb_to_record(cg.custom_fields) contactgroup("1083" character varying, "1044" character varying, "1058" boolean, "1079" character varying, "1080" character varying, "1170" bigint, "1291" character varying)
			  ,jsonb_to_record(requester.custom_fields) contact("1626" varchar,
"1023" varchar,
"1024" date,
"1025" bigint,
"1026" date,
"1027" bigint,
"1028" boolean,
"1029" varchar,
"1030" varchar,
"1035" varchar,
"1036" varchar,
"1037" varchar,
"1038" varchar,
"1039" varchar,
"1040" varchar,
"1041" varchar,
"7" varchar,
"8" varchar,
"19" varchar,
"11" varchar,
"6" bigint,
"41" varchar,
"9" bigint,
"35" varchar,
"10" bigint,
"12" varchar,
"13" varchar,
"37" varchar,
"1013" boolean,
"1015" varchar,
"1017" date,
"1018" varchar,
"1019" bigint,
"1020" varchar,
"1106" varchar,
"1594" varchar,
"1603" varchar,
"1293" varchar,
"1295" varchar,
"1351" varchar,
"1379" varchar,
"1380" bigint,
"1484" bigint)
			   ',ticketid)) as 
			   ticket_detail(
			   id bigint,
			    email character varying,
				   "Opportunity Owner IsActive" boolean,
				   "Opportunity Owner : Active"  character varying,
"Car_Rep_Contact" varchar,
cf_completed_datetime timestamp,
cf_reminder_set boolean,
cf_task_type varchar,
cf_task_status varchar,
cf_task_record_type varchar,
cf_related_to varchar,
 "cf_reseller_amount" decimal(36,6),
"cf_bold_referral_partner" varchar,
"cf_projectdivision_name" varchar,
"cf_include_third_party_contractors" varchar,
"cf_external_reference_id" varchar,
"cf_special_instructionsnotes" varchar,
"cf_contract_term" varchar,
"cf_contract_start_date" timestamp,
"cf_portal_admin_direct_trac_id_packflat" varchar,
"cf_year_one_fee" decimal(36,6),
"cf_year_eight_fee" decimal(36,6),
"cf_year_five_fee" decimal(36,6),
"cf_year_four_fee" decimal(36,6),
"cf_year_nine_fee" decimal(36,6),
"cf_year_seven_fee" decimal(36,6),
"cf_year_six_fee" decimal(36,6),
"cf_year_three_fee" decimal(36,6),
"cf_year_two_fee" decimal(36,6),
"cf_payment_terms" varchar,
"cf_order_id_to_renew" varchar,
"cf_premium_support" varchar,
"cf_tss_support" varchar,
"cf_bold_tenant_id_or_portal_name" varchar,
"cf_account_name" varchar,
"cf_associated_dt_order" varchar,
"cf_current_opportunity_stage" varchar,
"cf_order_visual_compliance_run" timestamp,
"cf_reseller" varchar,
"cf_portal_admin_country" varchar,
"cf_portal_admin_full_name_packflat" varchar,
"cf_contracted_amount_reseller_orders" decimal(36,6),
"cf_application_name" varchar,
"cf_main_project_contact_full_name" varchar,
"cf_optional_renewal_years" int[],
"cf_official_company_name" varchar,
"cf_end_user_1_direct_trac_id" varchar,
"cf_end_user_4_full_name" varchar,
"cf_end_user_2_full_name" varchar,
"cf_end_user_3_full_name" varchar,
"cf_end_user_5_full_name" varchar,
"cf_end_user_3_direct_trac_id" varchar,
"cf_end_user_2_direct_trac_id" varchar,
"cf_end_user_4_direct_trac_id" varchar,
"cf_end_user_5_direct_trac_id" varchar,
"cf_main_project_contact_direct_trac_id" varchar,
"cf_bill_toap_dt_customer_id" varchar,
"cf_taxvat_id" varchar,
"cf_po_number" varchar,
"cf_enterpriseportal_id" varchar,
"cf_contract_signatory_full_name" varchar,
"cf_contract_signatory_dt_customer_id" varchar,
"cf_end_user_1_full_name" varchar,
"cf_next_renewal_date" timestamp,
"cf_is_there_a_reseller_involved" varchar,
"cf_is_this_an_upgrade" varchar,
"cf_license_type" varchar,
"cf_portal_admin_time_zone" varchar,
"cf_are_vendor_forms_needed" varchar,
"cf_secondary_email" varchar,
"cf_submitted_to_fully_execute" varchar,
"cf_agreement_fully_executed" varchar,
"cf_bold_referral_partner_status" varchar,
"cf_microsoft_mvp" varchar,
"cf_microsoft_mvp_profile_url" varchar,
"cf_billing_street" varchar,
"cf_billing_state" varchar,
"cf_billing_city" varchar,
"cf_billing_postal_code" varchar,
"cf_mailing_street" varchar,
"cf_mailing_state" varchar,
"cf_mailing_city" varchar,
"cf_mailing_postal_code" varchar,
"contactPhoneNo" varchar,
"contactMobileNo" varchar,
"contactJobTitle" varchar,
"contactGroup" varchar,
"contactNotes" varchar,
"contactGroupAccessScopeId" varchar,
"contactExternalReferenceId" varchar,
"contactTag" varchar,
"timeZoneId" varchar,
"contactDisplayName" varchar,
"emailId" varchar,
"contactAddress" varchar)
LEFT Join (SELECT rsu.id,
    rsu.emailaddress,
  
    rdudesig.designation AS "Opportunity Owner Designation",
    rdusrole.role AS "Opportunity Owner Role",
    rdudept.department AS "Opportunity Owner Department",
    rduws.workstation AS "Opportunity Owner Workstation",
    rdudv.division AS "Opportunity Owner Division",
   
    rsu.relieveddate AS "User End Date",
   
    NULL::text AS "Opportunity Owner : Manager",
    NULL::text AS isreportingpersonasmaanager,
    NULL::text AS "Opportunity Owner : Reporting Person"
   FROM rdu_salesusers rsu   
     LEFT JOIN rdu_salesdesignations rdudesig ON rdudesig.id = rsu.designationid
     LEFT JOIN rdu_salesroles rdusrole ON rdusrole.id = rsu.roleid
     LEFT JOIN rdu_salesdepartments rdudept ON rdudept.id = rsu.departmentid
     LEFT JOIN rdu_salesworkstations rduws ON rduws.id = rsu.workstationid
     LEFT JOIN rdu_salesdivisions rdudv ON rdudv.id = rsu.divisionid
) rdu on ticket_detail.email = rdu.emailaddress ;

	end;
$BODY$;

ALTER FUNCTION public.get_ticket_detail2(character varying)
    OWNER TO bolddeskuser;
