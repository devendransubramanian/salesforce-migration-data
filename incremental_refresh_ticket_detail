-- PROCEDURE: public.incremental_refresh_ticket_detail(character varying)

-- DROP PROCEDURE IF EXISTS public.incremental_refresh_ticket_detail(character varying);

CREATE OR REPLACE PROCEDURE public.incremental_refresh_ticket_detail(
	INOUT records character varying)
LANGUAGE 'plpgsql'
AS $BODY$

DECLARE
  

last_modified_colum_td timestamp with time zone;
 newids bigint[];
 _id bigint;
 reclen varchar;
BEGIN
select max(last_modified_on) into last_modified_colum_td from ticket_detail;
raise notice 'data modified column in  ticket detail %', last_modified_colum_td;
newids := ARRAY(
select  id  from  public.dblink(
'host=35.236.243.204 port=5432 user=salesopreaduser password=b9c!l9M4#zQ dbname=org-538',
	format('Select distinct id from ticket_detail where last_modified_on > %L ',last_modified_colum_td))
	as t(id bigint)
	);
	reclen := array_length(newids,1)::varchar;
	records := 'Records updated; Count - ' || reclen;
	raise notice 'Fetch new id Completed time %', transaction_timestamp();
	IF array_length(newids,1) >= 1 THEN
	raise notice '%', array_to_string(newids,',');
   
 
INSERT INTO public.ticket_detail ("id","org_id","brand_id","org_brand_id","brand_name","Opportunity Name","is_visible_in_customer_portal","requested_by","requester","assigned_to_user_id","assignee","AR Rep","assigned_to_group_id","group","contact_group_id","contact_group","resolution_due_on","ticket_status_id","status","ticket_source_id","source","update_count","note_count","attachment_count","work_log_count","total_time_logged","total_billable_time_logged","first_response_due_on","next_response_due_on","last_replied_on","last_replied_by_id","last_replied_by","last_replied_by_user_type_id","last_replied_by_user_type","closed_on","closed_by","closed_by_name","created_on","created_by","creator","last_modified_on","last_modified_by","Last Modified By","is_spam","is_active","tsv","is_resolution_date_modified","last_status_changed_on","is_first_response_updated","ticket_type_option_id","ticket_category_option_id","ticket_priority_id","priority","Account Name","subject","type","category","email","OpportunityOwner","time_spent","unique_external_reference_id","agentid","isnotesprivate","notetype","assigned","cf_amount","cf_opp_dt_order_id","cf_link_to_bold_order","cf_expected_payment_date","cf_group_car_rep","cf_secondary_lead_source","cf_contract_renewal_date","cf_contract_renewal_amount","cf_reinstate_reason","cf_last_crr_rep_contact","cf_country","cf_date_reviewed","cf_nonrenewal_reason","cf_cleared_by_jv","cf_order_sheet_status")
SELECT * from public.get_ticket_detail3(
	array_to_string(newids,',')
)
ON CONFLICT ("id") 
DO 
   UPDATE SET "id"=EXCLUDED."id","org_id"=EXCLUDED."org_id","brand_id"=EXCLUDED."brand_id","org_brand_id"=EXCLUDED."org_brand_id","brand_name"=EXCLUDED."brand_name","Opportunity Name"=EXCLUDED."Opportunity Name","is_visible_in_customer_portal"=EXCLUDED."is_visible_in_customer_portal","requested_by"=EXCLUDED."requested_by","requester"=EXCLUDED."requester","assigned_to_user_id"=EXCLUDED."assigned_to_user_id","assignee"=EXCLUDED."assignee","AR Rep"=EXCLUDED."AR Rep","assigned_to_group_id"=EXCLUDED."assigned_to_group_id","group"=EXCLUDED."group","contact_group_id"=EXCLUDED."contact_group_id","contact_group"=EXCLUDED."contact_group","resolution_due_on"=EXCLUDED."resolution_due_on","ticket_status_id"=EXCLUDED."ticket_status_id","status"=EXCLUDED."status","ticket_source_id"=EXCLUDED."ticket_source_id","source"=EXCLUDED."source","update_count"=EXCLUDED."update_count","note_count"=EXCLUDED."note_count","attachment_count"=EXCLUDED."attachment_count","work_log_count"=EXCLUDED."work_log_count","total_time_logged"=EXCLUDED."total_time_logged","total_billable_time_logged"=EXCLUDED."total_billable_time_logged","first_response_due_on"=EXCLUDED."first_response_due_on","next_response_due_on"=EXCLUDED."next_response_due_on","last_replied_on"=EXCLUDED."last_replied_on","last_replied_by_id"=EXCLUDED."last_replied_by_id","last_replied_by"=EXCLUDED."last_replied_by","last_replied_by_user_type_id"=EXCLUDED."last_replied_by_user_type_id","last_replied_by_user_type"=EXCLUDED."last_replied_by_user_type","closed_on"=EXCLUDED."closed_on","closed_by"=EXCLUDED."closed_by","closed_by_name"=EXCLUDED."closed_by_name","created_on"=EXCLUDED."created_on","created_by"=EXCLUDED."created_by","creator"=EXCLUDED."creator","last_modified_on"=EXCLUDED."last_modified_on","last_modified_by"=EXCLUDED."last_modified_by","Last Modified By"=EXCLUDED."Last Modified By","is_spam"=EXCLUDED."is_spam","is_active"=EXCLUDED."is_active","tsv"=EXCLUDED."tsv","is_resolution_date_modified"=EXCLUDED."is_resolution_date_modified","last_status_changed_on"=EXCLUDED."last_status_changed_on","is_first_response_updated"=EXCLUDED."is_first_response_updated","ticket_type_option_id"=EXCLUDED."ticket_type_option_id","ticket_category_option_id"=EXCLUDED."ticket_category_option_id","ticket_priority_id"=EXCLUDED."ticket_priority_id","priority"=EXCLUDED."priority","Account Name"=EXCLUDED."Account Name","subject"=EXCLUDED."subject","type"=EXCLUDED."type","category"=EXCLUDED."category","email"=EXCLUDED."email","OpportunityOwner"=EXCLUDED."OpportunityOwner","time_spent"=EXCLUDED."time_spent","unique_external_reference_id"=EXCLUDED."unique_external_reference_id","agentid"=EXCLUDED."agentid","isnotesprivate"=EXCLUDED."isnotesprivate","notetype"=EXCLUDED."notetype","assigned"=EXCLUDED."assigned","cf_amount"=EXCLUDED."cf_amount","cf_opp_dt_order_id"=EXCLUDED."cf_opp_dt_order_id","cf_link_to_bold_order"=EXCLUDED."cf_link_to_bold_order","cf_expected_payment_date"=EXCLUDED."cf_expected_payment_date","cf_group_car_rep"=EXCLUDED."cf_group_car_rep","cf_secondary_lead_source"=EXCLUDED."cf_secondary_lead_source","cf_contract_renewal_date"=EXCLUDED."cf_contract_renewal_date","cf_contract_renewal_amount"=EXCLUDED."cf_contract_renewal_amount","cf_reinstate_reason"=EXCLUDED."cf_reinstate_reason","cf_last_crr_rep_contact"=EXCLUDED."cf_last_crr_rep_contact","cf_country"=EXCLUDED."cf_country","cf_date_reviewed"=EXCLUDED."cf_date_reviewed","cf_nonrenewal_reason"=EXCLUDED."cf_nonrenewal_reason","cf_cleared_by_jv"=EXCLUDED."cf_cleared_by_jv","cf_order_sheet_status"=EXCLUDED."cf_order_sheet_status";
   
   
   update ticket_detail set 
   "cf_case_number"=subquery."cf_case_number","cf_downloaded_date"=subquery."cf_downloaded_date","cf_key_order_issue"=subquery."cf_key_order_issue","cf_term_12_months"=subquery."cf_term_12_months","cf_date_moved_to_not_renewing"=subquery."cf_date_moved_to_not_renewing","cf_adobe_sign_exp_date"=subquery."cf_adobe_sign_exp_date","cf_next_cl_contact"=subquery."cf_next_cl_contact","cf__of_years_in_next_payment_term"=subquery."cf__of_years_in_next_payment_term","cf__of_years_in_previous_payment_term"=subquery."cf__of_years_in_previous_payment_term","cf_ap_processed_alliance_fee"=subquery."cf_ap_processed_alliance_fee","cf_days_to_pay_alliance_partner"=subquery."cf_days_to_pay_alliance_partner","cf_alliance_fee_tier"=subquery."cf_alliance_fee_tier","cf_alliance_partner_order_status"=subquery."cf_alliance_partner_order_status","cf_biz_dev_reviewed"=subquery."cf_biz_dev_reviewed","cf_csr_returned_for_correction"=subquery."cf_csr_returned_for_correction","cf_dt_expiration_date"=subquery."cf_dt_expiration_date","cf_original_license_type"=subquery."cf_original_license_type","cf_opp_alliance_partner"=subquery."cf_opp_alliance_partner","cf_return_details"=subquery."cf_return_details","cf_original_closedwon_date"=subquery."cf_original_closedwon_date","cf_current_subscription_term"=subquery."cf_current_subscription_term","cf_last_customer_contact"=subquery."cf_last_customer_contact","cf_opportunity_name"=subquery."cf_opportunity_name","cf_lead_source"=subquery."cf_lead_source","cf_next_ar_contact"=subquery."cf_next_ar_contact","cf_opp_presale_contract_request"=subquery."cf_opp_presale_contract_request","cf_end_date"=subquery."cf_end_date","cf_ren_audit_review"=subquery."cf_ren_audit_review","cf_counsel_reviewed"=subquery."cf_counsel_reviewed","cf_flagged_by_mahas_team"=subquery."cf_flagged_by_mahas_team","cf_submitted_for_approval"=subquery."cf_submitted_for_approval","cf_order_reviewed_by"=subquery."cf_order_reviewed_by","cf_group_account_name"=subquery."cf_group_account_name","cf_payment_frequency"=subquery."cf_payment_frequency","cf_submitted_to_counsel_review"=subquery."cf_submitted_to_counsel_review","cf_2nd_contact_date"=subquery."cf_2nd_contact_date","cf_case_type"=subquery."cf_case_type","cf_return_notes"=subquery."cf_return_notes","cf_engagement_status"=subquery."cf_engagement_status","cf_product"=subquery."cf_product","cf_review_link"=subquery."cf_review_link","cf_contract_license_ordered"=subquery."cf_contract_license_ordered","cf_ar_license_ordered"=subquery."cf_ar_license_ordered","cf_opp_has_problematic_pricing"=subquery."cf_opp_has_problematic_pricing","cf_renewal_amount_this_year"=subquery."cf_renewal_amount_this_year","cf_days_since_contact"=subquery."cf_days_since_contact","cf_my_call_list_est"=subquery."cf_my_call_list_est","cf_order_sheet_name"=subquery."cf_order_sheet_name","cf_date_signed_by_syncfusion"=subquery."cf_date_signed_by_syncfusion","cf_invoice_due_date"=subquery."cf_invoice_due_date","cf_return_identified_by"=subquery."cf_return_identified_by","cf_contract_sent"=subquery."cf_contract_sent","cf_paralegal_contracts_to_returncancel"=subquery."cf_paralegal_contracts_to_returncancel","cf_total_contract_amount"=subquery."cf_total_contract_amount","cf_order_sheet_incomplete"=subquery."cf_order_sheet_incomplete","cf_salescr_action_needed"=subquery."cf_salescr_action_needed","cf_link_to_return_opportunity"=subquery."cf_link_to_return_opportunity","cf_company"=subquery."cf_company","cf_opportunity_category"=subquery."cf_opportunity_category","cf_product_or_plan"=subquery."cf_product_or_plan","cf_revenue_type"=subquery."cf_revenue_type","cf_call_country"=subquery."cf_call_country","cf_last_renewal_order_id"=subquery."cf_last_renewal_order_id","cf_demo_scheduled"=subquery."cf_demo_scheduled","cf_reason_lost_comments"=subquery."cf_reason_lost_comments","cf_opportunity_source"=subquery."cf_opportunity_source","cf_download_country"=subquery."cf_download_country","cf_reason_lost"=subquery."cf_reason_lost","cf_alliance_partner_status"=subquery."cf_alliance_partner_status","cf_customerid"=subquery."cf_customerid","cf_no_of_order_sheets_in_opp"=subquery."cf_no_of_order_sheets_in_opp","cf_previous_dt_order_amount"=subquery."cf_previous_dt_order_amount","cf_manager_at_time_of_sale"=subquery."cf_manager_at_time_of_sale","cf_department"=subquery."cf_department","cf_known_company_url"=subquery."cf_known_company_url","cf_secondary_ap_contact"=subquery."cf_secondary_ap_contact","cf_is_invoice_collectible"=subquery."cf_is_invoice_collectible","cf_problematic_pricing_acct"=subquery."cf_problematic_pricing_acct" ,cf_tier_1_country_code=subquery.cf_tier_1_country_code
   
   from (
   SELECT * from public.get_ticket_detail5(
	array_to_string(newids,',')
) )subquery
where ticket_detail.id=subquery.id;
update ticket_detail set "Opportunity Owner Designation"=subquery."Opportunity Owner Designation","Opportunity Owner Role"=subquery."Opportunity Owner Role","Opportunity Owner Department"=subquery."Opportunity Owner Department","Opportunity Owner Workstation"=subquery."Opportunity Owner Workstation","Opportunity Owner Division"=subquery."Opportunity Owner Division","Opportunity Owner : Active"=subquery."Opportunity Owner : Active","Opportunity Owner : Manager"=subquery."Opportunity Owner : Manager","isreportingpersonasmaanager"=subquery."isreportingpersonasmaanager","Opportunity Owner : Reporting Person"=subquery."Opportunity Owner : Reporting Person","User End Date"=subquery."User End Date","Opportunity Owner IsActive"=subquery."Opportunity Owner IsActive","Car_Rep_Contact"=subquery."Car_Rep_Contact",
  
	"cf_completed_datetime"=subquery."cf_completed_datetime",
"cf_reminder_set"=subquery."cf_reminder_set",
"cf_task_type"=subquery."cf_task_type",
"cf_task_status"=subquery."cf_task_status",
"cf_task_record_type"=subquery."cf_task_record_type",
"cf_related_to"=subquery."cf_related_to",
"cf_reseller_amount"=subquery."cf_reseller_amount",
"cf_bold_referral_partner"=subquery."cf_bold_referral_partner",
"cf_projectdivision_name"=subquery."cf_projectdivision_name",
"cf_include_third_party_contractors"=subquery."cf_include_third_party_contractors",
"cf_external_reference_id"=subquery."cf_external_reference_id",
"cf_special_instructionsnotes"=subquery."cf_special_instructionsnotes",
"cf_contract_term"=subquery."cf_contract_term",
"cf_contract_start_date"=subquery."cf_contract_start_date",
"cf_portal_admin_direct_trac_id_packflat"=subquery."cf_portal_admin_direct_trac_id_packflat",
"cf_year_one_fee"=subquery."cf_year_one_fee",
"cf_year_eight_fee"=subquery."cf_year_eight_fee",
"cf_year_five_fee"=subquery."cf_year_five_fee",
"cf_year_four_fee"=subquery."cf_year_four_fee",
"cf_year_nine_fee"=subquery."cf_year_nine_fee",
"cf_year_seven_fee"=subquery."cf_year_seven_fee",
"cf_year_six_fee"=subquery."cf_year_six_fee",
"cf_year_three_fee"=subquery."cf_year_three_fee",
"cf_year_two_fee"=subquery."cf_year_two_fee",
"cf_payment_terms"=subquery."cf_payment_terms",
"cf_order_id_to_renew" =subquery."cf_order_id_to_renew" ,
"cf_premium_support"=subquery."cf_premium_support",
"cf_tss_support"=subquery."cf_tss_support",
"cf_bold_tenant_id_or_portal_name"=subquery."cf_bold_tenant_id_or_portal_name",
"cf_account_name"=subquery."cf_account_name",
"cf_associated_dt_order" =subquery."cf_associated_dt_order" ,
"cf_current_opportunity_stage" =subquery."cf_current_opportunity_stage" ,
"cf_order_visual_compliance_run" =subquery."cf_order_visual_compliance_run" ,
"cf_reseller" =subquery."cf_reseller" ,
"cf_portal_admin_country" =subquery."cf_portal_admin_country" ,
"cf_portal_admin_full_name_packflat" =subquery."cf_portal_admin_full_name_packflat" ,
"cf_contracted_amount_reseller_orders" =subquery."cf_contracted_amount_reseller_orders" ,
"cf_application_name" =subquery."cf_application_name" ,
"cf_main_project_contact_full_name" =subquery."cf_main_project_contact_full_name" ,
"cf_optional_renewal_years" =subquery."cf_optional_renewal_years" ,
"cf_official_company_name" =subquery."cf_official_company_name" ,
"cf_end_user_1_direct_trac_id" =subquery."cf_end_user_1_direct_trac_id" ,
"cf_end_user_4_full_name" =subquery."cf_end_user_4_full_name" ,
"cf_end_user_2_full_name" =subquery."cf_end_user_2_full_name" ,
"cf_end_user_3_full_name" =subquery."cf_end_user_3_full_name" ,
"cf_end_user_5_full_name" =subquery."cf_end_user_5_full_name" ,
"cf_end_user_3_direct_trac_id" =subquery."cf_end_user_3_direct_trac_id" ,
"cf_end_user_2_direct_trac_id" =subquery."cf_end_user_2_direct_trac_id" ,
"cf_end_user_4_direct_trac_id" =subquery."cf_end_user_4_direct_trac_id" ,
"cf_end_user_5_direct_trac_id" =subquery."cf_end_user_5_direct_trac_id" ,
"cf_main_project_contact_direct_trac_id" =subquery."cf_main_project_contact_direct_trac_id" ,
"cf_bill_toap_dt_customer_id" =subquery."cf_bill_toap_dt_customer_id" ,
"cf_taxvat_id" =subquery."cf_taxvat_id" ,
"cf_po_number" =subquery."cf_po_number" ,
"cf_enterpriseportal_id" =subquery."cf_enterpriseportal_id" ,
"cf_contract_signatory_full_name" =subquery."cf_contract_signatory_full_name" ,
"cf_contract_signatory_dt_customer_id" =subquery."cf_contract_signatory_dt_customer_id" ,
"cf_end_user_1_full_name" =subquery."cf_end_user_1_full_name" ,
"cf_next_renewal_date" =subquery."cf_next_renewal_date" ,
"cf_is_there_a_reseller_involved" =subquery."cf_is_there_a_reseller_involved" ,
"cf_is_this_an_upgrade" =subquery."cf_is_this_an_upgrade" ,
"cf_license_type" =subquery."cf_license_type" ,
"cf_portal_admin_time_zone" =subquery."cf_portal_admin_time_zone" ,
"cf_are_vendor_forms_needed" =subquery."cf_are_vendor_forms_needed" ,
"cf_secondary_email" =subquery."cf_secondary_email" ,
"cf_submitted_to_fully_execute" =subquery."cf_submitted_to_fully_execute" ,
"cf_agreement_fully_executed" =subquery."cf_agreement_fully_executed" ,
"cf_bold_referral_partner_status" =subquery."cf_bold_referral_partner_status" ,
"cf_microsoft_mvp" =subquery."cf_microsoft_mvp" ,
"cf_microsoft_mvp_profile_url" =subquery."cf_microsoft_mvp_profile_url" ,
"cf_billing_street" =subquery."cf_billing_street" ,
"cf_billing_state" =subquery."cf_billing_state" ,
"cf_billing_city" =subquery."cf_billing_city" ,
"cf_billing_postal_code"=subquery."cf_billing_postal_code",
"cf_mailing_street"=subquery."cf_mailing_street",
"cf_mailing_state"=subquery."cf_mailing_state",
"cf_mailing_city"=subquery."cf_mailing_city",
"cf_mailing_postal_code"=subquery."cf_mailing_postal_code",
"contactPhoneNo"=subquery."contactPhoneNo",
"contactMobileNo"=subquery."contactMobileNo",
"contactJobTitle"=subquery."contactJobTitle",
"contactGroup"=subquery."contactGroup",
"contactNotes"=subquery."contactNotes",
"contactGroupAccessScopeId"=subquery."contactGroupAccessScopeId",
"contactExternalReferenceId"=subquery."contactExternalReferenceId",
"contactTag"=subquery."contactTag",
"timeZoneId"=subquery."timeZoneId",
"contactDisplayName"=subquery."contactDisplayName",
"emailId"=subquery."emailId",
"contactAddress"=subquery."contactAddress"
from (SELECT * from public.get_ticket_detail2(
	array_to_string(newids,','))) subquery
	where ticket_detail.id=subquery.id;

	
	
 update ticket_detail set 	
	"cf_pending_gdpr_deletion"=subquery."cf_pending_gdpr_deletion",
"cf_payment_profileid"=subquery."cf_payment_profileid",
"cf_no_sales_contact_date"=subquery."cf_no_sales_contact_date",
"cf_type"=subquery."cf_type",
"cf_contact_secondary_lead_source"=subquery."cf_contact_secondary_lead_source",
"cf_customer_profile_url"=subquery."cf_customer_profile_url",
"cf_billing_country"=subquery."cf_billing_country",
"cf_mailing_country"=subquery."cf_mailing_country",
"cf_contact_comments"=subquery."cf_contact_comments",
"cf_customer_profileid"=subquery."cf_customer_profileid",
"cf_contact_lead_category"=subquery."cf_contact_lead_category",
cf_days_support_remaining=subquery.cf_days_support_remaining,
cf_time_zone=subquery.cf_time_zone,
cf_timeline_needed=subquery.cf_timeline_needed,
cf_project_notes=subquery.cf_project_notes,
cf_support_end_date=subquery.cf_support_end_date,
cf_project_hourly_rate=subquery.cf_project_hourly_rate,
cf_dedicated_resource_rate=subquery.cf_dedicated_resource_rate,
cf_number_of_dedicated_resources=subquery.cf_number_of_dedicated_resources,
cf_dedicated_hours_details=subquery.cf_dedicated_hours_details,
cf_project_name=subquery.cf_project_name,
cf_dt_incident_id=subquery.cf_dt_incident_id,
cf_removal_letter_sent=subquery.cf_removal_letter_sent,
cf_cases_date_return_created=subquery.cf_cases_date_return_created,
cf_cs_rep=subquery.cf_cs_rep,
cf_tss_manager=subquery.cf_tss_manager,
cf_order_portal_admin_time_zone=subquery.cf_order_portal_admin_time_zone,
cf_bold_desk_links=subquery.cf_bold_desk_links,
description=subquery.description,
cf_resolution_description=subquery.cf_resolution_description,
cf_case_boldbi_tenant_id=subquery.cf_case_boldbi_tenant_id,
cf_reg_meeting_scheduled=subquery.cf_reg_meeting_scheduled,
cf_quote_line_items=subquery.cf_quote_line_items,
cf_quote_number=subquery.cf_quote_number,
cf_expiration_date=subquery.cf_expiration_date,
cf_order_form_for=subquery.cf_order_form_for,
cf_net_amount=subquery.cf_net_amount,
cf_tax=subquery.cf_tax,
cf_grand_total=subquery.cf_grand_total,
cf_quote_name=subquery.cf_quote_name,
cf_bq_email=subquery.cf_bq_email,
cf_phone=subquery.cf_phone,
cf_fax=subquery.cf_fax,
cf_bq_status=subquery.cf_bq_status,
cf_contact_name=subquery.cf_contact_name,
cf_bill_to_name=subquery.cf_bill_to_name,
cf_ship_to_name=subquery.cf_ship_to_name,
cf_bq_billing_street=subquery.cf_bq_billing_street,
cf_bq_billing_city=subquery.cf_bq_billing_city,
cf_bq_billing_state=subquery.cf_bq_billing_state,
cf_bq_billing_country=subquery.cf_bq_billing_country,
cf_bq_billing_postal_code=subquery.cf_bq_billing_postal_code,
cf_bq_shipping_street=subquery.cf_bq_shipping_street,
cf_bq_shipping_city=subquery.cf_bq_shipping_city,
cf_bq_shipping_state=subquery.cf_bq_shipping_state,
cf_shipping_country=subquery.cf_shipping_country,
cf_shipping_postal_code=subquery.cf_shipping_postal_code,
cf_engagement_origin_field=subquery.cf_engagement_origin_field,
cf_1st_contact_method=subquery.cf_1st_contact_method,
cf_2nd_contact_method=subquery.cf_2nd_contact_method,
cf_3rd_contact_method=subquery.cf_3rd_contact_method,
cf_review_invoice_paid=subquery.cf_review_invoice_paid,
cf_contact_email=subquery.cf_contact_email,
cf_lead_email=subquery.cf_lead_email,
cf_control=subquery.cf_control,
cf_marketing_notes=subquery.cf_marketing_notes,
cf_link_to_previous_record=subquery.cf_link_to_previous_record,
cf_case_study_link=subquery.cf_case_study_link,
cf_review_confirmed=subquery.cf_review_confirmed,
cf_review_invoiced=subquery.cf_review_invoiced,
cf_business_program=subquery.cf_business_program,
cf_website=subquery.cf_website,
cf_no_sales_contact_customers=subquery.cf_no_sales_contact_customers,
cf_about_this_contact=subquery.cf_about_this_contact,
cf_client_download_country=subquery.cf_client_download_country,
cf_interaction_type=subquery.cf_interaction_type,
cf_client_boldbi_tenant_id=subquery.cf_client_boldbi_tenant_id,
cf_client_success_type=subquery.cf_client_success_type,
cf_interaction_status=subquery.cf_interaction_status,
cf_next_cs_followup=subquery.cf_next_cs_followup,
cf_last_contact_cs=subquery.cf_last_contact_cs,
cf_project_name_cst=subquery.cf_project_name_cst,
cf_license_status=subquery.cf_license_status,
cf_lead_sources=subquery.cf_lead_sources,
cf_client_secondary_lead_source=subquery.cf_client_secondary_lead_source,
cf_client_opportunity_source=subquery.cf_client_opportunity_source,
cf_client_secondary_opportunity_source=subquery.cf_client_secondary_opportunity_source,
cf_lead_category=subquery.cf_lead_category,
cf_ld_lead_source=subquery.cf_ld_lead_source,
cf_ld_secondary_lead_source=subquery.cf_ld_secondary_lead_source,
cf_lead_status=subquery.cf_lead_status,
cf_closed_to_contract_sent=subquery.cf_closed_to_contract_sent,
cf_company_name=subquery.cf_company_name,
cf_contract_license_type=subquery.cf_contract_license_type,
cf_name_of_projectdivision=subquery.cf_name_of_projectdivision,
cf_price_year_oneterm_one_amount=subquery.cf_price_year_oneterm_one_amount,
cf_net_terms=subquery.cf_net_terms,
cf_payment_type=subquery.cf_payment_type,
cf_renewal_terms_any_optional=subquery.cf_renewal_terms_any_optional,
cf_are_3rd_parties_included=subquery.cf_are_3rd_parties_included,
cf_user_count_limited_how_many=subquery.cf_user_count_limited_how_many,
cf_any_special_terms_details=subquery.cf_any_special_terms_details,
cf_boldsign_exp_date=subquery.cf_boldsign_exp_date,
cf_product_1_name=subquery.cf_product_1_name,
cf_eventual_monthly_payment=subquery.cf_eventual_monthly_payment
 from (SELECT * from public.get_ticket_detail6(
	array_to_string(newids,','))) subquery
	where ticket_detail.id=subquery.id;
update ticket_DEtail set "cf_renewal_status"=subquery."cf_renewal_status","cf_renewal_confirmation"=subquery."cf_renewal_confirmation","cf_contract_reviewed"=subquery."cf_contract_reviewed","cf_reason_returned"=subquery."cf_reason_returned","cf_resolution"=subquery."cf_resolution","cf_po_obtained_legal"=subquery."cf_po_obtained_legal","cf_contact_lead_source"=subquery."cf_contact_lead_source","cf_salescrr_issue_resolved"=subquery."cf_salescrr_issue_resolved","cf_primary_ap_contact"=subquery."cf_primary_ap_contact","cf_visual_compliance_run_by"=subquery."cf_visual_compliance_run_by","cf_crr_rep"=subquery."cf_crr_rep","cf_crr_corrections_required"=subquery."cf_crr_corrections_required","cf_returnrebook"=subquery."cf_returnrebook","cf_payment_confirmation_attached"=subquery."cf_payment_confirmation_attached","cf_tier_1_country_name"=subquery."cf_tier_1_country_name","cf_1st_contact_date"=subquery."cf_1st_contact_date","cf_email"=subquery."cf_email","cf_submitted_for_processing"=subquery."cf_submitted_for_processing","cf_rejected_to_rep"=subquery."cf_rejected_to_rep","cf_returned_for_corrections"=subquery."cf_returned_for_corrections","cf_order_sheet_processed"=subquery."cf_order_sheet_processed","cf_record_type"=subquery."cf_record_type","cf_upgrade_dollar_amount"=subquery."cf_upgrade_dollar_amount","cf_total_sale_amount"=subquery."cf_total_sale_amount","cf_month_one_amount"=subquery."cf_month_one_amount","cf_month_two_amount"=subquery."cf_month_two_amount","cf_month_three_amount"=subquery."cf_month_three_amount","cf_month_four_amount"=subquery."cf_month_four_amount","cf_month_five_amount"=subquery."cf_month_five_amount","cf_month_six_amount"=subquery."cf_month_six_amount","cf_month_seven_amount"=subquery."cf_month_seven_amount","cf_month_eight_amount"=subquery."cf_month_eight_amount","cf_month_nine_amount"=subquery."cf_month_nine_amount","cf_month_ten_amount"=subquery."cf_month_ten_amount","cf_month_eleven_amount"=subquery."cf_month_eleven_amount","cf_month_twelve_amount"=subquery."cf_month_twelve_amount","cf_fee_to_alliance_partner"=subquery."cf_fee_to_alliance_partner","cf_contract_status"=subquery."cf_contract_status","cf_3rd_contact_date"=subquery."cf_3rd_contact_date","cf_payment_method"=subquery."cf_payment_method","cf_bold_commissionable_amount"=subquery."cf_bold_commissionable_amount","cf_customer_invoice_details"=subquery."cf_customer_invoice_details","cf_stripe_order"=subquery."cf_stripe_order","cf_year_one_contract_amount"=subquery."cf_year_one_contract_amount","cf_case_resolution"=subquery."cf_case_resolution","cf_sales_admin_correction_requested"=subquery."cf_sales_admin_correction_requested","cf_date_agreement_effective"=subquery."cf_date_agreement_effective","cf_date_agreement_expires"=subquery."cf_date_agreement_expires","cf_date_sent_to_customer"=subquery."cf_date_sent_to_customer","cf_date_estimate_sent_to_customer"=subquery."cf_date_estimate_sent_to_customer","cf_date_signed_by_customer"=subquery."cf_date_signed_by_customer","cf_case_car_rep"=subquery."cf_case_car_rep","cf_crr_split_amount"=subquery."cf_crr_split_amount","cf_follow_up_date"=subquery."cf_follow_up_date","cf_outstanding_amount"=subquery."cf_outstanding_amount","cf_amount_collected_by_legal"=subquery."cf_amount_collected_by_legal","cf_payment_outcome"=subquery."cf_payment_outcome","cf_invoice_sent"=subquery."cf_invoice_sent","cf_contract_complete_or_closed"=subquery."cf_contract_complete_or_closed","cf_reason_for_no_contract"=subquery."cf_reason_for_no_contract","cf_payment_obtained_legal"=subquery."cf_payment_obtained_legal","cf_review_site"=subquery."cf_review_site","cf_order_info_needed"=subquery."cf_order_info_needed","cf_collection_legal_status"=subquery."cf_collection_legal_status","cf_last_collections_contact"=subquery."cf_last_collections_contact","cf_total_invoice_amount"=subquery."cf_total_invoice_amount","cf_salescr_action_type"=subquery."cf_salescr_action_type","cf_case_description"=subquery."cf_case_description","cf_date_sent_to_jv"=subquery."cf_date_sent_to_jv","cf_date_fully_executed"=subquery."cf_date_fully_executed","cf_90_days_support"=subquery."cf_90_days_support","cf_weekly_call_day"=subquery."cf_weekly_call_day","cf_last_ar_contact"=subquery."cf_last_ar_contact","cf_related_opp_account_name"=subquery."cf_related_opp_account_name","cf_related_opp_close_date"=subquery."cf_related_opp_close_date","cf_on_hold_details"=subquery."cf_on_hold_details"
 from (SELECT * from public.get_ticket_detail1(
	array_to_string(newids,','))) subquery
	where ticket_detail.id=subquery.id;
	
	
	
	update ticket_detail set "cf_responsible_for_inv"=subquery."cf_responsible_for_inv","cf_due_date"=subquery."cf_due_date","cf_status"=subquery."cf_status","cf_dt_order_id"=subquery."cf_dt_order_id","cf_salescrr_invoice_issue"=subquery."cf_salescrr_invoice_issue","cf_days_suppport_remaining"=subquery."cf_days_suppport_remaining","cf_alliance_partner"=subquery."cf_alliance_partner","cf_manager"=subquery."cf_manager","cf_visual_compliance_run"=subquery."cf_visual_compliance_run","cf_syncfusion_sales_rep"=subquery."cf_syncfusion_sales_rep","cf_absolute_revenue"=subquery."cf_absolute_revenue","cf_car_rep"=subquery."cf_car_rep","cf_next_contact_date"=subquery."cf_next_contact_date","cf_opportunity_amount"=subquery."cf_opportunity_amount","cf_task_subtype"=subquery."cf_task_subtype","cf_day_log"=subquery."cf_day_log","cf_time_activity_logged"=subquery."cf_time_activity_logged","cf_call_type"=subquery."cf_call_type","cf_call_result"=subquery."cf_call_result","cf_license_ordered"=subquery."cf_license_ordered","cf_presale_contract_request"=subquery."cf_presale_contract_request","cf_assigned_to"=subquery."cf_assigned_to","cf_ar_status"=subquery."cf_ar_status","cf_date_sent_to_legal"=subquery."cf_date_sent_to_legal","cf_order_entered"=subquery."cf_order_entered","cf_verified_return_in_dt"=subquery."cf_verified_return_in_dt","cf_confirmed_order_csr"=subquery."cf_confirmed_order_csr","cf_date_order_closed_paidret"=subquery."cf_date_order_closed_paidret","cf_discount"=subquery."cf_discount","cf_email_subject"=subquery."cf_email_subject","cf_salescrr_issue_type"=subquery."cf_salescrr_issue_type","cf_sales_rep_split_amount"=subquery."cf_sales_rep_split_amount","cf_cg_billing_postal_code"=subquery."cf_cg_billing_postal_code","cf_cg_known_company_url"=subquery."cf_cg_known_company_url","cf_problematic_pricing_opps"=subquery."cf_problematic_pricing_opps","cf_cg_billing_street"=subquery."cf_cg_billing_street","cf_cg_billing_city"=subquery."cf_cg_billing_city","cf_contact_license_type"=subquery."cf_contact_license_type","cf_group_billing_country"=subquery."cf_group_billing_country","cf_order_entered_by"=subquery."cf_order_entered_by","cf_reason_for_owner_change"=subquery."cf_reason_for_owner_change","cf_acct_has_problematic_pricing"=subquery."cf_acct_has_problematic_pricing","cf_opp_acct_has_problematic_pricing"=subquery."cf_opp_acct_has_problematic_pricing","cf_channel"=subquery."cf_channel","cf_csr_confirmed_alliance_order"=subquery."cf_csr_confirmed_alliance_order","cf_submitted_for_bd_review"=subquery."cf_submitted_for_bd_review","contactname"=subquery."contactname","Invoice Age"=subquery."Invoice Age","stage"=subquery."stage","Amount After Discount"=subquery."Amount After Discount","Days To Expiration"=subquery."Days To Expiration","Days To Payment"=subquery."Days To Payment","Days To Payment 2"=subquery."Days To Payment 2","Days To Invoice Payment"=subquery."Days To Invoice Payment","Days not renewing to closed"=subquery."Days not renewing to closed","Sales Admin Review Days"=subquery."Sales Admin Review Days","Close Date to Processed"=subquery."Close Date to Processed","Days to Process"=subquery."Days to Process","Close to Final CRRB Checks"=subquery."Close to Final CRRB Checks","Close vs. Exp date"=subquery."Close vs. Exp date","Days Since Close Date"=subquery."Days Since Close Date","Days Open"=subquery."Days Open","Absolute Close Won Date"=subquery."Absolute Close Won Date","Upgrade Amount"=subquery."Upgrade Amount","When was Alliance Partner Paid"=subquery."When was Alliance Partner Paid","Opportunity Age"=subquery."Opportunity Age","Bold Team"=subquery."Bold Team","Collections or AR?"=subquery."Collections or AR?","Call time"=subquery."Call time","Follow Up Type"=subquery."Follow Up Type","Contract Result"=subquery."Contract Result","Eligible for Contract"=subquery."Eligible for Contract","Contract"=subquery."Contract","CRRB Processing Time"=subquery."CRRB Processing Time","Days To Final CRRB Check"=subquery."Days To Final CRRB Check","Days to Process(str)"=subquery."Days to Process(str)","Invoice Age(Str)"=subquery."Invoice Age(Str)","Close to payment"=subquery."Close to payment","Eligible Date to Close"=subquery."Eligible Date to Close","DT Order Link"=subquery."DT Order Link","Tier 1 Region"=subquery."Tier 1 Region","Adjusted Projected REN"=subquery."Adjusted Projected REN","Percent Invoice Paid"=subquery."Percent Invoice Paid","Days to Submit Order"=subquery."Days to Submit Order","Days to Submit Order_bucket"=subquery."Days to Submit Order_bucket","Annualized Revenue"=subquery."Annualized Revenue","Closed By Expiration"=subquery."Closed By Expiration","Link to Next REN Opportunity"=subquery."Link to Next REN Opportunity","Link to Old REN Opportunity"=subquery."Link to Old REN Opportunity"
	
	from (SELECT * from public.get_ticket_detail4(
	array_to_string(newids,','))) subquery
	where ticket_detail.id=subquery.id;
   raise notice 'Ticket detail update  Completed time %', transaction_timestamp();
    update ticket_Detail
 set "sales/cr-notes-with-legal"=subquery."sales/cr-notes-with-legal",
    "cf_counsel_order_notes"=subquery."Counsel-Notes",
    "cf_notes_from_sales_leadership"=subquery."notes-from-sales-leadership",
    "cf_collections_legal_notes"=subquery."collections-legal-notes",
    "cf_ar_notes"=subquery."ar-notes",
    "cf_contract_retrieval_notes"=subquery."contract-retrieval-notes",
    "cf_ren_contract_notes"=subquery."REN-Contract-Notes",
   "cf_admin_internal_notes"= subquery."admin-internal-notes",
    "cf_paralegal_notes"=subquery."Paralegal-Notes",
    "cf_po_notes_legal"=subquery."po-notes-legal",
    "cf_collections_correspondence"=subquery."collections-correspondence",
    "cf_comments"=subquery."Comments",
    "cf_rep_notes"=subquery."Rep-Notes",
    "cf_notes_to_ar_manager"=subquery."Manager-Notes",
    "Closed-Lost-Qualification-Notes"=subquery."Closed-Lost-Qualification-Notes",
    "cf_order_evaluation_notes"=subquery."Order-Evaluation-Notes",
    "SE-Notes"=subquery."SE-Notes",
    "CR-Notes"=subquery."CR-Notes",
    "About-This-Opportunity"=subquery."About-This-Opportunity",
    "Sales-Leadership-Notes"=subquery."Sales-Leadership-Notes",
    "contract-notes"=subquery."contract-notes",
    "project-notes"=subquery."project-notes",
    "case-comments"=subquery."case-comments",
   notes= subquery.notes,
   "project-name-cst"=subquery."project-name-cst"
 from
 (
 SELECT t1.id,
    t1."sales/cr-notes-with-legal",
    case when t1."Counsel-Notes" is null then t1."counsel-notes" else t1."Counsel-Notes" end as "Counsel-Notes",
    t1."notes-from-sales-leadership",
    t1."collections-legal-notes",
    t1."ar-notes",
    t1."contract-retrieval-notes",
    case when t1."REN-Contract-Notes" is null then t1."ren-contract-notes" else t1."REN-Contract-Notes" end as "REN-Contract-Notes",
    t1."admin-internal-notes",
    case when t1."Paralegal-Notes" is null then "paralegal-notes" else t1."Paralegal-Notes" end as "Paralegal-Notes",
    t1."po-notes-legal",
    t1."collections-correspondence",
    case when t1."Comments" is null then t1."comments" else t1."Comments" end as "Comments",
    case when t1."Rep-Notes" is null then t1."rep-notes" else t1."Rep-Notes" end as "Rep-Notes",
    case when t1."Manager-Notes" is null then t1."manager-notes" else t1."Manager-Notes" end as "Manager-Notes",
    t1."Closed-Lost-Qualification-Notes",
    case when t1."Order-Evaluation-Notes" is null then t1."order-evaluation-notes" else t1."Order-Evaluation-Notes" end as "Order-Evaluation-Notes" ,
    case when t1."SE-Notes" is null then t1."se-notes" else t1."SE-Notes" end as "SE-Notes",
    case when t1."CR-Notes" is null then t1."cr-notes" else t1."CR-Notes" end as "CR-Notes",
    t1."About-This-Opportunity",
    case when t1."Sales-Leadership-Notes" is null then t1."sales-leadership-notes" else t1."Sales-Leadership-Notes" end as "Sales-Leadership-Notes" ,
    t1."contract-notes",
    t1."project-notes",
    t1."case-comments",
    t1.notes,
    t1."project-name-cst"
   FROM crosstab(format(' SELECT id, name,description
     FROM  (
     Select *

from public.dblink(
''host=35.236.243.204 port=5432 user=salesopreaduser password=b9c!l9M4#zQ dbname=org-538'',

 ''
		 select tu.ticket_id as id, tag.name::varchar as "name",tu.description::varchar from 
    (select * from public.ticket_update where ticket_id in (%s) ) tu  
    left join public.tag_mapper tm on tm.message_id = tu.id and tm.ticket_id is null  and tu.ticket_update_type_id !=1
    left join public.tag on tag.id=tm.tag_id

						and tag.id in
				 (2,27,4,5,6,7,26,73,25,12,13,16,17,18,19,20,21,22,28,53,74,35,37,36,33,
				8,11,9,29,31,1,34,30,32)'' ) as t(id bigint,name varchar,description varchar)
     order by id,name 
	 ) sub
   
   
   ',array_to_string(newids,',')), 'SELECT unnest(''{
sales/cr-notes-with-legal,Counsel-Notes,notes-from-sales-leadership,collections-legal-notes,
ar-notes,contract-retrieval-notes,REN-Contract-Notes,admin-internal-notes,Paralegal-Notes,
po-notes---legal,collections-correspondence,Comments,Rep-Notes,Manager-Notes,Closed-Lost-Qualification-Notes,
Order-Evaluation-Notes,SE-Notes,CR-Notes,Sales-Leadership-Notes,
About-This-Opportunity,contract-notes,project-notes,case-comments,
notes,project-name-cst,counsel-notes,ren-contract-notes,paralegal-notes,comments,
		rep-notes,
		manager-notes,
		order-evaluation-notes,
		se-notes,
		cr-notes,
		sales-leadership-notes}''::varchar[])')
	 t1(id bigint, "sales/cr-notes-with-legal" character varying, "Counsel-Notes" character varying, "notes-from-sales-leadership" character varying, "collections-legal-notes" character varying, "ar-notes" character varying, "contract-retrieval-notes" character varying, "REN-Contract-Notes" character varying, "admin-internal-notes" character varying, "Paralegal-Notes" character varying, "po-notes-legal" character varying, "collections-correspondence" character varying, "Comments" character varying, "Rep-Notes" character varying, "Manager-Notes" character varying, "Closed-Lost-Qualification-Notes" character varying, "Order-Evaluation-Notes" character varying, "SE-Notes" character varying, "CR-Notes" character varying, "Sales-Leadership-Notes" character varying, "About-This-Opportunity" character varying, "contract-notes" character varying, "project-notes" character varying, "case-comments" character varying, notes character varying, "project-name-cst" character varying
	   ,"counsel-notes" varchar,
"ren-contract-notes" varchar,
		"paralegal-notes" varchar,
		"comments" varchar,
		"rep-notes" varchar,
		"manager-notes" varchar,
		"order-evaluation-notes" varchar,
		"se-notes" varchar,
		"cr-notes" varchar,
		"sales-leadership-notes" varchar
	   ))
subquery
where ticket_detail.id=subquery.id;
   
 INSERT INTO public.parent_opp_ticket_detail (parentid,"id","org_id","brand_id","org_brand_id","brand_name","Opportunity Name","is_visible_in_customer_portal","requested_by","requester","assigned_to_user_id","assignee","AR Rep","assigned_to_group_id","group","contact_group_id","contact_group","resolution_due_on","ticket_status_id","status","ticket_source_id","source","update_count","note_count","attachment_count","work_log_count","total_time_logged","total_billable_time_logged","first_response_due_on","next_response_due_on","last_replied_on","last_replied_by_id","last_replied_by","last_replied_by_user_type_id","last_replied_by_user_type","closed_on","closed_by","closed_by_name","created_on","created_by","creator","last_modified_on","last_modified_by","Last Modified By","is_spam","is_active","tsv","is_resolution_date_modified","last_status_changed_on","is_first_response_updated","ticket_type_option_id","ticket_category_option_id","ticket_priority_id","priority","Account Name","subject","type","category","email","OpportunityOwner","time_spent","unique_external_reference_id","agentid","notes","isnotesprivate","notetype","assigned","cf_amount","cf_opp_dt_order_id","cf_link_to_bold_order","cf_expected_payment_date","cf_group_car_rep","cf_secondary_lead_source","cf_contract_renewal_date","cf_contract_renewal_amount","cf_reinstate_reason","cf_last_crr_rep_contact","cf_country","cf_date_reviewed","cf_nonrenewal_reason","cf_cleared_by_jv","cf_order_sheet_status","cf_case_number","cf_downloaded_date","cf_key_order_issue","cf_term_12_months","cf_date_moved_to_not_renewing","cf_adobe_sign_exp_date","cf_next_cl_contact","cf__of_years_in_next_payment_term","cf__of_years_in_previous_payment_term","cf_ap_processed_alliance_fee","cf_days_to_pay_alliance_partner","cf_alliance_fee_tier","cf_alliance_partner_order_status","cf_biz_dev_reviewed","cf_csr_returned_for_correction","cf_dt_expiration_date","cf_original_license_type","cf_opp_alliance_partner","cf_return_details","cf_original_closedwon_date","cf_current_subscription_term","cf_last_customer_contact","cf_opportunity_name","cf_lead_source","cf_next_ar_contact","cf_opp_presale_contract_request","cf_end_date","cf_ren_audit_review","cf_counsel_reviewed","cf_flagged_by_mahas_team","cf_submitted_for_approval","cf_order_reviewed_by","cf_group_account_name","cf_payment_frequency","cf_submitted_to_counsel_review","cf_2nd_contact_date","cf_case_type","cf_return_notes","cf_engagement_status","cf_product","cf_review_link","cf_contract_license_ordered","cf_ar_license_ordered","cf_opp_has_problematic_pricing","cf_renewal_amount_this_year","cf_days_since_contact","cf_my_call_list_est","cf_order_sheet_name","cf_date_signed_by_syncfusion","cf_invoice_due_date","cf_return_identified_by","cf_contract_sent","cf_paralegal_contracts_to_returncancel","cf_total_contract_amount","cf_order_sheet_incomplete","cf_salescr_action_needed","cf_link_to_return_opportunity","cf_company","cf_opportunity_category","cf_product_or_plan","cf_revenue_type","cf_call_country","cf_last_renewal_order_id","cf_demo_scheduled","cf_reason_lost_comments","cf_opportunity_source","cf_download_country","cf_reason_lost","cf_alliance_partner_status","cf_customerid","cf_no_of_order_sheets_in_opp","cf_previous_dt_order_amount","cf_manager_at_time_of_sale","cf_department","cf_known_company_url","cf_secondary_ap_contact","cf_is_invoice_collectible","cf_problematic_pricing_acct","cf_tier_1_country_code","cf_renewal_status","cf_renewal_confirmation","cf_contract_reviewed","cf_reason_returned","cf_resolution","cf_po_obtained_legal","cf_contact_lead_source","cf_salescrr_issue_resolved","cf_primary_ap_contact","cf_visual_compliance_run_by","cf_crr_rep","cf_crr_corrections_required","cf_returnrebook","cf_payment_confirmation_attached","cf_tier_1_country_name","cf_1st_contact_date","cf_email","cf_submitted_for_processing","cf_rejected_to_rep","cf_returned_for_corrections","cf_order_sheet_processed","cf_record_type","cf_upgrade_dollar_amount","cf_total_sale_amount","cf_month_one_amount","cf_month_two_amount","cf_month_three_amount","cf_month_four_amount","cf_month_five_amount","cf_month_six_amount","cf_month_seven_amount","cf_month_eight_amount","cf_month_nine_amount","cf_month_ten_amount","cf_month_eleven_amount","cf_month_twelve_amount","cf_fee_to_alliance_partner","cf_contract_status","cf_3rd_contact_date","cf_payment_method","cf_bold_commissionable_amount","cf_customer_invoice_details","cf_stripe_order","cf_year_one_contract_amount","cf_case_resolution","cf_sales_admin_correction_requested","cf_date_agreement_effective","cf_date_agreement_expires","cf_date_sent_to_customer","cf_date_estimate_sent_to_customer","cf_date_signed_by_customer","cf_case_car_rep","cf_crr_split_amount","cf_follow_up_date","cf_outstanding_amount","cf_amount_collected_by_legal","cf_payment_outcome","cf_invoice_sent","cf_contract_complete_or_closed","cf_reason_for_no_contract","cf_payment_obtained_legal","cf_review_site","cf_order_info_needed","cf_collection_legal_status","cf_last_collections_contact","cf_total_invoice_amount","cf_salescr_action_type","cf_case_description","cf_date_sent_to_jv","cf_date_fully_executed","cf_90_days_support","cf_weekly_call_day","cf_last_ar_contact","cf_related_opp_account_name","cf_related_opp_close_date","cf_on_hold_details","cf_responsible_for_inv","cf_due_date","cf_status","cf_dt_order_id","cf_salescrr_invoice_issue","cf_days_suppport_remaining","cf_alliance_partner","cf_manager","cf_visual_compliance_run","cf_syncfusion_sales_rep","cf_absolute_revenue","cf_car_rep","cf_next_contact_date","cf_opportunity_amount","cf_task_subtype","cf_day_log","cf_time_activity_logged","cf_call_type","cf_call_result","cf_license_ordered","cf_presale_contract_request","cf_assigned_to","cf_ar_status","cf_date_sent_to_legal","cf_order_entered","cf_verified_return_in_dt","cf_confirmed_order_csr","cf_date_order_closed_paidret","cf_discount","cf_email_subject","cf_salescrr_issue_type","cf_sales_rep_split_amount","cf_cg_billing_postal_code","cf_cg_known_company_url","cf_problematic_pricing_opps","cf_cg_billing_street","cf_cg_billing_city","cf_contact_license_type","cf_group_billing_country","cf_order_entered_by","cf_reason_for_owner_change","cf_acct_has_problematic_pricing","cf_opp_acct_has_problematic_pricing","cf_channel","cf_csr_confirmed_alliance_order","cf_submitted_for_bd_review","contactname","Invoice Age","stage","Amount After Discount","Days To Expiration","Days To Payment","Days To Payment 2","Days To Invoice Payment","Days not renewing to closed","Sales Admin Review Days","Close Date to Processed","Days to Process","Close to Final CRRB Checks","Close vs. Exp date","Days Since Close Date","Days Open","Absolute Close Won Date","Upgrade Amount","When was Alliance Partner Paid","Opportunity Age","Bold Team","Collections or AR?","Call time","Follow Up Type","Contract Result","Eligible for Contract","Contract","CRRB Processing Time","Days To Final CRRB Check","Days to Process(str)","Invoice Age(Str)","Close to payment","Eligible Date to Close","DT Order Link","Tier 1 Region","Adjusted Projected REN","Percent Invoice Paid","Days to Submit Order","Days to Submit Order_bucket","Annualized Revenue","Closed By Expiration","Link to Next REN Opportunity","Link to Old REN Opportunity","cf_ren_contract_notes","cf_collections_legal_notes","cf_ar_notes","cf_contract_retrieval_notes","cf_comments","cf_order_evaluation_notes","cf_counsel_order_notes","cf_notes_from_sales_leadership","cf_notes_to_ar_manager","cf_po_notes_legal","cf_collections_correspondence","cf_admin_internal_notes","cf_paralegal_notes","cf_rep_notes","Opportunity Owner Designation","Opportunity Owner Role","Opportunity Owner Department","Opportunity Owner Workstation","Opportunity Owner Division","Opportunity Owner : Active","Opportunity Owner : Manager","isreportingpersonasmaanager","Opportunity Owner : Reporting Person","User End Date","Opportunity Owner IsActive","Car_Rep_Contact"
											   ,"sales/cr-notes-with-legal",
	"Counsel-Notes",
	"Closed-Lost-Qualification-Notes" ,
	"SE-Notes",
	"CR-Notes",
	"Sales-Leadership-Notes",
	"About-This-Opportunity",
	"contract-notes",
	"project-notes",
	"case-comments",	
	"project-name-cst")
SELECT * from public.get_parent_oppticket_detail(
	array_to_string(newids,',')
)
ON CONFLICT ("parentid") 
DO 
   UPDATE SET "id"=EXCLUDED."id","org_id"=EXCLUDED."org_id","brand_id"=EXCLUDED."brand_id","org_brand_id"=EXCLUDED."org_brand_id","brand_name"=EXCLUDED."brand_name","Opportunity Name"=EXCLUDED."Opportunity Name","is_visible_in_customer_portal"=EXCLUDED."is_visible_in_customer_portal","requested_by"=EXCLUDED."requested_by","requester"=EXCLUDED."requester","assigned_to_user_id"=EXCLUDED."assigned_to_user_id","assignee"=EXCLUDED."assignee","AR Rep"=EXCLUDED."AR Rep","assigned_to_group_id"=EXCLUDED."assigned_to_group_id","group"=EXCLUDED."group","contact_group_id"=EXCLUDED."contact_group_id","contact_group"=EXCLUDED."contact_group","resolution_due_on"=EXCLUDED."resolution_due_on","ticket_status_id"=EXCLUDED."ticket_status_id","status"=EXCLUDED."status","ticket_source_id"=EXCLUDED."ticket_source_id","source"=EXCLUDED."source","update_count"=EXCLUDED."update_count","note_count"=EXCLUDED."note_count","attachment_count"=EXCLUDED."attachment_count","work_log_count"=EXCLUDED."work_log_count","total_time_logged"=EXCLUDED."total_time_logged","total_billable_time_logged"=EXCLUDED."total_billable_time_logged","first_response_due_on"=EXCLUDED."first_response_due_on","next_response_due_on"=EXCLUDED."next_response_due_on","last_replied_on"=EXCLUDED."last_replied_on","last_replied_by_id"=EXCLUDED."last_replied_by_id","last_replied_by"=EXCLUDED."last_replied_by","last_replied_by_user_type_id"=EXCLUDED."last_replied_by_user_type_id","last_replied_by_user_type"=EXCLUDED."last_replied_by_user_type","closed_on"=EXCLUDED."closed_on","closed_by"=EXCLUDED."closed_by","closed_by_name"=EXCLUDED."closed_by_name","created_on"=EXCLUDED."created_on","created_by"=EXCLUDED."created_by","creator"=EXCLUDED."creator","last_modified_on"=EXCLUDED."last_modified_on","last_modified_by"=EXCLUDED."last_modified_by","Last Modified By"=EXCLUDED."Last Modified By","is_spam"=EXCLUDED."is_spam","is_active"=EXCLUDED."is_active","tsv"=EXCLUDED."tsv","is_resolution_date_modified"=EXCLUDED."is_resolution_date_modified","last_status_changed_on"=EXCLUDED."last_status_changed_on","is_first_response_updated"=EXCLUDED."is_first_response_updated","ticket_type_option_id"=EXCLUDED."ticket_type_option_id","ticket_category_option_id"=EXCLUDED."ticket_category_option_id","ticket_priority_id"=EXCLUDED."ticket_priority_id","priority"=EXCLUDED."priority","Account Name"=EXCLUDED."Account Name","subject"=EXCLUDED."subject","type"=EXCLUDED."type","category"=EXCLUDED."category","email"=EXCLUDED."email","OpportunityOwner"=EXCLUDED."OpportunityOwner","time_spent"=EXCLUDED."time_spent","unique_external_reference_id"=EXCLUDED."unique_external_reference_id","agentid"=EXCLUDED."agentid","notes"=EXCLUDED."notes","isnotesprivate"=EXCLUDED."isnotesprivate","notetype"=EXCLUDED."notetype","assigned"=EXCLUDED."assigned","cf_amount"=EXCLUDED."cf_amount","cf_opp_dt_order_id"=EXCLUDED."cf_opp_dt_order_id","cf_link_to_bold_order"=EXCLUDED."cf_link_to_bold_order","cf_expected_payment_date"=EXCLUDED."cf_expected_payment_date","cf_group_car_rep"=EXCLUDED."cf_group_car_rep","cf_secondary_lead_source"=EXCLUDED."cf_secondary_lead_source","cf_contract_renewal_date"=EXCLUDED."cf_contract_renewal_date","cf_contract_renewal_amount"=EXCLUDED."cf_contract_renewal_amount","cf_reinstate_reason"=EXCLUDED."cf_reinstate_reason","cf_last_crr_rep_contact"=EXCLUDED."cf_last_crr_rep_contact","cf_country"=EXCLUDED."cf_country","cf_date_reviewed"=EXCLUDED."cf_date_reviewed","cf_nonrenewal_reason"=EXCLUDED."cf_nonrenewal_reason","cf_cleared_by_jv"=EXCLUDED."cf_cleared_by_jv","cf_order_sheet_status"=EXCLUDED."cf_order_sheet_status","cf_case_number"=EXCLUDED."cf_case_number","cf_downloaded_date"=EXCLUDED."cf_downloaded_date","cf_key_order_issue"=EXCLUDED."cf_key_order_issue","cf_term_12_months"=EXCLUDED."cf_term_12_months","cf_date_moved_to_not_renewing"=EXCLUDED."cf_date_moved_to_not_renewing","cf_adobe_sign_exp_date"=EXCLUDED."cf_adobe_sign_exp_date","cf_next_cl_contact"=EXCLUDED."cf_next_cl_contact","cf__of_years_in_next_payment_term"=EXCLUDED."cf__of_years_in_next_payment_term","cf__of_years_in_previous_payment_term"=EXCLUDED."cf__of_years_in_previous_payment_term","cf_ap_processed_alliance_fee"=EXCLUDED."cf_ap_processed_alliance_fee","cf_days_to_pay_alliance_partner"=EXCLUDED."cf_days_to_pay_alliance_partner","cf_alliance_fee_tier"=EXCLUDED."cf_alliance_fee_tier","cf_alliance_partner_order_status"=EXCLUDED."cf_alliance_partner_order_status","cf_biz_dev_reviewed"=EXCLUDED."cf_biz_dev_reviewed","cf_csr_returned_for_correction"=EXCLUDED."cf_csr_returned_for_correction","cf_dt_expiration_date"=EXCLUDED."cf_dt_expiration_date","cf_original_license_type"=EXCLUDED."cf_original_license_type","cf_opp_alliance_partner"=EXCLUDED."cf_opp_alliance_partner","cf_return_details"=EXCLUDED."cf_return_details","cf_original_closedwon_date"=EXCLUDED."cf_original_closedwon_date","cf_current_subscription_term"=EXCLUDED."cf_current_subscription_term","cf_last_customer_contact"=EXCLUDED."cf_last_customer_contact","cf_opportunity_name"=EXCLUDED."cf_opportunity_name","cf_lead_source"=EXCLUDED."cf_lead_source","cf_next_ar_contact"=EXCLUDED."cf_next_ar_contact","cf_opp_presale_contract_request"=EXCLUDED."cf_opp_presale_contract_request","cf_end_date"=EXCLUDED."cf_end_date","cf_ren_audit_review"=EXCLUDED."cf_ren_audit_review","cf_counsel_reviewed"=EXCLUDED."cf_counsel_reviewed","cf_flagged_by_mahas_team"=EXCLUDED."cf_flagged_by_mahas_team","cf_submitted_for_approval"=EXCLUDED."cf_submitted_for_approval","cf_order_reviewed_by"=EXCLUDED."cf_order_reviewed_by","cf_group_account_name"=EXCLUDED."cf_group_account_name","cf_payment_frequency"=EXCLUDED."cf_payment_frequency","cf_submitted_to_counsel_review"=EXCLUDED."cf_submitted_to_counsel_review","cf_2nd_contact_date"=EXCLUDED."cf_2nd_contact_date","cf_case_type"=EXCLUDED."cf_case_type","cf_return_notes"=EXCLUDED."cf_return_notes","cf_engagement_status"=EXCLUDED."cf_engagement_status","cf_product"=EXCLUDED."cf_product","cf_review_link"=EXCLUDED."cf_review_link","cf_contract_license_ordered"=EXCLUDED."cf_contract_license_ordered","cf_ar_license_ordered"=EXCLUDED."cf_ar_license_ordered","cf_opp_has_problematic_pricing"=EXCLUDED."cf_opp_has_problematic_pricing","cf_renewal_amount_this_year"=EXCLUDED."cf_renewal_amount_this_year","cf_days_since_contact"=EXCLUDED."cf_days_since_contact","cf_my_call_list_est"=EXCLUDED."cf_my_call_list_est","cf_order_sheet_name"=EXCLUDED."cf_order_sheet_name","cf_date_signed_by_syncfusion"=EXCLUDED."cf_date_signed_by_syncfusion","cf_invoice_due_date"=EXCLUDED."cf_invoice_due_date","cf_return_identified_by"=EXCLUDED."cf_return_identified_by","cf_contract_sent"=EXCLUDED."cf_contract_sent","cf_paralegal_contracts_to_returncancel"=EXCLUDED."cf_paralegal_contracts_to_returncancel","cf_total_contract_amount"=EXCLUDED."cf_total_contract_amount","cf_order_sheet_incomplete"=EXCLUDED."cf_order_sheet_incomplete","cf_salescr_action_needed"=EXCLUDED."cf_salescr_action_needed","cf_link_to_return_opportunity"=EXCLUDED."cf_link_to_return_opportunity","cf_company"=EXCLUDED."cf_company","cf_opportunity_category"=EXCLUDED."cf_opportunity_category","cf_product_or_plan"=EXCLUDED."cf_product_or_plan","cf_revenue_type"=EXCLUDED."cf_revenue_type","cf_call_country"=EXCLUDED."cf_call_country","cf_last_renewal_order_id"=EXCLUDED."cf_last_renewal_order_id","cf_demo_scheduled"=EXCLUDED."cf_demo_scheduled","cf_reason_lost_comments"=EXCLUDED."cf_reason_lost_comments","cf_opportunity_source"=EXCLUDED."cf_opportunity_source","cf_download_country"=EXCLUDED."cf_download_country","cf_reason_lost"=EXCLUDED."cf_reason_lost","cf_alliance_partner_status"=EXCLUDED."cf_alliance_partner_status","cf_customerid"=EXCLUDED."cf_customerid","cf_no_of_order_sheets_in_opp"=EXCLUDED."cf_no_of_order_sheets_in_opp","cf_previous_dt_order_amount"=EXCLUDED."cf_previous_dt_order_amount","cf_manager_at_time_of_sale"=EXCLUDED."cf_manager_at_time_of_sale","cf_department"=EXCLUDED."cf_department","cf_known_company_url"=EXCLUDED."cf_known_company_url","cf_secondary_ap_contact"=EXCLUDED."cf_secondary_ap_contact","cf_is_invoice_collectible"=EXCLUDED."cf_is_invoice_collectible","cf_problematic_pricing_acct"=EXCLUDED."cf_problematic_pricing_acct","cf_tier_1_country_code"=EXCLUDED."cf_tier_1_country_code","cf_renewal_status"=EXCLUDED."cf_renewal_status","cf_renewal_confirmation"=EXCLUDED."cf_renewal_confirmation","cf_contract_reviewed"=EXCLUDED."cf_contract_reviewed","cf_reason_returned"=EXCLUDED."cf_reason_returned","cf_resolution"=EXCLUDED."cf_resolution","cf_po_obtained_legal"=EXCLUDED."cf_po_obtained_legal","cf_contact_lead_source"=EXCLUDED."cf_contact_lead_source","cf_salescrr_issue_resolved"=EXCLUDED."cf_salescrr_issue_resolved","cf_primary_ap_contact"=EXCLUDED."cf_primary_ap_contact","cf_visual_compliance_run_by"=EXCLUDED."cf_visual_compliance_run_by","cf_crr_rep"=EXCLUDED."cf_crr_rep","cf_crr_corrections_required"=EXCLUDED."cf_crr_corrections_required","cf_returnrebook"=EXCLUDED."cf_returnrebook","cf_payment_confirmation_attached"=EXCLUDED."cf_payment_confirmation_attached","cf_tier_1_country_name"=EXCLUDED."cf_tier_1_country_name","cf_1st_contact_date"=EXCLUDED."cf_1st_contact_date","cf_email"=EXCLUDED."cf_email","cf_submitted_for_processing"=EXCLUDED."cf_submitted_for_processing","cf_rejected_to_rep"=EXCLUDED."cf_rejected_to_rep","cf_returned_for_corrections"=EXCLUDED."cf_returned_for_corrections","cf_order_sheet_processed"=EXCLUDED."cf_order_sheet_processed","cf_record_type"=EXCLUDED."cf_record_type","cf_upgrade_dollar_amount"=EXCLUDED."cf_upgrade_dollar_amount","cf_total_sale_amount"=EXCLUDED."cf_total_sale_amount","cf_month_one_amount"=EXCLUDED."cf_month_one_amount","cf_month_two_amount"=EXCLUDED."cf_month_two_amount","cf_month_three_amount"=EXCLUDED."cf_month_three_amount","cf_month_four_amount"=EXCLUDED."cf_month_four_amount","cf_month_five_amount"=EXCLUDED."cf_month_five_amount","cf_month_six_amount"=EXCLUDED."cf_month_six_amount","cf_month_seven_amount"=EXCLUDED."cf_month_seven_amount","cf_month_eight_amount"=EXCLUDED."cf_month_eight_amount","cf_month_nine_amount"=EXCLUDED."cf_month_nine_amount","cf_month_ten_amount"=EXCLUDED."cf_month_ten_amount","cf_month_eleven_amount"=EXCLUDED."cf_month_eleven_amount","cf_month_twelve_amount"=EXCLUDED."cf_month_twelve_amount","cf_fee_to_alliance_partner"=EXCLUDED."cf_fee_to_alliance_partner","cf_contract_status"=EXCLUDED."cf_contract_status","cf_3rd_contact_date"=EXCLUDED."cf_3rd_contact_date","cf_payment_method"=EXCLUDED."cf_payment_method","cf_bold_commissionable_amount"=EXCLUDED."cf_bold_commissionable_amount","cf_customer_invoice_details"=EXCLUDED."cf_customer_invoice_details","cf_stripe_order"=EXCLUDED."cf_stripe_order","cf_year_one_contract_amount"=EXCLUDED."cf_year_one_contract_amount","cf_case_resolution"=EXCLUDED."cf_case_resolution","cf_sales_admin_correction_requested"=EXCLUDED."cf_sales_admin_correction_requested","cf_date_agreement_effective"=EXCLUDED."cf_date_agreement_effective","cf_date_agreement_expires"=EXCLUDED."cf_date_agreement_expires","cf_date_sent_to_customer"=EXCLUDED."cf_date_sent_to_customer","cf_date_estimate_sent_to_customer"=EXCLUDED."cf_date_estimate_sent_to_customer","cf_date_signed_by_customer"=EXCLUDED."cf_date_signed_by_customer","cf_case_car_rep"=EXCLUDED."cf_case_car_rep","cf_crr_split_amount"=EXCLUDED."cf_crr_split_amount","cf_follow_up_date"=EXCLUDED."cf_follow_up_date","cf_outstanding_amount"=EXCLUDED."cf_outstanding_amount","cf_amount_collected_by_legal"=EXCLUDED."cf_amount_collected_by_legal","cf_payment_outcome"=EXCLUDED."cf_payment_outcome","cf_invoice_sent"=EXCLUDED."cf_invoice_sent","cf_contract_complete_or_closed"=EXCLUDED."cf_contract_complete_or_closed","cf_reason_for_no_contract"=EXCLUDED."cf_reason_for_no_contract","cf_payment_obtained_legal"=EXCLUDED."cf_payment_obtained_legal","cf_review_site"=EXCLUDED."cf_review_site","cf_order_info_needed"=EXCLUDED."cf_order_info_needed","cf_collection_legal_status"=EXCLUDED."cf_collection_legal_status","cf_last_collections_contact"=EXCLUDED."cf_last_collections_contact","cf_total_invoice_amount"=EXCLUDED."cf_total_invoice_amount","cf_salescr_action_type"=EXCLUDED."cf_salescr_action_type","cf_case_description"=EXCLUDED."cf_case_description","cf_date_sent_to_jv"=EXCLUDED."cf_date_sent_to_jv","cf_date_fully_executed"=EXCLUDED."cf_date_fully_executed","cf_90_days_support"=EXCLUDED."cf_90_days_support","cf_weekly_call_day"=EXCLUDED."cf_weekly_call_day","cf_last_ar_contact"=EXCLUDED."cf_last_ar_contact","cf_related_opp_account_name"=EXCLUDED."cf_related_opp_account_name","cf_related_opp_close_date"=EXCLUDED."cf_related_opp_close_date","cf_on_hold_details"=EXCLUDED."cf_on_hold_details","cf_responsible_for_inv"=EXCLUDED."cf_responsible_for_inv","cf_due_date"=EXCLUDED."cf_due_date","cf_status"=EXCLUDED."cf_status","cf_dt_order_id"=EXCLUDED."cf_dt_order_id","cf_salescrr_invoice_issue"=EXCLUDED."cf_salescrr_invoice_issue","cf_days_suppport_remaining"=EXCLUDED."cf_days_suppport_remaining","cf_alliance_partner"=EXCLUDED."cf_alliance_partner","cf_manager"=EXCLUDED."cf_manager","cf_visual_compliance_run"=EXCLUDED."cf_visual_compliance_run","cf_syncfusion_sales_rep"=EXCLUDED."cf_syncfusion_sales_rep","cf_absolute_revenue"=EXCLUDED."cf_absolute_revenue","cf_car_rep"=EXCLUDED."cf_car_rep","cf_next_contact_date"=EXCLUDED."cf_next_contact_date","cf_opportunity_amount"=EXCLUDED."cf_opportunity_amount","cf_task_subtype"=EXCLUDED."cf_task_subtype","cf_day_log"=EXCLUDED."cf_day_log","cf_time_activity_logged"=EXCLUDED."cf_time_activity_logged","cf_call_type"=EXCLUDED."cf_call_type","cf_call_result"=EXCLUDED."cf_call_result","cf_license_ordered"=EXCLUDED."cf_license_ordered","cf_presale_contract_request"=EXCLUDED."cf_presale_contract_request","cf_assigned_to"=EXCLUDED."cf_assigned_to","cf_ar_status"=EXCLUDED."cf_ar_status","cf_date_sent_to_legal"=EXCLUDED."cf_date_sent_to_legal","cf_order_entered"=EXCLUDED."cf_order_entered","cf_verified_return_in_dt"=EXCLUDED."cf_verified_return_in_dt","cf_confirmed_order_csr"=EXCLUDED."cf_confirmed_order_csr","cf_date_order_closed_paidret"=EXCLUDED."cf_date_order_closed_paidret","cf_discount"=EXCLUDED."cf_discount","cf_email_subject"=EXCLUDED."cf_email_subject","cf_salescrr_issue_type"=EXCLUDED."cf_salescrr_issue_type","cf_sales_rep_split_amount"=EXCLUDED."cf_sales_rep_split_amount","cf_cg_billing_postal_code"=EXCLUDED."cf_cg_billing_postal_code","cf_cg_known_company_url"=EXCLUDED."cf_cg_known_company_url","cf_problematic_pricing_opps"=EXCLUDED."cf_problematic_pricing_opps","cf_cg_billing_street"=EXCLUDED."cf_cg_billing_street","cf_cg_billing_city"=EXCLUDED."cf_cg_billing_city","cf_contact_license_type"=EXCLUDED."cf_contact_license_type","cf_group_billing_country"=EXCLUDED."cf_group_billing_country","cf_order_entered_by"=EXCLUDED."cf_order_entered_by","cf_reason_for_owner_change"=EXCLUDED."cf_reason_for_owner_change","cf_acct_has_problematic_pricing"=EXCLUDED."cf_acct_has_problematic_pricing","cf_opp_acct_has_problematic_pricing"=EXCLUDED."cf_opp_acct_has_problematic_pricing","cf_channel"=EXCLUDED."cf_channel","cf_csr_confirmed_alliance_order"=EXCLUDED."cf_csr_confirmed_alliance_order","cf_submitted_for_bd_review"=EXCLUDED."cf_submitted_for_bd_review","contactname"=EXCLUDED."contactname","Invoice Age"=EXCLUDED."Invoice Age","stage"=EXCLUDED."stage","Amount After Discount"=EXCLUDED."Amount After Discount","Days To Expiration"=EXCLUDED."Days To Expiration","Days To Payment"=EXCLUDED."Days To Payment","Days To Payment 2"=EXCLUDED."Days To Payment 2","Days To Invoice Payment"=EXCLUDED."Days To Invoice Payment","Days not renewing to closed"=EXCLUDED."Days not renewing to closed","Sales Admin Review Days"=EXCLUDED."Sales Admin Review Days","Close Date to Processed"=EXCLUDED."Close Date to Processed","Days to Process"=EXCLUDED."Days to Process","Close to Final CRRB Checks"=EXCLUDED."Close to Final CRRB Checks","Close vs. Exp date"=EXCLUDED."Close vs. Exp date","Days Since Close Date"=EXCLUDED."Days Since Close Date","Days Open"=EXCLUDED."Days Open","Absolute Close Won Date"=EXCLUDED."Absolute Close Won Date","Upgrade Amount"=EXCLUDED."Upgrade Amount","When was Alliance Partner Paid"=EXCLUDED."When was Alliance Partner Paid","Opportunity Age"=EXCLUDED."Opportunity Age","Bold Team"=EXCLUDED."Bold Team","Collections or AR?"=EXCLUDED."Collections or AR?","Call time"=EXCLUDED."Call time","Follow Up Type"=EXCLUDED."Follow Up Type","Contract Result"=EXCLUDED."Contract Result","Eligible for Contract"=EXCLUDED."Eligible for Contract","Contract"=EXCLUDED."Contract","CRRB Processing Time"=EXCLUDED."CRRB Processing Time","Days To Final CRRB Check"=EXCLUDED."Days To Final CRRB Check","Days to Process(str)"=EXCLUDED."Days to Process(str)","Invoice Age(Str)"=EXCLUDED."Invoice Age(Str)","Close to payment"=EXCLUDED."Close to payment","Eligible Date to Close"=EXCLUDED."Eligible Date to Close","DT Order Link"=EXCLUDED."DT Order Link","Tier 1 Region"=EXCLUDED."Tier 1 Region","Adjusted Projected REN"=EXCLUDED."Adjusted Projected REN","Percent Invoice Paid"=EXCLUDED."Percent Invoice Paid","Days to Submit Order"=EXCLUDED."Days to Submit Order","Days to Submit Order_bucket"=EXCLUDED."Days to Submit Order_bucket","Annualized Revenue"=EXCLUDED."Annualized Revenue","Closed By Expiration"=EXCLUDED."Closed By Expiration","Link to Next REN Opportunity"=EXCLUDED."Link to Next REN Opportunity","Link to Old REN Opportunity"=EXCLUDED."Link to Old REN Opportunity","cf_ren_contract_notes"=EXCLUDED."cf_ren_contract_notes","cf_collections_legal_notes"=EXCLUDED."cf_collections_legal_notes","cf_ar_notes"=EXCLUDED."cf_ar_notes","cf_contract_retrieval_notes"=EXCLUDED."cf_contract_retrieval_notes","cf_comments"=EXCLUDED."cf_comments","cf_order_evaluation_notes"=EXCLUDED."cf_order_evaluation_notes","cf_counsel_order_notes"=EXCLUDED."cf_counsel_order_notes","cf_notes_from_sales_leadership"=EXCLUDED."cf_notes_from_sales_leadership","cf_notes_to_ar_manager"=EXCLUDED."cf_notes_to_ar_manager","cf_po_notes_legal"=EXCLUDED."cf_po_notes_legal","cf_collections_correspondence"=EXCLUDED."cf_collections_correspondence","cf_admin_internal_notes"=EXCLUDED."cf_admin_internal_notes","cf_paralegal_notes"=EXCLUDED."cf_paralegal_notes","cf_rep_notes"=EXCLUDED."cf_rep_notes","Opportunity Owner Designation"=EXCLUDED."Opportunity Owner Designation","Opportunity Owner Role"=EXCLUDED."Opportunity Owner Role","Opportunity Owner Department"=EXCLUDED."Opportunity Owner Department","Opportunity Owner Workstation"=EXCLUDED."Opportunity Owner Workstation","Opportunity Owner Division"=EXCLUDED."Opportunity Owner Division","Opportunity Owner : Active"=EXCLUDED."Opportunity Owner : Active","Opportunity Owner : Manager"=EXCLUDED."Opportunity Owner : Manager","isreportingpersonasmaanager"=EXCLUDED."isreportingpersonasmaanager","Opportunity Owner : Reporting Person"=EXCLUDED."Opportunity Owner : Reporting Person","User End Date"=EXCLUDED."User End Date","Opportunity Owner IsActive"=EXCLUDED."Opportunity Owner IsActive","Car_Rep_Contact"=EXCLUDED."Car_Rep_Contact",
   "sales/cr-notes-with-legal" = EXCLUDED."sales/cr-notes-with-legal",
	"Counsel-Notes"= EXCLUDED."Counsel-Notes",
	"Closed-Lost-Qualification-Notes" = EXCLUDED."Closed-Lost-Qualification-Notes",
	"SE-Notes"=EXCLUDED."SE-Notes",
	"CR-Notes"=EXCLUDED."CR-Notes",
	"Sales-Leadership-Notes"=EXCLUDED."Sales-Leadership-Notes",
	"About-This-Opportunity"=EXCLUDED."About-This-Opportunity",
	"contract-notes"=EXCLUDED."contract-notes",
	"project-notes"=EXCLUDED."project-notes",
	"case-comments"=EXCLUDED."case-comments",	
	"project-name-cst"=EXCLUDED."project-name-cst";
	 raise notice 'PArent Opp Ticket detail update  Completed time %', transaction_timestamp();
  INSERT INTO public.child_ar_ticket_detail (parentid,"id","org_id","brand_id","org_brand_id","brand_name","Opportunity Name","is_visible_in_customer_portal","requested_by","requester","assigned_to_user_id","assignee","AR Rep","assigned_to_group_id","group","contact_group_id","contact_group","resolution_due_on","ticket_status_id","status","ticket_source_id","source","update_count","note_count","attachment_count","work_log_count","total_time_logged","total_billable_time_logged","first_response_due_on","next_response_due_on","last_replied_on","last_replied_by_id","last_replied_by","last_replied_by_user_type_id","last_replied_by_user_type","closed_on","closed_by","closed_by_name","created_on","created_by","creator","last_modified_on","last_modified_by","Last Modified By","is_spam","is_active","tsv","is_resolution_date_modified","last_status_changed_on","is_first_response_updated","ticket_type_option_id","ticket_category_option_id","ticket_priority_id","priority","Account Name","subject","type","category","email","OpportunityOwner","time_spent","unique_external_reference_id","agentid","notes","isnotesprivate","notetype","assigned","cf_amount","cf_opp_dt_order_id","cf_link_to_bold_order","cf_expected_payment_date","cf_group_car_rep","cf_secondary_lead_source","cf_contract_renewal_date","cf_contract_renewal_amount","cf_reinstate_reason","cf_last_crr_rep_contact","cf_country","cf_date_reviewed","cf_nonrenewal_reason","cf_cleared_by_jv","cf_order_sheet_status","cf_case_number","cf_downloaded_date","cf_key_order_issue","cf_term_12_months","cf_date_moved_to_not_renewing","cf_adobe_sign_exp_date","cf_next_cl_contact","cf__of_years_in_next_payment_term","cf__of_years_in_previous_payment_term","cf_ap_processed_alliance_fee","cf_days_to_pay_alliance_partner","cf_alliance_fee_tier","cf_alliance_partner_order_status","cf_biz_dev_reviewed","cf_csr_returned_for_correction","cf_dt_expiration_date","cf_original_license_type","cf_opp_alliance_partner","cf_return_details","cf_original_closedwon_date","cf_current_subscription_term","cf_last_customer_contact","cf_opportunity_name","cf_lead_source","cf_next_ar_contact","cf_opp_presale_contract_request","cf_end_date","cf_ren_audit_review","cf_counsel_reviewed","cf_flagged_by_mahas_team","cf_submitted_for_approval","cf_order_reviewed_by","cf_group_account_name","cf_payment_frequency","cf_submitted_to_counsel_review","cf_2nd_contact_date","cf_case_type","cf_return_notes","cf_engagement_status","cf_product","cf_review_link","cf_contract_license_ordered","cf_ar_license_ordered","cf_opp_has_problematic_pricing","cf_renewal_amount_this_year","cf_days_since_contact","cf_my_call_list_est","cf_order_sheet_name","cf_date_signed_by_syncfusion","cf_invoice_due_date","cf_return_identified_by","cf_contract_sent","cf_paralegal_contracts_to_returncancel","cf_total_contract_amount","cf_order_sheet_incomplete","cf_salescr_action_needed","cf_link_to_return_opportunity","cf_company","cf_opportunity_category","cf_product_or_plan","cf_revenue_type","cf_call_country","cf_last_renewal_order_id","cf_demo_scheduled","cf_reason_lost_comments","cf_opportunity_source","cf_download_country","cf_reason_lost","cf_alliance_partner_status","cf_customerid","cf_no_of_order_sheets_in_opp","cf_previous_dt_order_amount","cf_manager_at_time_of_sale","cf_department","cf_known_company_url","cf_secondary_ap_contact","cf_is_invoice_collectible","cf_problematic_pricing_acct","cf_tier_1_country_code","cf_renewal_status","cf_renewal_confirmation","cf_contract_reviewed","cf_reason_returned","cf_resolution","cf_po_obtained_legal","cf_contact_lead_source","cf_salescrr_issue_resolved","cf_primary_ap_contact","cf_visual_compliance_run_by","cf_crr_rep","cf_crr_corrections_required","cf_returnrebook","cf_payment_confirmation_attached","cf_tier_1_country_name","cf_1st_contact_date","cf_email","cf_submitted_for_processing","cf_rejected_to_rep","cf_returned_for_corrections","cf_order_sheet_processed","cf_record_type","cf_upgrade_dollar_amount","cf_total_sale_amount","cf_month_one_amount","cf_month_two_amount","cf_month_three_amount","cf_month_four_amount","cf_month_five_amount","cf_month_six_amount","cf_month_seven_amount","cf_month_eight_amount","cf_month_nine_amount","cf_month_ten_amount","cf_month_eleven_amount","cf_month_twelve_amount","cf_fee_to_alliance_partner","cf_contract_status","cf_3rd_contact_date","cf_payment_method","cf_bold_commissionable_amount","cf_customer_invoice_details","cf_stripe_order","cf_year_one_contract_amount","cf_case_resolution","cf_sales_admin_correction_requested","cf_date_agreement_effective","cf_date_agreement_expires","cf_date_sent_to_customer","cf_date_estimate_sent_to_customer","cf_date_signed_by_customer","cf_case_car_rep","cf_crr_split_amount","cf_follow_up_date","cf_outstanding_amount","cf_amount_collected_by_legal","cf_payment_outcome","cf_invoice_sent","cf_contract_complete_or_closed","cf_reason_for_no_contract","cf_payment_obtained_legal","cf_review_site","cf_order_info_needed","cf_collection_legal_status","cf_last_collections_contact","cf_total_invoice_amount","cf_salescr_action_type","cf_case_description","cf_date_sent_to_jv","cf_date_fully_executed","cf_90_days_support","cf_weekly_call_day","cf_last_ar_contact","cf_related_opp_account_name","cf_related_opp_close_date","cf_on_hold_details","cf_responsible_for_inv","cf_due_date","cf_status","cf_dt_order_id","cf_salescrr_invoice_issue","cf_days_suppport_remaining","cf_alliance_partner","cf_manager","cf_visual_compliance_run","cf_syncfusion_sales_rep","cf_absolute_revenue","cf_car_rep","cf_next_contact_date","cf_opportunity_amount","cf_task_subtype","cf_day_log","cf_time_activity_logged","cf_call_type","cf_call_result","cf_license_ordered","cf_presale_contract_request","cf_assigned_to","cf_ar_status","cf_date_sent_to_legal","cf_order_entered","cf_verified_return_in_dt","cf_confirmed_order_csr","cf_date_order_closed_paidret","cf_discount","cf_email_subject","cf_salescrr_issue_type","cf_sales_rep_split_amount","cf_cg_billing_postal_code","cf_cg_known_company_url","cf_problematic_pricing_opps","cf_cg_billing_street","cf_cg_billing_city","cf_contact_license_type","cf_group_billing_country","cf_order_entered_by","cf_reason_for_owner_change","cf_acct_has_problematic_pricing","cf_opp_acct_has_problematic_pricing","cf_channel","cf_csr_confirmed_alliance_order","cf_submitted_for_bd_review","contactname","Invoice Age","stage","Amount After Discount","Days To Expiration","Days To Payment","Days To Payment 2","Days To Invoice Payment","Days not renewing to closed","Sales Admin Review Days","Close Date to Processed","Days to Process","Close to Final CRRB Checks","Close vs. Exp date","Days Since Close Date","Days Open","Absolute Close Won Date","Upgrade Amount","When was Alliance Partner Paid","Opportunity Age","Bold Team","Collections or AR?","Call time","Follow Up Type","Contract Result","Eligible for Contract","Contract","CRRB Processing Time","Days To Final CRRB Check","Days to Process(str)","Invoice Age(Str)","Close to payment","Eligible Date to Close","DT Order Link","Tier 1 Region","Adjusted Projected REN","Percent Invoice Paid","Days to Submit Order","Days to Submit Order_bucket","Annualized Revenue","Closed By Expiration","Link to Next REN Opportunity","Link to Old REN Opportunity","cf_ren_contract_notes","cf_collections_legal_notes","cf_ar_notes","cf_contract_retrieval_notes","cf_comments","cf_order_evaluation_notes","cf_counsel_order_notes","cf_notes_from_sales_leadership","cf_notes_to_ar_manager","cf_po_notes_legal","cf_collections_correspondence","cf_admin_internal_notes","cf_paralegal_notes","cf_rep_notes","Opportunity Owner Designation","Opportunity Owner Role","Opportunity Owner Department","Opportunity Owner Workstation","Opportunity Owner Division","Opportunity Owner : Active","Opportunity Owner : Manager","isreportingpersonasmaanager","Opportunity Owner : Reporting Person","User End Date","Opportunity Owner IsActive","Car_Rep_Contact"
											,"sales/cr-notes-with-legal",
	"Counsel-Notes",
	"Closed-Lost-Qualification-Notes" ,
	"SE-Notes",
	"CR-Notes",
	"Sales-Leadership-Notes",
	"About-This-Opportunity",
	"contract-notes",
	"project-notes",
	"case-comments",	
	"project-name-cst")
SELECT * from public.get_child_articket_detail(
	array_to_string(newids,',')
)
ON CONFLICT ("parentid","id") 
DO 
   UPDATE SET "id"=EXCLUDED."id","org_id"=EXCLUDED."org_id","brand_id"=EXCLUDED."brand_id","org_brand_id"=EXCLUDED."org_brand_id","brand_name"=EXCLUDED."brand_name","Opportunity Name"=EXCLUDED."Opportunity Name","is_visible_in_customer_portal"=EXCLUDED."is_visible_in_customer_portal","requested_by"=EXCLUDED."requested_by","requester"=EXCLUDED."requester","assigned_to_user_id"=EXCLUDED."assigned_to_user_id","assignee"=EXCLUDED."assignee","AR Rep"=EXCLUDED."AR Rep","assigned_to_group_id"=EXCLUDED."assigned_to_group_id","group"=EXCLUDED."group","contact_group_id"=EXCLUDED."contact_group_id","contact_group"=EXCLUDED."contact_group","resolution_due_on"=EXCLUDED."resolution_due_on","ticket_status_id"=EXCLUDED."ticket_status_id","status"=EXCLUDED."status","ticket_source_id"=EXCLUDED."ticket_source_id","source"=EXCLUDED."source","update_count"=EXCLUDED."update_count","note_count"=EXCLUDED."note_count","attachment_count"=EXCLUDED."attachment_count","work_log_count"=EXCLUDED."work_log_count","total_time_logged"=EXCLUDED."total_time_logged","total_billable_time_logged"=EXCLUDED."total_billable_time_logged","first_response_due_on"=EXCLUDED."first_response_due_on","next_response_due_on"=EXCLUDED."next_response_due_on","last_replied_on"=EXCLUDED."last_replied_on","last_replied_by_id"=EXCLUDED."last_replied_by_id","last_replied_by"=EXCLUDED."last_replied_by","last_replied_by_user_type_id"=EXCLUDED."last_replied_by_user_type_id","last_replied_by_user_type"=EXCLUDED."last_replied_by_user_type","closed_on"=EXCLUDED."closed_on","closed_by"=EXCLUDED."closed_by","closed_by_name"=EXCLUDED."closed_by_name","created_on"=EXCLUDED."created_on","created_by"=EXCLUDED."created_by","creator"=EXCLUDED."creator","last_modified_on"=EXCLUDED."last_modified_on","last_modified_by"=EXCLUDED."last_modified_by","Last Modified By"=EXCLUDED."Last Modified By","is_spam"=EXCLUDED."is_spam","is_active"=EXCLUDED."is_active","tsv"=EXCLUDED."tsv","is_resolution_date_modified"=EXCLUDED."is_resolution_date_modified","last_status_changed_on"=EXCLUDED."last_status_changed_on","is_first_response_updated"=EXCLUDED."is_first_response_updated","ticket_type_option_id"=EXCLUDED."ticket_type_option_id","ticket_category_option_id"=EXCLUDED."ticket_category_option_id","ticket_priority_id"=EXCLUDED."ticket_priority_id","priority"=EXCLUDED."priority","Account Name"=EXCLUDED."Account Name","subject"=EXCLUDED."subject","type"=EXCLUDED."type","category"=EXCLUDED."category","email"=EXCLUDED."email","OpportunityOwner"=EXCLUDED."OpportunityOwner","time_spent"=EXCLUDED."time_spent","unique_external_reference_id"=EXCLUDED."unique_external_reference_id","agentid"=EXCLUDED."agentid","notes"=EXCLUDED."notes","isnotesprivate"=EXCLUDED."isnotesprivate","notetype"=EXCLUDED."notetype","assigned"=EXCLUDED."assigned","cf_amount"=EXCLUDED."cf_amount","cf_opp_dt_order_id"=EXCLUDED."cf_opp_dt_order_id","cf_link_to_bold_order"=EXCLUDED."cf_link_to_bold_order","cf_expected_payment_date"=EXCLUDED."cf_expected_payment_date","cf_group_car_rep"=EXCLUDED."cf_group_car_rep","cf_secondary_lead_source"=EXCLUDED."cf_secondary_lead_source","cf_contract_renewal_date"=EXCLUDED."cf_contract_renewal_date","cf_contract_renewal_amount"=EXCLUDED."cf_contract_renewal_amount","cf_reinstate_reason"=EXCLUDED."cf_reinstate_reason","cf_last_crr_rep_contact"=EXCLUDED."cf_last_crr_rep_contact","cf_country"=EXCLUDED."cf_country","cf_date_reviewed"=EXCLUDED."cf_date_reviewed","cf_nonrenewal_reason"=EXCLUDED."cf_nonrenewal_reason","cf_cleared_by_jv"=EXCLUDED."cf_cleared_by_jv","cf_order_sheet_status"=EXCLUDED."cf_order_sheet_status","cf_case_number"=EXCLUDED."cf_case_number","cf_downloaded_date"=EXCLUDED."cf_downloaded_date","cf_key_order_issue"=EXCLUDED."cf_key_order_issue","cf_term_12_months"=EXCLUDED."cf_term_12_months","cf_date_moved_to_not_renewing"=EXCLUDED."cf_date_moved_to_not_renewing","cf_adobe_sign_exp_date"=EXCLUDED."cf_adobe_sign_exp_date","cf_next_cl_contact"=EXCLUDED."cf_next_cl_contact","cf__of_years_in_next_payment_term"=EXCLUDED."cf__of_years_in_next_payment_term","cf__of_years_in_previous_payment_term"=EXCLUDED."cf__of_years_in_previous_payment_term","cf_ap_processed_alliance_fee"=EXCLUDED."cf_ap_processed_alliance_fee","cf_days_to_pay_alliance_partner"=EXCLUDED."cf_days_to_pay_alliance_partner","cf_alliance_fee_tier"=EXCLUDED."cf_alliance_fee_tier","cf_alliance_partner_order_status"=EXCLUDED."cf_alliance_partner_order_status","cf_biz_dev_reviewed"=EXCLUDED."cf_biz_dev_reviewed","cf_csr_returned_for_correction"=EXCLUDED."cf_csr_returned_for_correction","cf_dt_expiration_date"=EXCLUDED."cf_dt_expiration_date","cf_original_license_type"=EXCLUDED."cf_original_license_type","cf_opp_alliance_partner"=EXCLUDED."cf_opp_alliance_partner","cf_return_details"=EXCLUDED."cf_return_details","cf_original_closedwon_date"=EXCLUDED."cf_original_closedwon_date","cf_current_subscription_term"=EXCLUDED."cf_current_subscription_term","cf_last_customer_contact"=EXCLUDED."cf_last_customer_contact","cf_opportunity_name"=EXCLUDED."cf_opportunity_name","cf_lead_source"=EXCLUDED."cf_lead_source","cf_next_ar_contact"=EXCLUDED."cf_next_ar_contact","cf_opp_presale_contract_request"=EXCLUDED."cf_opp_presale_contract_request","cf_end_date"=EXCLUDED."cf_end_date","cf_ren_audit_review"=EXCLUDED."cf_ren_audit_review","cf_counsel_reviewed"=EXCLUDED."cf_counsel_reviewed","cf_flagged_by_mahas_team"=EXCLUDED."cf_flagged_by_mahas_team","cf_submitted_for_approval"=EXCLUDED."cf_submitted_for_approval","cf_order_reviewed_by"=EXCLUDED."cf_order_reviewed_by","cf_group_account_name"=EXCLUDED."cf_group_account_name","cf_payment_frequency"=EXCLUDED."cf_payment_frequency","cf_submitted_to_counsel_review"=EXCLUDED."cf_submitted_to_counsel_review","cf_2nd_contact_date"=EXCLUDED."cf_2nd_contact_date","cf_case_type"=EXCLUDED."cf_case_type","cf_return_notes"=EXCLUDED."cf_return_notes","cf_engagement_status"=EXCLUDED."cf_engagement_status","cf_product"=EXCLUDED."cf_product","cf_review_link"=EXCLUDED."cf_review_link","cf_contract_license_ordered"=EXCLUDED."cf_contract_license_ordered","cf_ar_license_ordered"=EXCLUDED."cf_ar_license_ordered","cf_opp_has_problematic_pricing"=EXCLUDED."cf_opp_has_problematic_pricing","cf_renewal_amount_this_year"=EXCLUDED."cf_renewal_amount_this_year","cf_days_since_contact"=EXCLUDED."cf_days_since_contact","cf_my_call_list_est"=EXCLUDED."cf_my_call_list_est","cf_order_sheet_name"=EXCLUDED."cf_order_sheet_name","cf_date_signed_by_syncfusion"=EXCLUDED."cf_date_signed_by_syncfusion","cf_invoice_due_date"=EXCLUDED."cf_invoice_due_date","cf_return_identified_by"=EXCLUDED."cf_return_identified_by","cf_contract_sent"=EXCLUDED."cf_contract_sent","cf_paralegal_contracts_to_returncancel"=EXCLUDED."cf_paralegal_contracts_to_returncancel","cf_total_contract_amount"=EXCLUDED."cf_total_contract_amount","cf_order_sheet_incomplete"=EXCLUDED."cf_order_sheet_incomplete","cf_salescr_action_needed"=EXCLUDED."cf_salescr_action_needed","cf_link_to_return_opportunity"=EXCLUDED."cf_link_to_return_opportunity","cf_company"=EXCLUDED."cf_company","cf_opportunity_category"=EXCLUDED."cf_opportunity_category","cf_product_or_plan"=EXCLUDED."cf_product_or_plan","cf_revenue_type"=EXCLUDED."cf_revenue_type","cf_call_country"=EXCLUDED."cf_call_country","cf_last_renewal_order_id"=EXCLUDED."cf_last_renewal_order_id","cf_demo_scheduled"=EXCLUDED."cf_demo_scheduled","cf_reason_lost_comments"=EXCLUDED."cf_reason_lost_comments","cf_opportunity_source"=EXCLUDED."cf_opportunity_source","cf_download_country"=EXCLUDED."cf_download_country","cf_reason_lost"=EXCLUDED."cf_reason_lost","cf_alliance_partner_status"=EXCLUDED."cf_alliance_partner_status","cf_customerid"=EXCLUDED."cf_customerid","cf_no_of_order_sheets_in_opp"=EXCLUDED."cf_no_of_order_sheets_in_opp","cf_previous_dt_order_amount"=EXCLUDED."cf_previous_dt_order_amount","cf_manager_at_time_of_sale"=EXCLUDED."cf_manager_at_time_of_sale","cf_department"=EXCLUDED."cf_department","cf_known_company_url"=EXCLUDED."cf_known_company_url","cf_secondary_ap_contact"=EXCLUDED."cf_secondary_ap_contact","cf_is_invoice_collectible"=EXCLUDED."cf_is_invoice_collectible","cf_problematic_pricing_acct"=EXCLUDED."cf_problematic_pricing_acct","cf_tier_1_country_code"=EXCLUDED."cf_tier_1_country_code","cf_renewal_status"=EXCLUDED."cf_renewal_status","cf_renewal_confirmation"=EXCLUDED."cf_renewal_confirmation","cf_contract_reviewed"=EXCLUDED."cf_contract_reviewed","cf_reason_returned"=EXCLUDED."cf_reason_returned","cf_resolution"=EXCLUDED."cf_resolution","cf_po_obtained_legal"=EXCLUDED."cf_po_obtained_legal","cf_contact_lead_source"=EXCLUDED."cf_contact_lead_source","cf_salescrr_issue_resolved"=EXCLUDED."cf_salescrr_issue_resolved","cf_primary_ap_contact"=EXCLUDED."cf_primary_ap_contact","cf_visual_compliance_run_by"=EXCLUDED."cf_visual_compliance_run_by","cf_crr_rep"=EXCLUDED."cf_crr_rep","cf_crr_corrections_required"=EXCLUDED."cf_crr_corrections_required","cf_returnrebook"=EXCLUDED."cf_returnrebook","cf_payment_confirmation_attached"=EXCLUDED."cf_payment_confirmation_attached","cf_tier_1_country_name"=EXCLUDED."cf_tier_1_country_name","cf_1st_contact_date"=EXCLUDED."cf_1st_contact_date","cf_email"=EXCLUDED."cf_email","cf_submitted_for_processing"=EXCLUDED."cf_submitted_for_processing","cf_rejected_to_rep"=EXCLUDED."cf_rejected_to_rep","cf_returned_for_corrections"=EXCLUDED."cf_returned_for_corrections","cf_order_sheet_processed"=EXCLUDED."cf_order_sheet_processed","cf_record_type"=EXCLUDED."cf_record_type","cf_upgrade_dollar_amount"=EXCLUDED."cf_upgrade_dollar_amount","cf_total_sale_amount"=EXCLUDED."cf_total_sale_amount","cf_month_one_amount"=EXCLUDED."cf_month_one_amount","cf_month_two_amount"=EXCLUDED."cf_month_two_amount","cf_month_three_amount"=EXCLUDED."cf_month_three_amount","cf_month_four_amount"=EXCLUDED."cf_month_four_amount","cf_month_five_amount"=EXCLUDED."cf_month_five_amount","cf_month_six_amount"=EXCLUDED."cf_month_six_amount","cf_month_seven_amount"=EXCLUDED."cf_month_seven_amount","cf_month_eight_amount"=EXCLUDED."cf_month_eight_amount","cf_month_nine_amount"=EXCLUDED."cf_month_nine_amount","cf_month_ten_amount"=EXCLUDED."cf_month_ten_amount","cf_month_eleven_amount"=EXCLUDED."cf_month_eleven_amount","cf_month_twelve_amount"=EXCLUDED."cf_month_twelve_amount","cf_fee_to_alliance_partner"=EXCLUDED."cf_fee_to_alliance_partner","cf_contract_status"=EXCLUDED."cf_contract_status","cf_3rd_contact_date"=EXCLUDED."cf_3rd_contact_date","cf_payment_method"=EXCLUDED."cf_payment_method","cf_bold_commissionable_amount"=EXCLUDED."cf_bold_commissionable_amount","cf_customer_invoice_details"=EXCLUDED."cf_customer_invoice_details","cf_stripe_order"=EXCLUDED."cf_stripe_order","cf_year_one_contract_amount"=EXCLUDED."cf_year_one_contract_amount","cf_case_resolution"=EXCLUDED."cf_case_resolution","cf_sales_admin_correction_requested"=EXCLUDED."cf_sales_admin_correction_requested","cf_date_agreement_effective"=EXCLUDED."cf_date_agreement_effective","cf_date_agreement_expires"=EXCLUDED."cf_date_agreement_expires","cf_date_sent_to_customer"=EXCLUDED."cf_date_sent_to_customer","cf_date_estimate_sent_to_customer"=EXCLUDED."cf_date_estimate_sent_to_customer","cf_date_signed_by_customer"=EXCLUDED."cf_date_signed_by_customer","cf_case_car_rep"=EXCLUDED."cf_case_car_rep","cf_crr_split_amount"=EXCLUDED."cf_crr_split_amount","cf_follow_up_date"=EXCLUDED."cf_follow_up_date","cf_outstanding_amount"=EXCLUDED."cf_outstanding_amount","cf_amount_collected_by_legal"=EXCLUDED."cf_amount_collected_by_legal","cf_payment_outcome"=EXCLUDED."cf_payment_outcome","cf_invoice_sent"=EXCLUDED."cf_invoice_sent","cf_contract_complete_or_closed"=EXCLUDED."cf_contract_complete_or_closed","cf_reason_for_no_contract"=EXCLUDED."cf_reason_for_no_contract","cf_payment_obtained_legal"=EXCLUDED."cf_payment_obtained_legal","cf_review_site"=EXCLUDED."cf_review_site","cf_order_info_needed"=EXCLUDED."cf_order_info_needed","cf_collection_legal_status"=EXCLUDED."cf_collection_legal_status","cf_last_collections_contact"=EXCLUDED."cf_last_collections_contact","cf_total_invoice_amount"=EXCLUDED."cf_total_invoice_amount","cf_salescr_action_type"=EXCLUDED."cf_salescr_action_type","cf_case_description"=EXCLUDED."cf_case_description","cf_date_sent_to_jv"=EXCLUDED."cf_date_sent_to_jv","cf_date_fully_executed"=EXCLUDED."cf_date_fully_executed","cf_90_days_support"=EXCLUDED."cf_90_days_support","cf_weekly_call_day"=EXCLUDED."cf_weekly_call_day","cf_last_ar_contact"=EXCLUDED."cf_last_ar_contact","cf_related_opp_account_name"=EXCLUDED."cf_related_opp_account_name","cf_related_opp_close_date"=EXCLUDED."cf_related_opp_close_date","cf_on_hold_details"=EXCLUDED."cf_on_hold_details","cf_responsible_for_inv"=EXCLUDED."cf_responsible_for_inv","cf_due_date"=EXCLUDED."cf_due_date","cf_status"=EXCLUDED."cf_status","cf_dt_order_id"=EXCLUDED."cf_dt_order_id","cf_salescrr_invoice_issue"=EXCLUDED."cf_salescrr_invoice_issue","cf_days_suppport_remaining"=EXCLUDED."cf_days_suppport_remaining","cf_alliance_partner"=EXCLUDED."cf_alliance_partner","cf_manager"=EXCLUDED."cf_manager","cf_visual_compliance_run"=EXCLUDED."cf_visual_compliance_run","cf_syncfusion_sales_rep"=EXCLUDED."cf_syncfusion_sales_rep","cf_absolute_revenue"=EXCLUDED."cf_absolute_revenue","cf_car_rep"=EXCLUDED."cf_car_rep","cf_next_contact_date"=EXCLUDED."cf_next_contact_date","cf_opportunity_amount"=EXCLUDED."cf_opportunity_amount","cf_task_subtype"=EXCLUDED."cf_task_subtype","cf_day_log"=EXCLUDED."cf_day_log","cf_time_activity_logged"=EXCLUDED."cf_time_activity_logged","cf_call_type"=EXCLUDED."cf_call_type","cf_call_result"=EXCLUDED."cf_call_result","cf_license_ordered"=EXCLUDED."cf_license_ordered","cf_presale_contract_request"=EXCLUDED."cf_presale_contract_request","cf_assigned_to"=EXCLUDED."cf_assigned_to","cf_ar_status"=EXCLUDED."cf_ar_status","cf_date_sent_to_legal"=EXCLUDED."cf_date_sent_to_legal","cf_order_entered"=EXCLUDED."cf_order_entered","cf_verified_return_in_dt"=EXCLUDED."cf_verified_return_in_dt","cf_confirmed_order_csr"=EXCLUDED."cf_confirmed_order_csr","cf_date_order_closed_paidret"=EXCLUDED."cf_date_order_closed_paidret","cf_discount"=EXCLUDED."cf_discount","cf_email_subject"=EXCLUDED."cf_email_subject","cf_salescrr_issue_type"=EXCLUDED."cf_salescrr_issue_type","cf_sales_rep_split_amount"=EXCLUDED."cf_sales_rep_split_amount","cf_cg_billing_postal_code"=EXCLUDED."cf_cg_billing_postal_code","cf_cg_known_company_url"=EXCLUDED."cf_cg_known_company_url","cf_problematic_pricing_opps"=EXCLUDED."cf_problematic_pricing_opps","cf_cg_billing_street"=EXCLUDED."cf_cg_billing_street","cf_cg_billing_city"=EXCLUDED."cf_cg_billing_city","cf_contact_license_type"=EXCLUDED."cf_contact_license_type","cf_group_billing_country"=EXCLUDED."cf_group_billing_country","cf_order_entered_by"=EXCLUDED."cf_order_entered_by","cf_reason_for_owner_change"=EXCLUDED."cf_reason_for_owner_change","cf_acct_has_problematic_pricing"=EXCLUDED."cf_acct_has_problematic_pricing","cf_opp_acct_has_problematic_pricing"=EXCLUDED."cf_opp_acct_has_problematic_pricing","cf_channel"=EXCLUDED."cf_channel","cf_csr_confirmed_alliance_order"=EXCLUDED."cf_csr_confirmed_alliance_order","cf_submitted_for_bd_review"=EXCLUDED."cf_submitted_for_bd_review","contactname"=EXCLUDED."contactname","Invoice Age"=EXCLUDED."Invoice Age","stage"=EXCLUDED."stage","Amount After Discount"=EXCLUDED."Amount After Discount","Days To Expiration"=EXCLUDED."Days To Expiration","Days To Payment"=EXCLUDED."Days To Payment","Days To Payment 2"=EXCLUDED."Days To Payment 2","Days To Invoice Payment"=EXCLUDED."Days To Invoice Payment","Days not renewing to closed"=EXCLUDED."Days not renewing to closed","Sales Admin Review Days"=EXCLUDED."Sales Admin Review Days","Close Date to Processed"=EXCLUDED."Close Date to Processed","Days to Process"=EXCLUDED."Days to Process","Close to Final CRRB Checks"=EXCLUDED."Close to Final CRRB Checks","Close vs. Exp date"=EXCLUDED."Close vs. Exp date","Days Since Close Date"=EXCLUDED."Days Since Close Date","Days Open"=EXCLUDED."Days Open","Absolute Close Won Date"=EXCLUDED."Absolute Close Won Date","Upgrade Amount"=EXCLUDED."Upgrade Amount","When was Alliance Partner Paid"=EXCLUDED."When was Alliance Partner Paid","Opportunity Age"=EXCLUDED."Opportunity Age","Bold Team"=EXCLUDED."Bold Team","Collections or AR?"=EXCLUDED."Collections or AR?","Call time"=EXCLUDED."Call time","Follow Up Type"=EXCLUDED."Follow Up Type","Contract Result"=EXCLUDED."Contract Result","Eligible for Contract"=EXCLUDED."Eligible for Contract","Contract"=EXCLUDED."Contract","CRRB Processing Time"=EXCLUDED."CRRB Processing Time","Days To Final CRRB Check"=EXCLUDED."Days To Final CRRB Check","Days to Process(str)"=EXCLUDED."Days to Process(str)","Invoice Age(Str)"=EXCLUDED."Invoice Age(Str)","Close to payment"=EXCLUDED."Close to payment","Eligible Date to Close"=EXCLUDED."Eligible Date to Close","DT Order Link"=EXCLUDED."DT Order Link","Tier 1 Region"=EXCLUDED."Tier 1 Region","Adjusted Projected REN"=EXCLUDED."Adjusted Projected REN","Percent Invoice Paid"=EXCLUDED."Percent Invoice Paid","Days to Submit Order"=EXCLUDED."Days to Submit Order","Days to Submit Order_bucket"=EXCLUDED."Days to Submit Order_bucket","Annualized Revenue"=EXCLUDED."Annualized Revenue","Closed By Expiration"=EXCLUDED."Closed By Expiration","Link to Next REN Opportunity"=EXCLUDED."Link to Next REN Opportunity","Link to Old REN Opportunity"=EXCLUDED."Link to Old REN Opportunity","cf_ren_contract_notes"=EXCLUDED."cf_ren_contract_notes","cf_collections_legal_notes"=EXCLUDED."cf_collections_legal_notes","cf_ar_notes"=EXCLUDED."cf_ar_notes","cf_contract_retrieval_notes"=EXCLUDED."cf_contract_retrieval_notes","cf_comments"=EXCLUDED."cf_comments","cf_order_evaluation_notes"=EXCLUDED."cf_order_evaluation_notes","cf_counsel_order_notes"=EXCLUDED."cf_counsel_order_notes","cf_notes_from_sales_leadership"=EXCLUDED."cf_notes_from_sales_leadership","cf_notes_to_ar_manager"=EXCLUDED."cf_notes_to_ar_manager","cf_po_notes_legal"=EXCLUDED."cf_po_notes_legal","cf_collections_correspondence"=EXCLUDED."cf_collections_correspondence","cf_admin_internal_notes"=EXCLUDED."cf_admin_internal_notes","cf_paralegal_notes"=EXCLUDED."cf_paralegal_notes","cf_rep_notes"=EXCLUDED."cf_rep_notes","Opportunity Owner Designation"=EXCLUDED."Opportunity Owner Designation","Opportunity Owner Role"=EXCLUDED."Opportunity Owner Role","Opportunity Owner Department"=EXCLUDED."Opportunity Owner Department","Opportunity Owner Workstation"=EXCLUDED."Opportunity Owner Workstation","Opportunity Owner Division"=EXCLUDED."Opportunity Owner Division","Opportunity Owner : Active"=EXCLUDED."Opportunity Owner : Active","Opportunity Owner : Manager"=EXCLUDED."Opportunity Owner : Manager","isreportingpersonasmaanager"=EXCLUDED."isreportingpersonasmaanager","Opportunity Owner : Reporting Person"=EXCLUDED."Opportunity Owner : Reporting Person","User End Date"=EXCLUDED."User End Date","Opportunity Owner IsActive"=EXCLUDED."Opportunity Owner IsActive","Car_Rep_Contact"=EXCLUDED."Car_Rep_Contact",
   "sales/cr-notes-with-legal" = EXCLUDED."sales/cr-notes-with-legal",
	"Counsel-Notes"= EXCLUDED."Counsel-Notes",
	"Closed-Lost-Qualification-Notes" = EXCLUDED."Closed-Lost-Qualification-Notes",
	"SE-Notes"=EXCLUDED."SE-Notes",
	"CR-Notes"=EXCLUDED."CR-Notes",
	"Sales-Leadership-Notes"=EXCLUDED."Sales-Leadership-Notes",
	"About-This-Opportunity"=EXCLUDED."About-This-Opportunity",
	"contract-notes"=EXCLUDED."contract-notes",
	"project-notes"=EXCLUDED."project-notes",
	"case-comments"=EXCLUDED."case-comments",	
	"project-name-cst"=EXCLUDED."project-name-cst";
  raise notice 'Chile Ar Ticket detail update  Completed time %', transaction_timestamp();
     INSERT INTO public.child_contract_ticket_detail (parentid,"id","org_id","brand_id","org_brand_id","brand_name","Opportunity Name","is_visible_in_customer_portal","requested_by","requester","assigned_to_user_id","assignee","AR Rep","assigned_to_group_id","group","contact_group_id","contact_group","resolution_due_on","ticket_status_id","status","ticket_source_id","source","update_count","note_count","attachment_count","work_log_count","total_time_logged","total_billable_time_logged","first_response_due_on","next_response_due_on","last_replied_on","last_replied_by_id","last_replied_by","last_replied_by_user_type_id","last_replied_by_user_type","closed_on","closed_by","closed_by_name","created_on","created_by","creator","last_modified_on","last_modified_by","Last Modified By","is_spam","is_active","tsv","is_resolution_date_modified","last_status_changed_on","is_first_response_updated","ticket_type_option_id","ticket_category_option_id","ticket_priority_id","priority","Account Name","subject","type","category","email","OpportunityOwner","time_spent","unique_external_reference_id","agentid","notes","isnotesprivate","notetype","assigned","cf_amount","cf_opp_dt_order_id","cf_link_to_bold_order","cf_expected_payment_date","cf_group_car_rep","cf_secondary_lead_source","cf_contract_renewal_date","cf_contract_renewal_amount","cf_reinstate_reason","cf_last_crr_rep_contact","cf_country","cf_date_reviewed","cf_nonrenewal_reason","cf_cleared_by_jv","cf_order_sheet_status","cf_case_number","cf_downloaded_date","cf_key_order_issue","cf_term_12_months","cf_date_moved_to_not_renewing","cf_adobe_sign_exp_date","cf_next_cl_contact","cf__of_years_in_next_payment_term","cf__of_years_in_previous_payment_term","cf_ap_processed_alliance_fee","cf_days_to_pay_alliance_partner","cf_alliance_fee_tier","cf_alliance_partner_order_status","cf_biz_dev_reviewed","cf_csr_returned_for_correction","cf_dt_expiration_date","cf_original_license_type","cf_opp_alliance_partner","cf_return_details","cf_original_closedwon_date","cf_current_subscription_term","cf_last_customer_contact","cf_opportunity_name","cf_lead_source","cf_next_ar_contact","cf_opp_presale_contract_request","cf_end_date","cf_ren_audit_review","cf_counsel_reviewed","cf_flagged_by_mahas_team","cf_submitted_for_approval","cf_order_reviewed_by","cf_group_account_name","cf_payment_frequency","cf_submitted_to_counsel_review","cf_2nd_contact_date","cf_case_type","cf_return_notes","cf_engagement_status","cf_product","cf_review_link","cf_contract_license_ordered","cf_ar_license_ordered","cf_opp_has_problematic_pricing","cf_renewal_amount_this_year","cf_days_since_contact","cf_my_call_list_est","cf_order_sheet_name","cf_date_signed_by_syncfusion","cf_invoice_due_date","cf_return_identified_by","cf_contract_sent","cf_paralegal_contracts_to_returncancel","cf_total_contract_amount","cf_order_sheet_incomplete","cf_salescr_action_needed","cf_link_to_return_opportunity","cf_company","cf_opportunity_category","cf_product_or_plan","cf_revenue_type","cf_call_country","cf_last_renewal_order_id","cf_demo_scheduled","cf_reason_lost_comments","cf_opportunity_source","cf_download_country","cf_reason_lost","cf_alliance_partner_status","cf_customerid","cf_no_of_order_sheets_in_opp","cf_previous_dt_order_amount","cf_manager_at_time_of_sale","cf_department","cf_known_company_url","cf_secondary_ap_contact","cf_is_invoice_collectible","cf_problematic_pricing_acct","cf_tier_1_country_code","cf_renewal_status","cf_renewal_confirmation","cf_contract_reviewed","cf_reason_returned","cf_resolution","cf_po_obtained_legal","cf_contact_lead_source","cf_salescrr_issue_resolved","cf_primary_ap_contact","cf_visual_compliance_run_by","cf_crr_rep","cf_crr_corrections_required","cf_returnrebook","cf_payment_confirmation_attached","cf_tier_1_country_name","cf_1st_contact_date","cf_email","cf_submitted_for_processing","cf_rejected_to_rep","cf_returned_for_corrections","cf_order_sheet_processed","cf_record_type","cf_upgrade_dollar_amount","cf_total_sale_amount","cf_month_one_amount","cf_month_two_amount","cf_month_three_amount","cf_month_four_amount","cf_month_five_amount","cf_month_six_amount","cf_month_seven_amount","cf_month_eight_amount","cf_month_nine_amount","cf_month_ten_amount","cf_month_eleven_amount","cf_month_twelve_amount","cf_fee_to_alliance_partner","cf_contract_status","cf_3rd_contact_date","cf_payment_method","cf_bold_commissionable_amount","cf_customer_invoice_details","cf_stripe_order","cf_year_one_contract_amount","cf_case_resolution","cf_sales_admin_correction_requested","cf_date_agreement_effective","cf_date_agreement_expires","cf_date_sent_to_customer","cf_date_estimate_sent_to_customer","cf_date_signed_by_customer","cf_case_car_rep","cf_crr_split_amount","cf_follow_up_date","cf_outstanding_amount","cf_amount_collected_by_legal","cf_payment_outcome","cf_invoice_sent","cf_contract_complete_or_closed","cf_reason_for_no_contract","cf_payment_obtained_legal","cf_review_site","cf_order_info_needed","cf_collection_legal_status","cf_last_collections_contact","cf_total_invoice_amount","cf_salescr_action_type","cf_case_description","cf_date_sent_to_jv","cf_date_fully_executed","cf_90_days_support","cf_weekly_call_day","cf_last_ar_contact","cf_related_opp_account_name","cf_related_opp_close_date","cf_on_hold_details","cf_responsible_for_inv","cf_due_date","cf_status","cf_dt_order_id","cf_salescrr_invoice_issue","cf_days_suppport_remaining","cf_alliance_partner","cf_manager","cf_visual_compliance_run","cf_syncfusion_sales_rep","cf_absolute_revenue","cf_car_rep","cf_next_contact_date","cf_opportunity_amount","cf_task_subtype","cf_day_log","cf_time_activity_logged","cf_call_type","cf_call_result","cf_license_ordered","cf_presale_contract_request","cf_assigned_to","cf_ar_status","cf_date_sent_to_legal","cf_order_entered","cf_verified_return_in_dt","cf_confirmed_order_csr","cf_date_order_closed_paidret","cf_discount","cf_email_subject","cf_salescrr_issue_type","cf_sales_rep_split_amount","cf_cg_billing_postal_code","cf_cg_known_company_url","cf_problematic_pricing_opps","cf_cg_billing_street","cf_cg_billing_city","cf_contact_license_type","cf_group_billing_country","cf_order_entered_by","cf_reason_for_owner_change","cf_acct_has_problematic_pricing","cf_opp_acct_has_problematic_pricing","cf_channel","cf_csr_confirmed_alliance_order","cf_submitted_for_bd_review","contactname","Invoice Age","stage","Amount After Discount","Days To Expiration","Days To Payment","Days To Payment 2","Days To Invoice Payment","Days not renewing to closed","Sales Admin Review Days","Close Date to Processed","Days to Process","Close to Final CRRB Checks","Close vs. Exp date","Days Since Close Date","Days Open","Absolute Close Won Date","Upgrade Amount","When was Alliance Partner Paid","Opportunity Age","Bold Team","Collections or AR?","Call time","Follow Up Type","Contract Result","Eligible for Contract","Contract","CRRB Processing Time","Days To Final CRRB Check","Days to Process(str)","Invoice Age(Str)","Close to payment","Eligible Date to Close","DT Order Link","Tier 1 Region","Adjusted Projected REN","Percent Invoice Paid","Days to Submit Order","Days to Submit Order_bucket","Annualized Revenue","Closed By Expiration","Link to Next REN Opportunity","Link to Old REN Opportunity","cf_ren_contract_notes","cf_collections_legal_notes","cf_ar_notes","cf_contract_retrieval_notes","cf_comments","cf_order_evaluation_notes","cf_counsel_order_notes","cf_notes_from_sales_leadership","cf_notes_to_ar_manager","cf_po_notes_legal","cf_collections_correspondence","cf_admin_internal_notes","cf_paralegal_notes","cf_rep_notes","Opportunity Owner Designation","Opportunity Owner Role","Opportunity Owner Department","Opportunity Owner Workstation","Opportunity Owner Division","Opportunity Owner : Active","Opportunity Owner : Manager","isreportingpersonasmaanager","Opportunity Owner : Reporting Person","User End Date","Opportunity Owner IsActive","Car_Rep_Contact"
													 ,"sales/cr-notes-with-legal",
	"Counsel-Notes",
	"Closed-Lost-Qualification-Notes" ,
	"SE-Notes",
	"CR-Notes",
	"Sales-Leadership-Notes",
	"About-This-Opportunity",
	"contract-notes",
	"project-notes",
	"case-comments",	
	"project-name-cst")
SELECT * from public.get_child_contractticket_detail(
	array_to_string(newids,',')
)idx_ticket_detail
ON CONFLICT ("parentid","id") 
DO 
   UPDATE SET "id"=EXCLUDED."id","org_id"=EXCLUDED."org_id","brand_id"=EXCLUDED."brand_id","org_brand_id"=EXCLUDED."org_brand_id","brand_name"=EXCLUDED."brand_name","Opportunity Name"=EXCLUDED."Opportunity Name","is_visible_in_customer_portal"=EXCLUDED."is_visible_in_customer_portal","requested_by"=EXCLUDED."requested_by","requester"=EXCLUDED."requester","assigned_to_user_id"=EXCLUDED."assigned_to_user_id","assignee"=EXCLUDED."assignee","AR Rep"=EXCLUDED."AR Rep","assigned_to_group_id"=EXCLUDED."assigned_to_group_id","group"=EXCLUDED."group","contact_group_id"=EXCLUDED."contact_group_id","contact_group"=EXCLUDED."contact_group","resolution_due_on"=EXCLUDED."resolution_due_on","ticket_status_id"=EXCLUDED."ticket_status_id","status"=EXCLUDED."status","ticket_source_id"=EXCLUDED."ticket_source_id","source"=EXCLUDED."source","update_count"=EXCLUDED."update_count","note_count"=EXCLUDED."note_count","attachment_count"=EXCLUDED."attachment_count","work_log_count"=EXCLUDED."work_log_count","total_time_logged"=EXCLUDED."total_time_logged","total_billable_time_logged"=EXCLUDED."total_billable_time_logged","first_response_due_on"=EXCLUDED."first_response_due_on","next_response_due_on"=EXCLUDED."next_response_due_on","last_replied_on"=EXCLUDED."last_replied_on","last_replied_by_id"=EXCLUDED."last_replied_by_id","last_replied_by"=EXCLUDED."last_replied_by","last_replied_by_user_type_id"=EXCLUDED."last_replied_by_user_type_id","last_replied_by_user_type"=EXCLUDED."last_replied_by_user_type","closed_on"=EXCLUDED."closed_on","closed_by"=EXCLUDED."closed_by","closed_by_name"=EXCLUDED."closed_by_name","created_on"=EXCLUDED."created_on","created_by"=EXCLUDED."created_by","creator"=EXCLUDED."creator","last_modified_on"=EXCLUDED."last_modified_on","last_modified_by"=EXCLUDED."last_modified_by","Last Modified By"=EXCLUDED."Last Modified By","is_spam"=EXCLUDED."is_spam","is_active"=EXCLUDED."is_active","tsv"=EXCLUDED."tsv","is_resolution_date_modified"=EXCLUDED."is_resolution_date_modified","last_status_changed_on"=EXCLUDED."last_status_changed_on","is_first_response_updated"=EXCLUDED."is_first_response_updated","ticket_type_option_id"=EXCLUDED."ticket_type_option_id","ticket_category_option_id"=EXCLUDED."ticket_category_option_id","ticket_priority_id"=EXCLUDED."ticket_priority_id","priority"=EXCLUDED."priority","Account Name"=EXCLUDED."Account Name","subject"=EXCLUDED."subject","type"=EXCLUDED."type","category"=EXCLUDED."category","email"=EXCLUDED."email","OpportunityOwner"=EXCLUDED."OpportunityOwner","time_spent"=EXCLUDED."time_spent","unique_external_reference_id"=EXCLUDED."unique_external_reference_id","agentid"=EXCLUDED."agentid","notes"=EXCLUDED."notes","isnotesprivate"=EXCLUDED."isnotesprivate","notetype"=EXCLUDED."notetype","assigned"=EXCLUDED."assigned","cf_amount"=EXCLUDED."cf_amount","cf_opp_dt_order_id"=EXCLUDED."cf_opp_dt_order_id","cf_link_to_bold_order"=EXCLUDED."cf_link_to_bold_order","cf_expected_payment_date"=EXCLUDED."cf_expected_payment_date","cf_group_car_rep"=EXCLUDED."cf_group_car_rep","cf_secondary_lead_source"=EXCLUDED."cf_secondary_lead_source","cf_contract_renewal_date"=EXCLUDED."cf_contract_renewal_date","cf_contract_renewal_amount"=EXCLUDED."cf_contract_renewal_amount","cf_reinstate_reason"=EXCLUDED."cf_reinstate_reason","cf_last_crr_rep_contact"=EXCLUDED."cf_last_crr_rep_contact","cf_country"=EXCLUDED."cf_country","cf_date_reviewed"=EXCLUDED."cf_date_reviewed","cf_nonrenewal_reason"=EXCLUDED."cf_nonrenewal_reason","cf_cleared_by_jv"=EXCLUDED."cf_cleared_by_jv","cf_order_sheet_status"=EXCLUDED."cf_order_sheet_status","cf_case_number"=EXCLUDED."cf_case_number","cf_downloaded_date"=EXCLUDED."cf_downloaded_date","cf_key_order_issue"=EXCLUDED."cf_key_order_issue","cf_term_12_months"=EXCLUDED."cf_term_12_months","cf_date_moved_to_not_renewing"=EXCLUDED."cf_date_moved_to_not_renewing","cf_adobe_sign_exp_date"=EXCLUDED."cf_adobe_sign_exp_date","cf_next_cl_contact"=EXCLUDED."cf_next_cl_contact","cf__of_years_in_next_payment_term"=EXCLUDED."cf__of_years_in_next_payment_term","cf__of_years_in_previous_payment_term"=EXCLUDED."cf__of_years_in_previous_payment_term","cf_ap_processed_alliance_fee"=EXCLUDED."cf_ap_processed_alliance_fee","cf_days_to_pay_alliance_partner"=EXCLUDED."cf_days_to_pay_alliance_partner","cf_alliance_fee_tier"=EXCLUDED."cf_alliance_fee_tier","cf_alliance_partner_order_status"=EXCLUDED."cf_alliance_partner_order_status","cf_biz_dev_reviewed"=EXCLUDED."cf_biz_dev_reviewed","cf_csr_returned_for_correction"=EXCLUDED."cf_csr_returned_for_correction","cf_dt_expiration_date"=EXCLUDED."cf_dt_expiration_date","cf_original_license_type"=EXCLUDED."cf_original_license_type","cf_opp_alliance_partner"=EXCLUDED."cf_opp_alliance_partner","cf_return_details"=EXCLUDED."cf_return_details","cf_original_closedwon_date"=EXCLUDED."cf_original_closedwon_date","cf_current_subscription_term"=EXCLUDED."cf_current_subscription_term","cf_last_customer_contact"=EXCLUDED."cf_last_customer_contact","cf_opportunity_name"=EXCLUDED."cf_opportunity_name","cf_lead_source"=EXCLUDED."cf_lead_source","cf_next_ar_contact"=EXCLUDED."cf_next_ar_contact","cf_opp_presale_contract_request"=EXCLUDED."cf_opp_presale_contract_request","cf_end_date"=EXCLUDED."cf_end_date","cf_ren_audit_review"=EXCLUDED."cf_ren_audit_review","cf_counsel_reviewed"=EXCLUDED."cf_counsel_reviewed","cf_flagged_by_mahas_team"=EXCLUDED."cf_flagged_by_mahas_team","cf_submitted_for_approval"=EXCLUDED."cf_submitted_for_approval","cf_order_reviewed_by"=EXCLUDED."cf_order_reviewed_by","cf_group_account_name"=EXCLUDED."cf_group_account_name","cf_payment_frequency"=EXCLUDED."cf_payment_frequency","cf_submitted_to_counsel_review"=EXCLUDED."cf_submitted_to_counsel_review","cf_2nd_contact_date"=EXCLUDED."cf_2nd_contact_date","cf_case_type"=EXCLUDED."cf_case_type","cf_return_notes"=EXCLUDED."cf_return_notes","cf_engagement_status"=EXCLUDED."cf_engagement_status","cf_product"=EXCLUDED."cf_product","cf_review_link"=EXCLUDED."cf_review_link","cf_contract_license_ordered"=EXCLUDED."cf_contract_license_ordered","cf_ar_license_ordered"=EXCLUDED."cf_ar_license_ordered","cf_opp_has_problematic_pricing"=EXCLUDED."cf_opp_has_problematic_pricing","cf_renewal_amount_this_year"=EXCLUDED."cf_renewal_amount_this_year","cf_days_since_contact"=EXCLUDED."cf_days_since_contact","cf_my_call_list_est"=EXCLUDED."cf_my_call_list_est","cf_order_sheet_name"=EXCLUDED."cf_order_sheet_name","cf_date_signed_by_syncfusion"=EXCLUDED."cf_date_signed_by_syncfusion","cf_invoice_due_date"=EXCLUDED."cf_invoice_due_date","cf_return_identified_by"=EXCLUDED."cf_return_identified_by","cf_contract_sent"=EXCLUDED."cf_contract_sent","cf_paralegal_contracts_to_returncancel"=EXCLUDED."cf_paralegal_contracts_to_returncancel","cf_total_contract_amount"=EXCLUDED."cf_total_contract_amount","cf_order_sheet_incomplete"=EXCLUDED."cf_order_sheet_incomplete","cf_salescr_action_needed"=EXCLUDED."cf_salescr_action_needed","cf_link_to_return_opportunity"=EXCLUDED."cf_link_to_return_opportunity","cf_company"=EXCLUDED."cf_company","cf_opportunity_category"=EXCLUDED."cf_opportunity_category","cf_product_or_plan"=EXCLUDED."cf_product_or_plan","cf_revenue_type"=EXCLUDED."cf_revenue_type","cf_call_country"=EXCLUDED."cf_call_country","cf_last_renewal_order_id"=EXCLUDED."cf_last_renewal_order_id","cf_demo_scheduled"=EXCLUDED."cf_demo_scheduled","cf_reason_lost_comments"=EXCLUDED."cf_reason_lost_comments","cf_opportunity_source"=EXCLUDED."cf_opportunity_source","cf_download_country"=EXCLUDED."cf_download_country","cf_reason_lost"=EXCLUDED."cf_reason_lost","cf_alliance_partner_status"=EXCLUDED."cf_alliance_partner_status","cf_customerid"=EXCLUDED."cf_customerid","cf_no_of_order_sheets_in_opp"=EXCLUDED."cf_no_of_order_sheets_in_opp","cf_previous_dt_order_amount"=EXCLUDED."cf_previous_dt_order_amount","cf_manager_at_time_of_sale"=EXCLUDED."cf_manager_at_time_of_sale","cf_department"=EXCLUDED."cf_department","cf_known_company_url"=EXCLUDED."cf_known_company_url","cf_secondary_ap_contact"=EXCLUDED."cf_secondary_ap_contact","cf_is_invoice_collectible"=EXCLUDED."cf_is_invoice_collectible","cf_problematic_pricing_acct"=EXCLUDED."cf_problematic_pricing_acct","cf_tier_1_country_code"=EXCLUDED."cf_tier_1_country_code","cf_renewal_status"=EXCLUDED."cf_renewal_status","cf_renewal_confirmation"=EXCLUDED."cf_renewal_confirmation","cf_contract_reviewed"=EXCLUDED."cf_contract_reviewed","cf_reason_returned"=EXCLUDED."cf_reason_returned","cf_resolution"=EXCLUDED."cf_resolution","cf_po_obtained_legal"=EXCLUDED."cf_po_obtained_legal","cf_contact_lead_source"=EXCLUDED."cf_contact_lead_source","cf_salescrr_issue_resolved"=EXCLUDED."cf_salescrr_issue_resolved","cf_primary_ap_contact"=EXCLUDED."cf_primary_ap_contact","cf_visual_compliance_run_by"=EXCLUDED."cf_visual_compliance_run_by","cf_crr_rep"=EXCLUDED."cf_crr_rep","cf_crr_corrections_required"=EXCLUDED."cf_crr_corrections_required","cf_returnrebook"=EXCLUDED."cf_returnrebook","cf_payment_confirmation_attached"=EXCLUDED."cf_payment_confirmation_attached","cf_tier_1_country_name"=EXCLUDED."cf_tier_1_country_name","cf_1st_contact_date"=EXCLUDED."cf_1st_contact_date","cf_email"=EXCLUDED."cf_email","cf_submitted_for_processing"=EXCLUDED."cf_submitted_for_processing","cf_rejected_to_rep"=EXCLUDED."cf_rejected_to_rep","cf_returned_for_corrections"=EXCLUDED."cf_returned_for_corrections","cf_order_sheet_processed"=EXCLUDED."cf_order_sheet_processed","cf_record_type"=EXCLUDED."cf_record_type","cf_upgrade_dollar_amount"=EXCLUDED."cf_upgrade_dollar_amount","cf_total_sale_amount"=EXCLUDED."cf_total_sale_amount","cf_month_one_amount"=EXCLUDED."cf_month_one_amount","cf_month_two_amount"=EXCLUDED."cf_month_two_amount","cf_month_three_amount"=EXCLUDED."cf_month_three_amount","cf_month_four_amount"=EXCLUDED."cf_month_four_amount","cf_month_five_amount"=EXCLUDED."cf_month_five_amount","cf_month_six_amount"=EXCLUDED."cf_month_six_amount","cf_month_seven_amount"=EXCLUDED."cf_month_seven_amount","cf_month_eight_amount"=EXCLUDED."cf_month_eight_amount","cf_month_nine_amount"=EXCLUDED."cf_month_nine_amount","cf_month_ten_amount"=EXCLUDED."cf_month_ten_amount","cf_month_eleven_amount"=EXCLUDED."cf_month_eleven_amount","cf_month_twelve_amount"=EXCLUDED."cf_month_twelve_amount","cf_fee_to_alliance_partner"=EXCLUDED."cf_fee_to_alliance_partner","cf_contract_status"=EXCLUDED."cf_contract_status","cf_3rd_contact_date"=EXCLUDED."cf_3rd_contact_date","cf_payment_method"=EXCLUDED."cf_payment_method","cf_bold_commissionable_amount"=EXCLUDED."cf_bold_commissionable_amount","cf_customer_invoice_details"=EXCLUDED."cf_customer_invoice_details","cf_stripe_order"=EXCLUDED."cf_stripe_order","cf_year_one_contract_amount"=EXCLUDED."cf_year_one_contract_amount","cf_case_resolution"=EXCLUDED."cf_case_resolution","cf_sales_admin_correction_requested"=EXCLUDED."cf_sales_admin_correction_requested","cf_date_agreement_effective"=EXCLUDED."cf_date_agreement_effective","cf_date_agreement_expires"=EXCLUDED."cf_date_agreement_expires","cf_date_sent_to_customer"=EXCLUDED."cf_date_sent_to_customer","cf_date_estimate_sent_to_customer"=EXCLUDED."cf_date_estimate_sent_to_customer","cf_date_signed_by_customer"=EXCLUDED."cf_date_signed_by_customer","cf_case_car_rep"=EXCLUDED."cf_case_car_rep","cf_crr_split_amount"=EXCLUDED."cf_crr_split_amount","cf_follow_up_date"=EXCLUDED."cf_follow_up_date","cf_outstanding_amount"=EXCLUDED."cf_outstanding_amount","cf_amount_collected_by_legal"=EXCLUDED."cf_amount_collected_by_legal","cf_payment_outcome"=EXCLUDED."cf_payment_outcome","cf_invoice_sent"=EXCLUDED."cf_invoice_sent","cf_contract_complete_or_closed"=EXCLUDED."cf_contract_complete_or_closed","cf_reason_for_no_contract"=EXCLUDED."cf_reason_for_no_contract","cf_payment_obtained_legal"=EXCLUDED."cf_payment_obtained_legal","cf_review_site"=EXCLUDED."cf_review_site","cf_order_info_needed"=EXCLUDED."cf_order_info_needed","cf_collection_legal_status"=EXCLUDED."cf_collection_legal_status","cf_last_collections_contact"=EXCLUDED."cf_last_collections_contact","cf_total_invoice_amount"=EXCLUDED."cf_total_invoice_amount","cf_salescr_action_type"=EXCLUDED."cf_salescr_action_type","cf_case_description"=EXCLUDED."cf_case_description","cf_date_sent_to_jv"=EXCLUDED."cf_date_sent_to_jv","cf_date_fully_executed"=EXCLUDED."cf_date_fully_executed","cf_90_days_support"=EXCLUDED."cf_90_days_support","cf_weekly_call_day"=EXCLUDED."cf_weekly_call_day","cf_last_ar_contact"=EXCLUDED."cf_last_ar_contact","cf_related_opp_account_name"=EXCLUDED."cf_related_opp_account_name","cf_related_opp_close_date"=EXCLUDED."cf_related_opp_close_date","cf_on_hold_details"=EXCLUDED."cf_on_hold_details","cf_responsible_for_inv"=EXCLUDED."cf_responsible_for_inv","cf_due_date"=EXCLUDED."cf_due_date","cf_status"=EXCLUDED."cf_status","cf_dt_order_id"=EXCLUDED."cf_dt_order_id","cf_salescrr_invoice_issue"=EXCLUDED."cf_salescrr_invoice_issue","cf_days_suppport_remaining"=EXCLUDED."cf_days_suppport_remaining","cf_alliance_partner"=EXCLUDED."cf_alliance_partner","cf_manager"=EXCLUDED."cf_manager","cf_visual_compliance_run"=EXCLUDED."cf_visual_compliance_run","cf_syncfusion_sales_rep"=EXCLUDED."cf_syncfusion_sales_rep","cf_absolute_revenue"=EXCLUDED."cf_absolute_revenue","cf_car_rep"=EXCLUDED."cf_car_rep","cf_next_contact_date"=EXCLUDED."cf_next_contact_date","cf_opportunity_amount"=EXCLUDED."cf_opportunity_amount","cf_task_subtype"=EXCLUDED."cf_task_subtype","cf_day_log"=EXCLUDED."cf_day_log","cf_time_activity_logged"=EXCLUDED."cf_time_activity_logged","cf_call_type"=EXCLUDED."cf_call_type","cf_call_result"=EXCLUDED."cf_call_result","cf_license_ordered"=EXCLUDED."cf_license_ordered","cf_presale_contract_request"=EXCLUDED."cf_presale_contract_request","cf_assigned_to"=EXCLUDED."cf_assigned_to","cf_ar_status"=EXCLUDED."cf_ar_status","cf_date_sent_to_legal"=EXCLUDED."cf_date_sent_to_legal","cf_order_entered"=EXCLUDED."cf_order_entered","cf_verified_return_in_dt"=EXCLUDED."cf_verified_return_in_dt","cf_confirmed_order_csr"=EXCLUDED."cf_confirmed_order_csr","cf_date_order_closed_paidret"=EXCLUDED."cf_date_order_closed_paidret","cf_discount"=EXCLUDED."cf_discount","cf_email_subject"=EXCLUDED."cf_email_subject","cf_salescrr_issue_type"=EXCLUDED."cf_salescrr_issue_type","cf_sales_rep_split_amount"=EXCLUDED."cf_sales_rep_split_amount","cf_cg_billing_postal_code"=EXCLUDED."cf_cg_billing_postal_code","cf_cg_known_company_url"=EXCLUDED."cf_cg_known_company_url","cf_problematic_pricing_opps"=EXCLUDED."cf_problematic_pricing_opps","cf_cg_billing_street"=EXCLUDED."cf_cg_billing_street","cf_cg_billing_city"=EXCLUDED."cf_cg_billing_city","cf_contact_license_type"=EXCLUDED."cf_contact_license_type","cf_group_billing_country"=EXCLUDED."cf_group_billing_country","cf_order_entered_by"=EXCLUDED."cf_order_entered_by","cf_reason_for_owner_change"=EXCLUDED."cf_reason_for_owner_change","cf_acct_has_problematic_pricing"=EXCLUDED."cf_acct_has_problematic_pricing","cf_opp_acct_has_problematic_pricing"=EXCLUDED."cf_opp_acct_has_problematic_pricing","cf_channel"=EXCLUDED."cf_channel","cf_csr_confirmed_alliance_order"=EXCLUDED."cf_csr_confirmed_alliance_order","cf_submitted_for_bd_review"=EXCLUDED."cf_submitted_for_bd_review","contactname"=EXCLUDED."contactname","Invoice Age"=EXCLUDED."Invoice Age","stage"=EXCLUDED."stage","Amount After Discount"=EXCLUDED."Amount After Discount","Days To Expiration"=EXCLUDED."Days To Expiration","Days To Payment"=EXCLUDED."Days To Payment","Days To Payment 2"=EXCLUDED."Days To Payment 2","Days To Invoice Payment"=EXCLUDED."Days To Invoice Payment","Days not renewing to closed"=EXCLUDED."Days not renewing to closed","Sales Admin Review Days"=EXCLUDED."Sales Admin Review Days","Close Date to Processed"=EXCLUDED."Close Date to Processed","Days to Process"=EXCLUDED."Days to Process","Close to Final CRRB Checks"=EXCLUDED."Close to Final CRRB Checks","Close vs. Exp date"=EXCLUDED."Close vs. Exp date","Days Since Close Date"=EXCLUDED."Days Since Close Date","Days Open"=EXCLUDED."Days Open","Absolute Close Won Date"=EXCLUDED."Absolute Close Won Date","Upgrade Amount"=EXCLUDED."Upgrade Amount","When was Alliance Partner Paid"=EXCLUDED."When was Alliance Partner Paid","Opportunity Age"=EXCLUDED."Opportunity Age","Bold Team"=EXCLUDED."Bold Team","Collections or AR?"=EXCLUDED."Collections or AR?","Call time"=EXCLUDED."Call time","Follow Up Type"=EXCLUDED."Follow Up Type","Contract Result"=EXCLUDED."Contract Result","Eligible for Contract"=EXCLUDED."Eligible for Contract","Contract"=EXCLUDED."Contract","CRRB Processing Time"=EXCLUDED."CRRB Processing Time","Days To Final CRRB Check"=EXCLUDED."Days To Final CRRB Check","Days to Process(str)"=EXCLUDED."Days to Process(str)","Invoice Age(Str)"=EXCLUDED."Invoice Age(Str)","Close to payment"=EXCLUDED."Close to payment","Eligible Date to Close"=EXCLUDED."Eligible Date to Close","DT Order Link"=EXCLUDED."DT Order Link","Tier 1 Region"=EXCLUDED."Tier 1 Region","Adjusted Projected REN"=EXCLUDED."Adjusted Projected REN","Percent Invoice Paid"=EXCLUDED."Percent Invoice Paid","Days to Submit Order"=EXCLUDED."Days to Submit Order","Days to Submit Order_bucket"=EXCLUDED."Days to Submit Order_bucket","Annualized Revenue"=EXCLUDED."Annualized Revenue","Closed By Expiration"=EXCLUDED."Closed By Expiration","Link to Next REN Opportunity"=EXCLUDED."Link to Next REN Opportunity","Link to Old REN Opportunity"=EXCLUDED."Link to Old REN Opportunity","cf_ren_contract_notes"=EXCLUDED."cf_ren_contract_notes","cf_collections_legal_notes"=EXCLUDED."cf_collections_legal_notes","cf_ar_notes"=EXCLUDED."cf_ar_notes","cf_contract_retrieval_notes"=EXCLUDED."cf_contract_retrieval_notes","cf_comments"=EXCLUDED."cf_comments","cf_order_evaluation_notes"=EXCLUDED."cf_order_evaluation_notes","cf_counsel_order_notes"=EXCLUDED."cf_counsel_order_notes","cf_notes_from_sales_leadership"=EXCLUDED."cf_notes_from_sales_leadership","cf_notes_to_ar_manager"=EXCLUDED."cf_notes_to_ar_manager","cf_po_notes_legal"=EXCLUDED."cf_po_notes_legal","cf_collections_correspondence"=EXCLUDED."cf_collections_correspondence","cf_admin_internal_notes"=EXCLUDED."cf_admin_internal_notes","cf_paralegal_notes"=EXCLUDED."cf_paralegal_notes","cf_rep_notes"=EXCLUDED."cf_rep_notes","Opportunity Owner Designation"=EXCLUDED."Opportunity Owner Designation","Opportunity Owner Role"=EXCLUDED."Opportunity Owner Role","Opportunity Owner Department"=EXCLUDED."Opportunity Owner Department","Opportunity Owner Workstation"=EXCLUDED."Opportunity Owner Workstation","Opportunity Owner Division"=EXCLUDED."Opportunity Owner Division","Opportunity Owner : Active"=EXCLUDED."Opportunity Owner : Active","Opportunity Owner : Manager"=EXCLUDED."Opportunity Owner : Manager","isreportingpersonasmaanager"=EXCLUDED."isreportingpersonasmaanager","Opportunity Owner : Reporting Person"=EXCLUDED."Opportunity Owner : Reporting Person","User End Date"=EXCLUDED."User End Date","Opportunity Owner IsActive"=EXCLUDED."Opportunity Owner IsActive","Car_Rep_Contact"=EXCLUDED."Car_Rep_Contact",
   "sales/cr-notes-with-legal" = EXCLUDED."sales/cr-notes-with-legal",
	"Counsel-Notes"= EXCLUDED."Counsel-Notes",
	"Closed-Lost-Qualification-Notes" = EXCLUDED."Closed-Lost-Qualification-Notes",
	"SE-Notes"=EXCLUDED."SE-Notes",
	"CR-Notes"=EXCLUDED."CR-Notes",
	"Sales-Leadership-Notes"=EXCLUDED."Sales-Leadership-Notes",
	"About-This-Opportunity"=EXCLUDED."About-This-Opportunity",
	"contract-notes"=EXCLUDED."contract-notes",
	"project-notes"=EXCLUDED."project-notes",
	"case-comments"=EXCLUDED."case-comments",	
	"project-name-cst"=EXCLUDED."project-name-cst";
	 raise notice 'Child Contract Ticket detail update  Completed time %',transaction_timestamp();
	INSERT INTO public.related_ordersheet_ticket_detail (parentid,id,org_id,brand_id,org_brand_id,brand_name,"Opportunity Name",is_visible_in_customer_portal,requested_by,requester,assigned_to_user_id,assignee,"AR Rep",assigned_to_group_id,"group",contact_group_id,contact_group,resolution_due_on,ticket_status_id,status,ticket_source_id,source,update_count,note_count,attachment_count,work_log_count,total_time_logged,total_billable_time_logged,first_response_due_on,next_response_due_on,last_replied_on,last_replied_by_id,last_replied_by,last_replied_by_user_type_id,last_replied_by_user_type,closed_on,closed_by,closed_by_name,created_on,created_by,creator,last_modified_on,last_modified_by,"Last Modified By",is_spam,is_active,tsv,is_resolution_date_modified,last_status_changed_on,is_first_response_updated,ticket_type_option_id,ticket_category_option_id,ticket_priority_id,priority,"Account Name",subject,type,category,email,"OpportunityOwner",time_spent,unique_external_reference_id,agentid,notes,isnotesprivate,notetype,assigned ,cf_car_rep,cf_cg_billing_postal_code,cf_cg_known_company_url,cf_problematic_pricing_opps,cf_cg_billing_street,cf_cg_billing_city,"cf_month_three_amount","cf_month_two_amount","cf_month_one_amount","cf_reseller_amount","cf_bold_referral_partner","cf_crr_split_amount","cf_fee_to_alliance_partner","cf_projectdivision_name","cf_total_sale_amount","cf_include_third_party_contractors","cf_record_type","cf_external_reference_id","cf_order_sheet_status","cf_rejected_to_rep","cf_submitted_for_processing","cf_crr_corrections_required","cf_crr_rep","cf_returnrebook","cf_special_instructionsnotes","cf_submitted_for_approval","cf_visual_compliance_run_by","cf_contract_term","cf_month_six_amount","cf_contract_start_date","cf_portal_admin_direct_trac_id_packflat","cf_year_one_fee","cf_month_five_amount","cf_order_sheet_processed","cf_month_twelve_amount","cf_month_seven_amount","cf_month_nine_amount","cf_year_eight_fee","cf_year_five_fee","cf_year_four_fee","cf_year_nine_fee","cf_year_seven_fee","cf_year_six_fee","cf_year_three_fee","cf_year_two_fee","cf_month_eleven_amount","cf_payment_frequency","cf_payment_terms","cf_order_id_to_renew","cf_premium_support","cf_sales_admin_correction_requested","cf_tss_support","cf_bold_tenant_id_or_portal_name","cf_stripe_order","cf_account_name","cf_associated_dt_order","cf_current_opportunity_stage","cf_order_visual_compliance_run","cf_reseller","cf_order_entered","cf_verified_return_in_dt","cf_order_sheet_name","cf_upgrade_dollar_amount","cf_portal_admin_country","cf_customer_invoice_details","cf_portal_admin_full_name_packflat","cf_payment_confirmation_attached","cf_alliance_fee_tier","cf_csr_returned_for_correction","cf_alliance_partner","cf_confirmed_order_csr","cf_contracted_amount_reseller_orders","cf_application_name","cf_product_1_name","cf_main_project_contact_full_name","cf_month_eight_amount","cf_optional_renewal_years","cf_official_company_name","cf_order_entered_by","cf_end_user_1_direct_trac_id","cf_end_user_4_full_name","cf_end_user_2_full_name","cf_end_user_3_full_name","cf_end_user_5_full_name","cf_end_user_3_direct_trac_id","cf_end_user_2_direct_trac_id","cf_end_user_4_direct_trac_id","cf_end_user_5_direct_trac_id","cf_main_project_contact_direct_trac_id","cf_bill_toap_dt_customer_id","cf_manager","cf_taxvat_id","cf_po_number","cf_enterpriseportal_id","cf_contract_signatory_full_name","cf_contract_signatory_dt_customer_id","cf_sales_rep_split_amount","cf_end_user_1_full_name","cf_payment_method","cf_next_renewal_date","cf_is_there_a_reseller_involved","cf_is_this_an_upgrade","cf_license_type","cf_portal_admin_time_zone","cf_bold_commissionable_amount","cf_syncfusion_sales_rep","cf_are_vendor_forms_needed","cf_eventual_monthly_payment","cf_month_four_amount","cf_month_ten_amount","cf_returned_for_corrections","Sales Admin Review Days","Close Date to Processed","Days to Process","Days Since Close Date","Days Open","Call time" ,"CRRB Processing Time" ,"Days to Process(str)" ,"DT Order Link" ,"Days to Submit Order","Days to Submit Order_bucket","Annualized Revenue","Days To Final CRRB Check","Close to Final CRRB Checks")
SELECT * from public.get_related_ordersheet_ticket_detail(
	array_to_string(newids,',')
)
ON CONFLICT ("parentid","id") 
DO 
   UPDATE SET parentid=EXCLUDED.parentid,id=EXCLUDED.id,org_id=EXCLUDED.org_id,brand_id=EXCLUDED.brand_id,org_brand_id=EXCLUDED.org_brand_id,brand_name=EXCLUDED.brand_name,"Opportunity Name"=EXCLUDED."Opportunity Name",is_visible_in_customer_portal=EXCLUDED.is_visible_in_customer_portal,requested_by=EXCLUDED.requested_by,requester=EXCLUDED.requester,assigned_to_user_id=EXCLUDED.assigned_to_user_id,assignee=EXCLUDED.assignee,"AR Rep"=EXCLUDED."AR Rep",assigned_to_group_id=EXCLUDED.assigned_to_group_id,"group"=EXCLUDED."group",contact_group_id=EXCLUDED.contact_group_id,contact_group=EXCLUDED.contact_group,resolution_due_on=EXCLUDED.resolution_due_on,ticket_status_id=EXCLUDED.ticket_status_id,status=EXCLUDED.status,ticket_source_id=EXCLUDED.ticket_source_id,source=EXCLUDED.source,update_count=EXCLUDED.update_count,note_count=EXCLUDED.note_count,attachment_count=EXCLUDED.attachment_count,work_log_count=EXCLUDED.work_log_count,total_time_logged=EXCLUDED.total_time_logged,total_billable_time_logged=EXCLUDED.total_billable_time_logged,first_response_due_on=EXCLUDED.first_response_due_on,next_response_due_on=EXCLUDED.next_response_due_on,last_replied_on=EXCLUDED.last_replied_on,last_replied_by_id=EXCLUDED.last_replied_by_id,last_replied_by=EXCLUDED.last_replied_by,last_replied_by_user_type_id=EXCLUDED.last_replied_by_user_type_id,last_replied_by_user_type=EXCLUDED.last_replied_by_user_type,closed_on=EXCLUDED.closed_on,closed_by=EXCLUDED.closed_by,closed_by_name=EXCLUDED.closed_by_name,created_on=EXCLUDED.created_on,created_by=EXCLUDED.created_by,creator=EXCLUDED.creator,last_modified_on=EXCLUDED.last_modified_on,last_modified_by=EXCLUDED.last_modified_by,"Last Modified By"=EXCLUDED."Last Modified By",is_spam=EXCLUDED.is_spam,is_active=EXCLUDED.is_active,tsv=EXCLUDED.tsv,is_resolution_date_modified=EXCLUDED.is_resolution_date_modified,last_status_changed_on=EXCLUDED.last_status_changed_on,is_first_response_updated=EXCLUDED.is_first_response_updated,ticket_type_option_id=EXCLUDED.ticket_type_option_id,ticket_category_option_id=EXCLUDED.ticket_category_option_id,ticket_priority_id=EXCLUDED.ticket_priority_id,priority=EXCLUDED.priority,"Account Name"=EXCLUDED."Account Name",subject=EXCLUDED.subject,type=EXCLUDED.type,category=EXCLUDED.category,email=EXCLUDED.email,"OpportunityOwner"=EXCLUDED."OpportunityOwner",time_spent=EXCLUDED.time_spent,unique_external_reference_id=EXCLUDED.unique_external_reference_id,agentid=EXCLUDED.agentid,notes=EXCLUDED.notes,isnotesprivate=EXCLUDED.isnotesprivate,notetype=EXCLUDED.notetype,assigned =EXCLUDED.assigned ,cf_car_rep=EXCLUDED.cf_car_rep,cf_cg_billing_postal_code=EXCLUDED.cf_cg_billing_postal_code,cf_cg_known_company_url=EXCLUDED.cf_cg_known_company_url,cf_problematic_pricing_opps=EXCLUDED.cf_problematic_pricing_opps,cf_cg_billing_street=EXCLUDED.cf_cg_billing_street,cf_cg_billing_city=EXCLUDED.cf_cg_billing_city,"cf_month_three_amount"=EXCLUDED."cf_month_three_amount","cf_month_two_amount"=EXCLUDED."cf_month_two_amount","cf_month_one_amount"=EXCLUDED."cf_month_one_amount","cf_reseller_amount"=EXCLUDED."cf_reseller_amount","cf_bold_referral_partner"=EXCLUDED."cf_bold_referral_partner","cf_crr_split_amount"=EXCLUDED."cf_crr_split_amount","cf_fee_to_alliance_partner"=EXCLUDED."cf_fee_to_alliance_partner","cf_projectdivision_name"=EXCLUDED."cf_projectdivision_name","cf_total_sale_amount"=EXCLUDED."cf_total_sale_amount","cf_include_third_party_contractors"=EXCLUDED."cf_include_third_party_contractors","cf_record_type"=EXCLUDED."cf_record_type","cf_external_reference_id"=EXCLUDED."cf_external_reference_id","cf_order_sheet_status"=EXCLUDED."cf_order_sheet_status","cf_rejected_to_rep"=EXCLUDED."cf_rejected_to_rep","cf_submitted_for_processing"=EXCLUDED."cf_submitted_for_processing","cf_crr_corrections_required"=EXCLUDED."cf_crr_corrections_required","cf_crr_rep"=EXCLUDED."cf_crr_rep","cf_returnrebook"=EXCLUDED."cf_returnrebook","cf_special_instructionsnotes"=EXCLUDED."cf_special_instructionsnotes","cf_submitted_for_approval"=EXCLUDED."cf_submitted_for_approval","cf_visual_compliance_run_by"=EXCLUDED."cf_visual_compliance_run_by","cf_contract_term"=EXCLUDED."cf_contract_term","cf_month_six_amount"=EXCLUDED."cf_month_six_amount","cf_contract_start_date"=EXCLUDED."cf_contract_start_date","cf_portal_admin_direct_trac_id_packflat"=EXCLUDED."cf_portal_admin_direct_trac_id_packflat","cf_year_one_fee"=EXCLUDED."cf_year_one_fee","cf_month_five_amount"=EXCLUDED."cf_month_five_amount","cf_order_sheet_processed"=EXCLUDED."cf_order_sheet_processed","cf_month_twelve_amount"=EXCLUDED."cf_month_twelve_amount","cf_month_seven_amount"=EXCLUDED."cf_month_seven_amount","cf_month_nine_amount"=EXCLUDED."cf_month_nine_amount","cf_year_eight_fee"=EXCLUDED."cf_year_eight_fee","cf_year_five_fee"=EXCLUDED."cf_year_five_fee","cf_year_four_fee"=EXCLUDED."cf_year_four_fee","cf_year_nine_fee"=EXCLUDED."cf_year_nine_fee","cf_year_seven_fee"=EXCLUDED."cf_year_seven_fee","cf_year_six_fee"=EXCLUDED."cf_year_six_fee","cf_year_three_fee"=EXCLUDED."cf_year_three_fee","cf_year_two_fee"=EXCLUDED."cf_year_two_fee","cf_month_eleven_amount"=EXCLUDED."cf_month_eleven_amount","cf_payment_frequency"=EXCLUDED."cf_payment_frequency","cf_payment_terms"=EXCLUDED."cf_payment_terms","cf_order_id_to_renew"=EXCLUDED."cf_order_id_to_renew","cf_premium_support"=EXCLUDED."cf_premium_support","cf_sales_admin_correction_requested"=EXCLUDED."cf_sales_admin_correction_requested","cf_tss_support"=EXCLUDED."cf_tss_support","cf_bold_tenant_id_or_portal_name"=EXCLUDED."cf_bold_tenant_id_or_portal_name","cf_stripe_order"=EXCLUDED."cf_stripe_order","cf_account_name"=EXCLUDED."cf_account_name","cf_associated_dt_order"=EXCLUDED."cf_associated_dt_order","cf_current_opportunity_stage"=EXCLUDED."cf_current_opportunity_stage","cf_order_visual_compliance_run"=EXCLUDED."cf_order_visual_compliance_run","cf_reseller"=EXCLUDED."cf_reseller","cf_order_entered"=EXCLUDED."cf_order_entered","cf_verified_return_in_dt"=EXCLUDED."cf_verified_return_in_dt","cf_order_sheet_name"=EXCLUDED."cf_order_sheet_name","cf_upgrade_dollar_amount"=EXCLUDED."cf_upgrade_dollar_amount","cf_portal_admin_country"=EXCLUDED."cf_portal_admin_country","cf_customer_invoice_details"=EXCLUDED."cf_customer_invoice_details","cf_portal_admin_full_name_packflat"=EXCLUDED."cf_portal_admin_full_name_packflat","cf_payment_confirmation_attached"=EXCLUDED."cf_payment_confirmation_attached","cf_alliance_fee_tier"=EXCLUDED."cf_alliance_fee_tier","cf_csr_returned_for_correction"=EXCLUDED."cf_csr_returned_for_correction","cf_alliance_partner"=EXCLUDED."cf_alliance_partner","cf_confirmed_order_csr"=EXCLUDED."cf_confirmed_order_csr","cf_contracted_amount_reseller_orders"=EXCLUDED."cf_contracted_amount_reseller_orders","cf_application_name"=EXCLUDED."cf_application_name","cf_product_1_name"=EXCLUDED."cf_product_1_name","cf_main_project_contact_full_name"=EXCLUDED."cf_main_project_contact_full_name","cf_month_eight_amount"=EXCLUDED."cf_month_eight_amount","cf_optional_renewal_years"=EXCLUDED."cf_optional_renewal_years","cf_official_company_name"=EXCLUDED."cf_official_company_name","cf_order_entered_by"=EXCLUDED."cf_order_entered_by","cf_end_user_1_direct_trac_id"=EXCLUDED."cf_end_user_1_direct_trac_id","cf_end_user_4_full_name"=EXCLUDED."cf_end_user_4_full_name","cf_end_user_2_full_name"=EXCLUDED."cf_end_user_2_full_name","cf_end_user_3_full_name"=EXCLUDED."cf_end_user_3_full_name","cf_end_user_5_full_name"=EXCLUDED."cf_end_user_5_full_name","cf_end_user_3_direct_trac_id"=EXCLUDED."cf_end_user_3_direct_trac_id","cf_end_user_2_direct_trac_id"=EXCLUDED."cf_end_user_2_direct_trac_id","cf_end_user_4_direct_trac_id"=EXCLUDED."cf_end_user_4_direct_trac_id","cf_end_user_5_direct_trac_id"=EXCLUDED."cf_end_user_5_direct_trac_id","cf_main_project_contact_direct_trac_id"=EXCLUDED."cf_main_project_contact_direct_trac_id","cf_bill_toap_dt_customer_id"=EXCLUDED."cf_bill_toap_dt_customer_id","cf_manager"=EXCLUDED."cf_manager","cf_taxvat_id"=EXCLUDED."cf_taxvat_id","cf_po_number"=EXCLUDED."cf_po_number","cf_enterpriseportal_id"=EXCLUDED."cf_enterpriseportal_id","cf_contract_signatory_full_name"=EXCLUDED."cf_contract_signatory_full_name","cf_contract_signatory_dt_customer_id"=EXCLUDED."cf_contract_signatory_dt_customer_id","cf_sales_rep_split_amount"=EXCLUDED."cf_sales_rep_split_amount","cf_end_user_1_full_name"=EXCLUDED."cf_end_user_1_full_name","cf_payment_method"=EXCLUDED."cf_payment_method","cf_next_renewal_date"=EXCLUDED."cf_next_renewal_date","cf_is_there_a_reseller_involved"=EXCLUDED."cf_is_there_a_reseller_involved","cf_is_this_an_upgrade"=EXCLUDED."cf_is_this_an_upgrade","cf_license_type"=EXCLUDED."cf_license_type","cf_portal_admin_time_zone"=EXCLUDED."cf_portal_admin_time_zone","cf_bold_commissionable_amount"=EXCLUDED."cf_bold_commissionable_amount","cf_syncfusion_sales_rep"=EXCLUDED."cf_syncfusion_sales_rep","cf_are_vendor_forms_needed"=EXCLUDED."cf_are_vendor_forms_needed","cf_eventual_monthly_payment"=EXCLUDED."cf_eventual_monthly_payment","cf_month_four_amount"=EXCLUDED."cf_month_four_amount","cf_month_ten_amount"=EXCLUDED."cf_month_ten_amount","cf_returned_for_corrections"=EXCLUDED."cf_returned_for_corrections","Sales Admin Review Days"=EXCLUDED."Sales Admin Review Days","Close Date to Processed"=EXCLUDED."Close Date to Processed","Days to Process"=EXCLUDED."Days to Process","Days Since Close Date"=EXCLUDED."Days Since Close Date","Days Open"=EXCLUDED."Days Open","Call time" =EXCLUDED."Call time" ,"CRRB Processing Time" =EXCLUDED."CRRB Processing Time" ,"Days to Process(str)" =EXCLUDED."Days to Process(str)" ,"DT Order Link" =EXCLUDED."DT Order Link" ,"Days to Submit Order"=EXCLUDED."Days to Submit Order","Days to Submit Order_bucket"=EXCLUDED."Days to Submit Order_bucket","Annualized Revenue"=EXCLUDED."Annualized Revenue"
   ,"Days To Final CRRB Check"=EXCLUDED."Days To Final CRRB Check","Close to Final CRRB Checks"=EXCLUDED."Close to Final CRRB Checks";
   raise notice 'Order Sheet related Ticket detail update  Completed time %', transaction_timestamp();
   
 insert into  public.child_activitiescallemail_ticket_detail(id, messageid, tagid, subject, assigned, created_on, activityname )
 SELECT * from get_related_childactiviescallemail_ticket_detail(
	array_to_string(newids,',')
)
ON CONFLICT ("messageid","tagid") 
DO 
   UPDATE SET 
  id=EXCLUDED.id, messageid=EXCLUDED.messageid, tagid=EXCLUDED.tagid, subject=EXCLUDED.subject, 
   assigned=EXCLUDED.assigned, created_on=EXCLUDED.created_on, activityname=EXCLUDED.activityname;

update child_activitiescallemail_ticket_detail set
"Assigned Role"=sub."Assigned Role"
from (
	Select ticket.*,rdu."Assigned Role" as "Assigned Role"  FROM dblink('host=35.236.243.204 port=5432 user=salesopreaduser password=b9c!l9M4#zQ dbname=org-538', 
					 format( 'select tm.message_id as messageid,
tag.id as tagid,users.email
							 from
(select * from public.ticket_detail where id in (%s) and ticket_category_option_id=4 and is_active=true) td
    left join public.ticket_update tu on tu.ticket_id = td.id and tu.ticket_update_type_id !=1
    left join public.tag_mapper tm on tm.message_id = tu.id
    left join public.tag on tag.id=tm.tag_id and tag.id in (38,39)
    left join public.users on users.id = tu.created_by
						--  LEFT JOIN ticket_time_log timelog ON timelog.ticket_id = tu.ticket_id and tu.created_by=timelog.user_id and timelog.time_log_date=tu.created_on

	where tag.name != '''' or tag.name != null',array_to_string(newids,',')) ) ticket( messageid bigint,tagid bigint, email character varying
																 )
	LEFT Join (
	SELECT rsu.emailaddress,
   
   rdusrole.role AS "Assigned Role",
 rsu.firstname || ' ' || rsu.lastname as name
  FROM rdu_salesusers rsu   
    LEFT JOIN rdu_salesroles rdusrole ON rdusrole.id = rsu.roleid
) rdu on rdu.emailaddress=ticket.email
)sub
where child_activitiescallemail_ticket_detail.messageid=sub.messageid and child_activitiescallemail_ticket_detail.tagid=sub.tagid;

update child_activitiescallemail_ticket_detail set
"time_spent"=sub."time_spent",
time_log_date=sub.time_log_date,
"Call in Time"=sub."Call in Time"
from (
	Select ticket.*  FROM dblink('host=35.236.243.204 port=5432 user=salesopreaduser password=b9c!l9M4#zQ dbname=org-538', 
					  format('select td.id,tm.message_id as messageid,
tag.id as tagid,
regexp_replace(substring(tu.description from ''<subject>.*</subject>''), E''<[^>]+>'', '''', ''gi'') as subject,
users.name as assigned,

tu.created_on,tag.name as tagname 
							,timelog.time_spent,timelog.time_log_date  ,
CASE WHEN timelog.time_spent <= 5 THEN ''0 - 5 Min Call'' WHEN timelog.time_spent > 5 AND timelog.time_spent <= 10 THEN ''5 - 10 Min Call'' WHEN timelog.time_spent > 10 AND timelog.time_spent <= 15 THEN ''10 - 15 Min Call'' ELSE (case when timelog.time_spent > 15 then ''> 15 Min Call'' else null end) END as "Call in Time"

							 from
(select * from public.ticket_detail where id in (%s) and  ticket_category_option_id=4  and is_active=true) td
    left join public.ticket_update tu on tu.ticket_id = td.id and tu.ticket_update_type_id !=1
    left join public.tag_mapper tm on tm.message_id = tu.id
    left join public.tag on tag.id=tm.tag_id and tag.id in (38,39)
    left join public.users on users.id = tu.created_by
						 LEFT JOIN ticket_time_log timelog ON timelog.ticket_id = tu.ticket_id and tu.created_by=timelog.user_id and timelog.time_log_date=tu.created_on

	where tag.name != '''' or tag.name != null',array_to_string(newids,','))) ticket( id bigint,messageid bigint,tagid bigint, subject character varying,
															  assigned character varying,
															   created_on timestamp,
															   activityname character varying
																,time_spent bigint,time_log_date timestamp with time zone
																,"Call in Time" varchar )
)sub
where child_activitiescallemail_ticket_detail.messageid=sub.messageid and child_activitiescallemail_ticket_detail.tagid=sub.tagid;

   raise notice 'Total Records: %', reclen;
  raise notice 'New Records updated';
 UPDATE ticket_detail
SET "Link to Old REN Opportunity"=subquery."Link to Old REN Opportunity"
FROM (
 Select "Link to Old REN Opportunity" ,id

from public.dblink(
'host=35.236.243.204 port=5432 user=salesopreaduser password=b9c!l9M4#zQ dbname=org-538',

 format('Select 
--td_new.unique_external_reference_id
td_new.title::varchar as "Link to Old REN Opportunity" 
,t.id
from (select * from ticket_detail where id in ( %s )) t

LEFT Join ticket_link tl_new on t.id = tl_new.destination_ticket_id and t.ticket_category_option_id = 4 
LEFt Join ticket_detail td_new on tl_new.source_ticket_id = td_new.id and td_new.ticket_category_option_id = 4 where td_new.unique_external_reference_id != '''' and td_new.title  like ''REN%%''
  ',array_to_string(newids,',')))  as ticket("Link to Old REN Opportunity" varchar,id bigint)

) AS subquery
WHERE ticket_detail.id=subquery.id;
 raise notice 'New RENEWAL Opp updated';
	UPDATE ticket_detail
SET "Link to Next REN Opportunity"=subquery."Link to New REN Opportunity"
FROM (
 Select "Link to New REN Opportunity" ,id

from public.dblink(
'host=35.236.243.204 port=5432 user=salesopreaduser password=b9c!l9M4#zQ dbname=org-538',

 format('Select 
--td_new.unique_external_reference_id
td_new.title::varchar as "Link to New REN Opportunity" 
,t.id
from (select * from ticket_detail where id in ( %s )) t

LEFT Join ticket_link tl_new on t.id = tl_new.source_ticket_id and t.ticket_category_option_id = 4 
LEFt Join ticket_detail td_new on tl_new.destination_ticket_id = td_new.id and td_new.ticket_category_option_id = 4 
where td_new.unique_external_reference_id != '''' and td_new.title  like ''REN%%''
 ',array_to_string(newids,',')))   as ticket("Link to New REN Opportunity" varchar,id bigint)

) AS subquery
WHERE ticket_detail.id=subquery.id;
raise notice 'OLD RENEWAL Opp updated';
 update ticket_detail 
set cf_link_to_return_opportunity = subquery.id
from (
 Select ticketid,id

from public.dblink(
'host=35.236.243.204 port=5432 user=salesopreaduser password=b9c!l9M4#zQ dbname=org-538',

 format('Select 
--td_new.unique_external_reference_id
t.id as ticketid,
td_new.id
from (select * from ticket_detail where id in ( %s )) t

LEFT Join ticket_link tl_new on t.id = tl_new.source_ticket_id 
LEFt Join ticket_detail td_new on tl_new.destination_ticket_id = td_new.id where td_new.unique_external_reference_id != '''' and td_new.title  like ''RETURN%%''
 ',array_to_string(newids,',')))  as ticket(ticketid bigint,id bigint) ) subquery
where ticket_detail.id=subquery.ticketid;

update ticket_Detail set "last_activity_date" =sub."last_activity_date" 
from 
(
	Select ticket.id,ticket.last_activity_date  FROM dblink('host=35.236.243.204 port=5432 user=salesopreaduser password=b9c!l9M4#zQ dbname=org-538', 
 format('select ticket_id,max(created_on) from ticket_update where is_first_update=false and is_private=false and ticket_id in (%s)  group by ticket_id ',array_to_string(newids,','))) ticket(id bigint,last_activity_date timestamp)
) sub
where ticket_Detail.id=sub.id ;
insert into incremental_refresh_detail(recordcount,modified_on) values ('records updated' || reclen || ' ,Values'|| array_to_string(newids,','),CURRENT_TIMESTAMP);

 

  raise notice 'update notes Records';

 INSERT INTO public.related_opp_ticket_detail (parentid,"id","org_id","brand_id","org_brand_id","brand_name","Opportunity Name","is_visible_in_customer_portal","requested_by","requester","assigned_to_user_id","assignee","AR Rep","assigned_to_group_id","group","contact_group_id","contact_group","resolution_due_on","ticket_status_id","status","ticket_source_id","source","update_count","note_count","attachment_count","work_log_count","total_time_logged","total_billable_time_logged","first_response_due_on","next_response_due_on","last_replied_on","last_replied_by_id","last_replied_by","last_replied_by_user_type_id","last_replied_by_user_type","closed_on","closed_by","closed_by_name","created_on","created_by","creator","last_modified_on","last_modified_by","Last Modified By","is_spam","is_active","tsv","is_resolution_date_modified","last_status_changed_on","is_first_response_updated","ticket_type_option_id","ticket_category_option_id","ticket_priority_id","priority","Account Name","subject","type","category","email","OpportunityOwner","time_spent","unique_external_reference_id","agentid","notes","isnotesprivate","notetype","assigned","cf_amount","cf_opp_dt_order_id","cf_link_to_bold_order","cf_expected_payment_date","cf_group_car_rep","cf_secondary_lead_source","cf_contract_renewal_date","cf_contract_renewal_amount","cf_reinstate_reason","cf_last_crr_rep_contact","cf_country","cf_date_reviewed","cf_nonrenewal_reason","cf_cleared_by_jv","cf_order_sheet_status","cf_case_number","cf_downloaded_date","cf_key_order_issue","cf_term_12_months","cf_date_moved_to_not_renewing","cf_adobe_sign_exp_date","cf_next_cl_contact","cf__of_years_in_next_payment_term","cf__of_years_in_previous_payment_term","cf_ap_processed_alliance_fee","cf_days_to_pay_alliance_partner","cf_alliance_fee_tier","cf_alliance_partner_order_status","cf_biz_dev_reviewed","cf_csr_returned_for_correction","cf_dt_expiration_date","cf_original_license_type","cf_opp_alliance_partner","cf_return_details","cf_original_closedwon_date","cf_current_subscription_term","cf_last_customer_contact","cf_opportunity_name","cf_lead_source","cf_next_ar_contact","cf_opp_presale_contract_request","cf_end_date","cf_ren_audit_review","cf_counsel_reviewed","cf_flagged_by_mahas_team","cf_submitted_for_approval","cf_order_reviewed_by","cf_group_account_name","cf_payment_frequency","cf_submitted_to_counsel_review","cf_2nd_contact_date","cf_case_type","cf_return_notes","cf_engagement_status","cf_product","cf_review_link","cf_contract_license_ordered","cf_ar_license_ordered","cf_opp_has_problematic_pricing","cf_renewal_amount_this_year","cf_days_since_contact","cf_my_call_list_est","cf_order_sheet_name","cf_date_signed_by_syncfusion","cf_invoice_due_date","cf_return_identified_by","cf_contract_sent","cf_paralegal_contracts_to_returncancel","cf_total_contract_amount","cf_order_sheet_incomplete","cf_salescr_action_needed","cf_link_to_return_opportunity","cf_company","cf_opportunity_category","cf_product_or_plan","cf_revenue_type","cf_call_country","cf_last_renewal_order_id","cf_demo_scheduled","cf_reason_lost_comments","cf_opportunity_source","cf_download_country","cf_reason_lost","cf_alliance_partner_status","cf_customerid","cf_no_of_order_sheets_in_opp","cf_previous_dt_order_amount","cf_manager_at_time_of_sale","cf_department","cf_known_company_url","cf_secondary_ap_contact","cf_is_invoice_collectible","cf_problematic_pricing_acct","cf_tier_1_country_code","cf_renewal_status","cf_renewal_confirmation","cf_contract_reviewed","cf_reason_returned","cf_resolution","cf_po_obtained_legal","cf_contact_lead_source","cf_salescrr_issue_resolved","cf_primary_ap_contact","cf_visual_compliance_run_by","cf_crr_rep","cf_crr_corrections_required","cf_returnrebook","cf_payment_confirmation_attached","cf_tier_1_country_name","cf_1st_contact_date","cf_email","cf_submitted_for_processing","cf_rejected_to_rep","cf_returned_for_corrections","cf_order_sheet_processed","cf_record_type","cf_upgrade_dollar_amount","cf_total_sale_amount","cf_month_one_amount","cf_month_two_amount","cf_month_three_amount","cf_month_four_amount","cf_month_five_amount","cf_month_six_amount","cf_month_seven_amount","cf_month_eight_amount","cf_month_nine_amount","cf_month_ten_amount","cf_month_eleven_amount","cf_month_twelve_amount","cf_fee_to_alliance_partner","cf_contract_status","cf_3rd_contact_date","cf_payment_method","cf_bold_commissionable_amount","cf_customer_invoice_details","cf_stripe_order","cf_year_one_contract_amount","cf_case_resolution","cf_sales_admin_correction_requested","cf_date_agreement_effective","cf_date_agreement_expires","cf_date_sent_to_customer","cf_date_estimate_sent_to_customer","cf_date_signed_by_customer","cf_case_car_rep","cf_crr_split_amount","cf_follow_up_date","cf_outstanding_amount","cf_amount_collected_by_legal","cf_payment_outcome","cf_invoice_sent","cf_contract_complete_or_closed","cf_reason_for_no_contract","cf_payment_obtained_legal","cf_review_site","cf_order_info_needed","cf_collection_legal_status","cf_last_collections_contact","cf_total_invoice_amount","cf_salescr_action_type","cf_case_description","cf_date_sent_to_jv","cf_date_fully_executed","cf_90_days_support","cf_weekly_call_day","cf_last_ar_contact","cf_related_opp_account_name","cf_related_opp_close_date","cf_on_hold_details","cf_responsible_for_inv","cf_due_date","cf_status","cf_dt_order_id","cf_salescrr_invoice_issue","cf_days_suppport_remaining","cf_alliance_partner","cf_manager","cf_visual_compliance_run","cf_syncfusion_sales_rep","cf_absolute_revenue","cf_car_rep","cf_next_contact_date","cf_opportunity_amount","cf_task_subtype","cf_day_log","cf_time_activity_logged","cf_call_type","cf_call_result","cf_license_ordered","cf_presale_contract_request","cf_assigned_to","cf_ar_status","cf_date_sent_to_legal","cf_order_entered","cf_verified_return_in_dt","cf_confirmed_order_csr","cf_date_order_closed_paidret","cf_discount","cf_email_subject","cf_salescrr_issue_type","cf_sales_rep_split_amount","cf_cg_billing_postal_code","cf_cg_known_company_url","cf_problematic_pricing_opps","cf_cg_billing_street","cf_cg_billing_city","cf_contact_license_type","cf_group_billing_country","cf_order_entered_by","cf_reason_for_owner_change","cf_acct_has_problematic_pricing","cf_opp_acct_has_problematic_pricing","cf_channel","cf_csr_confirmed_alliance_order","cf_submitted_for_bd_review","contactname","Invoice Age","stage","Amount After Discount","Days To Expiration","Days To Payment","Days To Payment 2","Days To Invoice Payment","Days not renewing to closed","Sales Admin Review Days","Close Date to Processed","Days to Process","Close to Final CRRB Checks","Close vs. Exp date","Days Since Close Date","Days Open","Absolute Close Won Date","Upgrade Amount","When was Alliance Partner Paid","Opportunity Age","Bold Team","Collections or AR?","Call time","Follow Up Type","Contract Result","Eligible for Contract","Contract","CRRB Processing Time","Days To Final CRRB Check","Days to Process(str)","Invoice Age(Str)","Close to payment","Eligible Date to Close","DT Order Link","Tier 1 Region","Adjusted Projected REN","Percent Invoice Paid","Days to Submit Order","Days to Submit Order_bucket","Annualized Revenue","Closed By Expiration","Link to Next REN Opportunity","Link to Old REN Opportunity","cf_ren_contract_notes","cf_collections_legal_notes","cf_ar_notes","cf_contract_retrieval_notes","cf_comments","cf_order_evaluation_notes","cf_counsel_order_notes","cf_notes_from_sales_leadership","cf_notes_to_ar_manager","cf_po_notes_legal","cf_collections_correspondence","cf_admin_internal_notes","cf_paralegal_notes","cf_rep_notes","Opportunity Owner Designation","Opportunity Owner Role","Opportunity Owner Department","Opportunity Owner Workstation","Opportunity Owner Division","Opportunity Owner : Active","Opportunity Owner : Manager","isreportingpersonasmaanager","Opportunity Owner : Reporting Person","User End Date","Opportunity Owner IsActive","Car_Rep_Contact"
											   ,"sales/cr-notes-with-legal",
	"Counsel-Notes",
	"Closed-Lost-Qualification-Notes" ,
	"SE-Notes",
	"CR-Notes",
	"Sales-Leadership-Notes",
	"About-This-Opportunity",
	"contract-notes",
	"project-notes",
	"case-comments",	
	"project-name-cst")
SELECT * from public.get_related_oppticket_detail(
	array_to_string(newids,',')
)
ON CONFLICT ("parentid","id") 
DO 
   UPDATE SET "id"=EXCLUDED."id","org_id"=EXCLUDED."org_id","brand_id"=EXCLUDED."brand_id","org_brand_id"=EXCLUDED."org_brand_id","brand_name"=EXCLUDED."brand_name","Opportunity Name"=EXCLUDED."Opportunity Name","is_visible_in_customer_portal"=EXCLUDED."is_visible_in_customer_portal","requested_by"=EXCLUDED."requested_by","requester"=EXCLUDED."requester","assigned_to_user_id"=EXCLUDED."assigned_to_user_id","assignee"=EXCLUDED."assignee","AR Rep"=EXCLUDED."AR Rep","assigned_to_group_id"=EXCLUDED."assigned_to_group_id","group"=EXCLUDED."group","contact_group_id"=EXCLUDED."contact_group_id","contact_group"=EXCLUDED."contact_group","resolution_due_on"=EXCLUDED."resolution_due_on","ticket_status_id"=EXCLUDED."ticket_status_id","status"=EXCLUDED."status","ticket_source_id"=EXCLUDED."ticket_source_id","source"=EXCLUDED."source","update_count"=EXCLUDED."update_count","note_count"=EXCLUDED."note_count","attachment_count"=EXCLUDED."attachment_count","work_log_count"=EXCLUDED."work_log_count","total_time_logged"=EXCLUDED."total_time_logged","total_billable_time_logged"=EXCLUDED."total_billable_time_logged","first_response_due_on"=EXCLUDED."first_response_due_on","next_response_due_on"=EXCLUDED."next_response_due_on","last_replied_on"=EXCLUDED."last_replied_on","last_replied_by_id"=EXCLUDED."last_replied_by_id","last_replied_by"=EXCLUDED."last_replied_by","last_replied_by_user_type_id"=EXCLUDED."last_replied_by_user_type_id","last_replied_by_user_type"=EXCLUDED."last_replied_by_user_type","closed_on"=EXCLUDED."closed_on","closed_by"=EXCLUDED."closed_by","closed_by_name"=EXCLUDED."closed_by_name","created_on"=EXCLUDED."created_on","created_by"=EXCLUDED."created_by","creator"=EXCLUDED."creator","last_modified_on"=EXCLUDED."last_modified_on","last_modified_by"=EXCLUDED."last_modified_by","Last Modified By"=EXCLUDED."Last Modified By","is_spam"=EXCLUDED."is_spam","is_active"=EXCLUDED."is_active","tsv"=EXCLUDED."tsv","is_resolution_date_modified"=EXCLUDED."is_resolution_date_modified","last_status_changed_on"=EXCLUDED."last_status_changed_on","is_first_response_updated"=EXCLUDED."is_first_response_updated","ticket_type_option_id"=EXCLUDED."ticket_type_option_id","ticket_category_option_id"=EXCLUDED."ticket_category_option_id","ticket_priority_id"=EXCLUDED."ticket_priority_id","priority"=EXCLUDED."priority","Account Name"=EXCLUDED."Account Name","subject"=EXCLUDED."subject","type"=EXCLUDED."type","category"=EXCLUDED."category","email"=EXCLUDED."email","OpportunityOwner"=EXCLUDED."OpportunityOwner","time_spent"=EXCLUDED."time_spent","unique_external_reference_id"=EXCLUDED."unique_external_reference_id","agentid"=EXCLUDED."agentid","notes"=EXCLUDED."notes","isnotesprivate"=EXCLUDED."isnotesprivate","notetype"=EXCLUDED."notetype","assigned"=EXCLUDED."assigned","cf_amount"=EXCLUDED."cf_amount","cf_opp_dt_order_id"=EXCLUDED."cf_opp_dt_order_id","cf_link_to_bold_order"=EXCLUDED."cf_link_to_bold_order","cf_expected_payment_date"=EXCLUDED."cf_expected_payment_date","cf_group_car_rep"=EXCLUDED."cf_group_car_rep","cf_secondary_lead_source"=EXCLUDED."cf_secondary_lead_source","cf_contract_renewal_date"=EXCLUDED."cf_contract_renewal_date","cf_contract_renewal_amount"=EXCLUDED."cf_contract_renewal_amount","cf_reinstate_reason"=EXCLUDED."cf_reinstate_reason","cf_last_crr_rep_contact"=EXCLUDED."cf_last_crr_rep_contact","cf_country"=EXCLUDED."cf_country","cf_date_reviewed"=EXCLUDED."cf_date_reviewed","cf_nonrenewal_reason"=EXCLUDED."cf_nonrenewal_reason","cf_cleared_by_jv"=EXCLUDED."cf_cleared_by_jv","cf_order_sheet_status"=EXCLUDED."cf_order_sheet_status","cf_case_number"=EXCLUDED."cf_case_number","cf_downloaded_date"=EXCLUDED."cf_downloaded_date","cf_key_order_issue"=EXCLUDED."cf_key_order_issue","cf_term_12_months"=EXCLUDED."cf_term_12_months","cf_date_moved_to_not_renewing"=EXCLUDED."cf_date_moved_to_not_renewing","cf_adobe_sign_exp_date"=EXCLUDED."cf_adobe_sign_exp_date","cf_next_cl_contact"=EXCLUDED."cf_next_cl_contact","cf__of_years_in_next_payment_term"=EXCLUDED."cf__of_years_in_next_payment_term","cf__of_years_in_previous_payment_term"=EXCLUDED."cf__of_years_in_previous_payment_term","cf_ap_processed_alliance_fee"=EXCLUDED."cf_ap_processed_alliance_fee","cf_days_to_pay_alliance_partner"=EXCLUDED."cf_days_to_pay_alliance_partner","cf_alliance_fee_tier"=EXCLUDED."cf_alliance_fee_tier","cf_alliance_partner_order_status"=EXCLUDED."cf_alliance_partner_order_status","cf_biz_dev_reviewed"=EXCLUDED."cf_biz_dev_reviewed","cf_csr_returned_for_correction"=EXCLUDED."cf_csr_returned_for_correction","cf_dt_expiration_date"=EXCLUDED."cf_dt_expiration_date","cf_original_license_type"=EXCLUDED."cf_original_license_type","cf_opp_alliance_partner"=EXCLUDED."cf_opp_alliance_partner","cf_return_details"=EXCLUDED."cf_return_details","cf_original_closedwon_date"=EXCLUDED."cf_original_closedwon_date","cf_current_subscription_term"=EXCLUDED."cf_current_subscription_term","cf_last_customer_contact"=EXCLUDED."cf_last_customer_contact","cf_opportunity_name"=EXCLUDED."cf_opportunity_name","cf_lead_source"=EXCLUDED."cf_lead_source","cf_next_ar_contact"=EXCLUDED."cf_next_ar_contact","cf_opp_presale_contract_request"=EXCLUDED."cf_opp_presale_contract_request","cf_end_date"=EXCLUDED."cf_end_date","cf_ren_audit_review"=EXCLUDED."cf_ren_audit_review","cf_counsel_reviewed"=EXCLUDED."cf_counsel_reviewed","cf_flagged_by_mahas_team"=EXCLUDED."cf_flagged_by_mahas_team","cf_submitted_for_approval"=EXCLUDED."cf_submitted_for_approval","cf_order_reviewed_by"=EXCLUDED."cf_order_reviewed_by","cf_group_account_name"=EXCLUDED."cf_group_account_name","cf_payment_frequency"=EXCLUDED."cf_payment_frequency","cf_submitted_to_counsel_review"=EXCLUDED."cf_submitted_to_counsel_review","cf_2nd_contact_date"=EXCLUDED."cf_2nd_contact_date","cf_case_type"=EXCLUDED."cf_case_type","cf_return_notes"=EXCLUDED."cf_return_notes","cf_engagement_status"=EXCLUDED."cf_engagement_status","cf_product"=EXCLUDED."cf_product","cf_review_link"=EXCLUDED."cf_review_link","cf_contract_license_ordered"=EXCLUDED."cf_contract_license_ordered","cf_ar_license_ordered"=EXCLUDED."cf_ar_license_ordered","cf_opp_has_problematic_pricing"=EXCLUDED."cf_opp_has_problematic_pricing","cf_renewal_amount_this_year"=EXCLUDED."cf_renewal_amount_this_year","cf_days_since_contact"=EXCLUDED."cf_days_since_contact","cf_my_call_list_est"=EXCLUDED."cf_my_call_list_est","cf_order_sheet_name"=EXCLUDED."cf_order_sheet_name","cf_date_signed_by_syncfusion"=EXCLUDED."cf_date_signed_by_syncfusion","cf_invoice_due_date"=EXCLUDED."cf_invoice_due_date","cf_return_identified_by"=EXCLUDED."cf_return_identified_by","cf_contract_sent"=EXCLUDED."cf_contract_sent","cf_paralegal_contracts_to_returncancel"=EXCLUDED."cf_paralegal_contracts_to_returncancel","cf_total_contract_amount"=EXCLUDED."cf_total_contract_amount","cf_order_sheet_incomplete"=EXCLUDED."cf_order_sheet_incomplete","cf_salescr_action_needed"=EXCLUDED."cf_salescr_action_needed","cf_link_to_return_opportunity"=EXCLUDED."cf_link_to_return_opportunity","cf_company"=EXCLUDED."cf_company","cf_opportunity_category"=EXCLUDED."cf_opportunity_category","cf_product_or_plan"=EXCLUDED."cf_product_or_plan","cf_revenue_type"=EXCLUDED."cf_revenue_type","cf_call_country"=EXCLUDED."cf_call_country","cf_last_renewal_order_id"=EXCLUDED."cf_last_renewal_order_id","cf_demo_scheduled"=EXCLUDED."cf_demo_scheduled","cf_reason_lost_comments"=EXCLUDED."cf_reason_lost_comments","cf_opportunity_source"=EXCLUDED."cf_opportunity_source","cf_download_country"=EXCLUDED."cf_download_country","cf_reason_lost"=EXCLUDED."cf_reason_lost","cf_alliance_partner_status"=EXCLUDED."cf_alliance_partner_status","cf_customerid"=EXCLUDED."cf_customerid","cf_no_of_order_sheets_in_opp"=EXCLUDED."cf_no_of_order_sheets_in_opp","cf_previous_dt_order_amount"=EXCLUDED."cf_previous_dt_order_amount","cf_manager_at_time_of_sale"=EXCLUDED."cf_manager_at_time_of_sale","cf_department"=EXCLUDED."cf_department","cf_known_company_url"=EXCLUDED."cf_known_company_url","cf_secondary_ap_contact"=EXCLUDED."cf_secondary_ap_contact","cf_is_invoice_collectible"=EXCLUDED."cf_is_invoice_collectible","cf_problematic_pricing_acct"=EXCLUDED."cf_problematic_pricing_acct","cf_tier_1_country_code"=EXCLUDED."cf_tier_1_country_code","cf_renewal_status"=EXCLUDED."cf_renewal_status","cf_renewal_confirmation"=EXCLUDED."cf_renewal_confirmation","cf_contract_reviewed"=EXCLUDED."cf_contract_reviewed","cf_reason_returned"=EXCLUDED."cf_reason_returned","cf_resolution"=EXCLUDED."cf_resolution","cf_po_obtained_legal"=EXCLUDED."cf_po_obtained_legal","cf_contact_lead_source"=EXCLUDED."cf_contact_lead_source","cf_salescrr_issue_resolved"=EXCLUDED."cf_salescrr_issue_resolved","cf_primary_ap_contact"=EXCLUDED."cf_primary_ap_contact","cf_visual_compliance_run_by"=EXCLUDED."cf_visual_compliance_run_by","cf_crr_rep"=EXCLUDED."cf_crr_rep","cf_crr_corrections_required"=EXCLUDED."cf_crr_corrections_required","cf_returnrebook"=EXCLUDED."cf_returnrebook","cf_payment_confirmation_attached"=EXCLUDED."cf_payment_confirmation_attached","cf_tier_1_country_name"=EXCLUDED."cf_tier_1_country_name","cf_1st_contact_date"=EXCLUDED."cf_1st_contact_date","cf_email"=EXCLUDED."cf_email","cf_submitted_for_processing"=EXCLUDED."cf_submitted_for_processing","cf_rejected_to_rep"=EXCLUDED."cf_rejected_to_rep","cf_returned_for_corrections"=EXCLUDED."cf_returned_for_corrections","cf_order_sheet_processed"=EXCLUDED."cf_order_sheet_processed","cf_record_type"=EXCLUDED."cf_record_type","cf_upgrade_dollar_amount"=EXCLUDED."cf_upgrade_dollar_amount","cf_total_sale_amount"=EXCLUDED."cf_total_sale_amount","cf_month_one_amount"=EXCLUDED."cf_month_one_amount","cf_month_two_amount"=EXCLUDED."cf_month_two_amount","cf_month_three_amount"=EXCLUDED."cf_month_three_amount","cf_month_four_amount"=EXCLUDED."cf_month_four_amount","cf_month_five_amount"=EXCLUDED."cf_month_five_amount","cf_month_six_amount"=EXCLUDED."cf_month_six_amount","cf_month_seven_amount"=EXCLUDED."cf_month_seven_amount","cf_month_eight_amount"=EXCLUDED."cf_month_eight_amount","cf_month_nine_amount"=EXCLUDED."cf_month_nine_amount","cf_month_ten_amount"=EXCLUDED."cf_month_ten_amount","cf_month_eleven_amount"=EXCLUDED."cf_month_eleven_amount","cf_month_twelve_amount"=EXCLUDED."cf_month_twelve_amount","cf_fee_to_alliance_partner"=EXCLUDED."cf_fee_to_alliance_partner","cf_contract_status"=EXCLUDED."cf_contract_status","cf_3rd_contact_date"=EXCLUDED."cf_3rd_contact_date","cf_payment_method"=EXCLUDED."cf_payment_method","cf_bold_commissionable_amount"=EXCLUDED."cf_bold_commissionable_amount","cf_customer_invoice_details"=EXCLUDED."cf_customer_invoice_details","cf_stripe_order"=EXCLUDED."cf_stripe_order","cf_year_one_contract_amount"=EXCLUDED."cf_year_one_contract_amount","cf_case_resolution"=EXCLUDED."cf_case_resolution","cf_sales_admin_correction_requested"=EXCLUDED."cf_sales_admin_correction_requested","cf_date_agreement_effective"=EXCLUDED."cf_date_agreement_effective","cf_date_agreement_expires"=EXCLUDED."cf_date_agreement_expires","cf_date_sent_to_customer"=EXCLUDED."cf_date_sent_to_customer","cf_date_estimate_sent_to_customer"=EXCLUDED."cf_date_estimate_sent_to_customer","cf_date_signed_by_customer"=EXCLUDED."cf_date_signed_by_customer","cf_case_car_rep"=EXCLUDED."cf_case_car_rep","cf_crr_split_amount"=EXCLUDED."cf_crr_split_amount","cf_follow_up_date"=EXCLUDED."cf_follow_up_date","cf_outstanding_amount"=EXCLUDED."cf_outstanding_amount","cf_amount_collected_by_legal"=EXCLUDED."cf_amount_collected_by_legal","cf_payment_outcome"=EXCLUDED."cf_payment_outcome","cf_invoice_sent"=EXCLUDED."cf_invoice_sent","cf_contract_complete_or_closed"=EXCLUDED."cf_contract_complete_or_closed","cf_reason_for_no_contract"=EXCLUDED."cf_reason_for_no_contract","cf_payment_obtained_legal"=EXCLUDED."cf_payment_obtained_legal","cf_review_site"=EXCLUDED."cf_review_site","cf_order_info_needed"=EXCLUDED."cf_order_info_needed","cf_collection_legal_status"=EXCLUDED."cf_collection_legal_status","cf_last_collections_contact"=EXCLUDED."cf_last_collections_contact","cf_total_invoice_amount"=EXCLUDED."cf_total_invoice_amount","cf_salescr_action_type"=EXCLUDED."cf_salescr_action_type","cf_case_description"=EXCLUDED."cf_case_description","cf_date_sent_to_jv"=EXCLUDED."cf_date_sent_to_jv","cf_date_fully_executed"=EXCLUDED."cf_date_fully_executed","cf_90_days_support"=EXCLUDED."cf_90_days_support","cf_weekly_call_day"=EXCLUDED."cf_weekly_call_day","cf_last_ar_contact"=EXCLUDED."cf_last_ar_contact","cf_related_opp_account_name"=EXCLUDED."cf_related_opp_account_name","cf_related_opp_close_date"=EXCLUDED."cf_related_opp_close_date","cf_on_hold_details"=EXCLUDED."cf_on_hold_details","cf_responsible_for_inv"=EXCLUDED."cf_responsible_for_inv","cf_due_date"=EXCLUDED."cf_due_date","cf_status"=EXCLUDED."cf_status","cf_dt_order_id"=EXCLUDED."cf_dt_order_id","cf_salescrr_invoice_issue"=EXCLUDED."cf_salescrr_invoice_issue","cf_days_suppport_remaining"=EXCLUDED."cf_days_suppport_remaining","cf_alliance_partner"=EXCLUDED."cf_alliance_partner","cf_manager"=EXCLUDED."cf_manager","cf_visual_compliance_run"=EXCLUDED."cf_visual_compliance_run","cf_syncfusion_sales_rep"=EXCLUDED."cf_syncfusion_sales_rep","cf_absolute_revenue"=EXCLUDED."cf_absolute_revenue","cf_car_rep"=EXCLUDED."cf_car_rep","cf_next_contact_date"=EXCLUDED."cf_next_contact_date","cf_opportunity_amount"=EXCLUDED."cf_opportunity_amount","cf_task_subtype"=EXCLUDED."cf_task_subtype","cf_day_log"=EXCLUDED."cf_day_log","cf_time_activity_logged"=EXCLUDED."cf_time_activity_logged","cf_call_type"=EXCLUDED."cf_call_type","cf_call_result"=EXCLUDED."cf_call_result","cf_license_ordered"=EXCLUDED."cf_license_ordered","cf_presale_contract_request"=EXCLUDED."cf_presale_contract_request","cf_assigned_to"=EXCLUDED."cf_assigned_to","cf_ar_status"=EXCLUDED."cf_ar_status","cf_date_sent_to_legal"=EXCLUDED."cf_date_sent_to_legal","cf_order_entered"=EXCLUDED."cf_order_entered","cf_verified_return_in_dt"=EXCLUDED."cf_verified_return_in_dt","cf_confirmed_order_csr"=EXCLUDED."cf_confirmed_order_csr","cf_date_order_closed_paidret"=EXCLUDED."cf_date_order_closed_paidret","cf_discount"=EXCLUDED."cf_discount","cf_email_subject"=EXCLUDED."cf_email_subject","cf_salescrr_issue_type"=EXCLUDED."cf_salescrr_issue_type","cf_sales_rep_split_amount"=EXCLUDED."cf_sales_rep_split_amount","cf_cg_billing_postal_code"=EXCLUDED."cf_cg_billing_postal_code","cf_cg_known_company_url"=EXCLUDED."cf_cg_known_company_url","cf_problematic_pricing_opps"=EXCLUDED."cf_problematic_pricing_opps","cf_cg_billing_street"=EXCLUDED."cf_cg_billing_street","cf_cg_billing_city"=EXCLUDED."cf_cg_billing_city","cf_contact_license_type"=EXCLUDED."cf_contact_license_type","cf_group_billing_country"=EXCLUDED."cf_group_billing_country","cf_order_entered_by"=EXCLUDED."cf_order_entered_by","cf_reason_for_owner_change"=EXCLUDED."cf_reason_for_owner_change","cf_acct_has_problematic_pricing"=EXCLUDED."cf_acct_has_problematic_pricing","cf_opp_acct_has_problematic_pricing"=EXCLUDED."cf_opp_acct_has_problematic_pricing","cf_channel"=EXCLUDED."cf_channel","cf_csr_confirmed_alliance_order"=EXCLUDED."cf_csr_confirmed_alliance_order","cf_submitted_for_bd_review"=EXCLUDED."cf_submitted_for_bd_review","contactname"=EXCLUDED."contactname","Invoice Age"=EXCLUDED."Invoice Age","stage"=EXCLUDED."stage","Amount After Discount"=EXCLUDED."Amount After Discount","Days To Expiration"=EXCLUDED."Days To Expiration","Days To Payment"=EXCLUDED."Days To Payment","Days To Payment 2"=EXCLUDED."Days To Payment 2","Days To Invoice Payment"=EXCLUDED."Days To Invoice Payment","Days not renewing to closed"=EXCLUDED."Days not renewing to closed","Sales Admin Review Days"=EXCLUDED."Sales Admin Review Days","Close Date to Processed"=EXCLUDED."Close Date to Processed","Days to Process"=EXCLUDED."Days to Process","Close to Final CRRB Checks"=EXCLUDED."Close to Final CRRB Checks","Close vs. Exp date"=EXCLUDED."Close vs. Exp date","Days Since Close Date"=EXCLUDED."Days Since Close Date","Days Open"=EXCLUDED."Days Open","Absolute Close Won Date"=EXCLUDED."Absolute Close Won Date","Upgrade Amount"=EXCLUDED."Upgrade Amount","When was Alliance Partner Paid"=EXCLUDED."When was Alliance Partner Paid","Opportunity Age"=EXCLUDED."Opportunity Age","Bold Team"=EXCLUDED."Bold Team","Collections or AR?"=EXCLUDED."Collections or AR?","Call time"=EXCLUDED."Call time","Follow Up Type"=EXCLUDED."Follow Up Type","Contract Result"=EXCLUDED."Contract Result","Eligible for Contract"=EXCLUDED."Eligible for Contract","Contract"=EXCLUDED."Contract","CRRB Processing Time"=EXCLUDED."CRRB Processing Time","Days To Final CRRB Check"=EXCLUDED."Days To Final CRRB Check","Days to Process(str)"=EXCLUDED."Days to Process(str)","Invoice Age(Str)"=EXCLUDED."Invoice Age(Str)","Close to payment"=EXCLUDED."Close to payment","Eligible Date to Close"=EXCLUDED."Eligible Date to Close","DT Order Link"=EXCLUDED."DT Order Link","Tier 1 Region"=EXCLUDED."Tier 1 Region","Adjusted Projected REN"=EXCLUDED."Adjusted Projected REN","Percent Invoice Paid"=EXCLUDED."Percent Invoice Paid","Days to Submit Order"=EXCLUDED."Days to Submit Order","Days to Submit Order_bucket"=EXCLUDED."Days to Submit Order_bucket","Annualized Revenue"=EXCLUDED."Annualized Revenue","Closed By Expiration"=EXCLUDED."Closed By Expiration","Link to Next REN Opportunity"=EXCLUDED."Link to Next REN Opportunity","Link to Old REN Opportunity"=EXCLUDED."Link to Old REN Opportunity","cf_ren_contract_notes"=EXCLUDED."cf_ren_contract_notes","cf_collections_legal_notes"=EXCLUDED."cf_collections_legal_notes","cf_ar_notes"=EXCLUDED."cf_ar_notes","cf_contract_retrieval_notes"=EXCLUDED."cf_contract_retrieval_notes","cf_comments"=EXCLUDED."cf_comments","cf_order_evaluation_notes"=EXCLUDED."cf_order_evaluation_notes","cf_counsel_order_notes"=EXCLUDED."cf_counsel_order_notes","cf_notes_from_sales_leadership"=EXCLUDED."cf_notes_from_sales_leadership","cf_notes_to_ar_manager"=EXCLUDED."cf_notes_to_ar_manager","cf_po_notes_legal"=EXCLUDED."cf_po_notes_legal","cf_collections_correspondence"=EXCLUDED."cf_collections_correspondence","cf_admin_internal_notes"=EXCLUDED."cf_admin_internal_notes","cf_paralegal_notes"=EXCLUDED."cf_paralegal_notes","cf_rep_notes"=EXCLUDED."cf_rep_notes","Opportunity Owner Designation"=EXCLUDED."Opportunity Owner Designation","Opportunity Owner Role"=EXCLUDED."Opportunity Owner Role","Opportunity Owner Department"=EXCLUDED."Opportunity Owner Department","Opportunity Owner Workstation"=EXCLUDED."Opportunity Owner Workstation","Opportunity Owner Division"=EXCLUDED."Opportunity Owner Division","Opportunity Owner : Active"=EXCLUDED."Opportunity Owner : Active","Opportunity Owner : Manager"=EXCLUDED."Opportunity Owner : Manager","isreportingpersonasmaanager"=EXCLUDED."isreportingpersonasmaanager","Opportunity Owner : Reporting Person"=EXCLUDED."Opportunity Owner : Reporting Person","User End Date"=EXCLUDED."User End Date","Opportunity Owner IsActive"=EXCLUDED."Opportunity Owner IsActive","Car_Rep_Contact"=EXCLUDED."Car_Rep_Contact",
   "sales/cr-notes-with-legal" = EXCLUDED."sales/cr-notes-with-legal",
	"Counsel-Notes"= EXCLUDED."Counsel-Notes",
	"Closed-Lost-Qualification-Notes" = EXCLUDED."Closed-Lost-Qualification-Notes",
	"SE-Notes"=EXCLUDED."SE-Notes",
	"CR-Notes"=EXCLUDED."CR-Notes",
	"Sales-Leadership-Notes"=EXCLUDED."Sales-Leadership-Notes",
	"About-This-Opportunity"=EXCLUDED."About-This-Opportunity",
	"contract-notes"=EXCLUDED."contract-notes",
	"project-notes"=EXCLUDED."project-notes",
	"case-comments"=EXCLUDED."case-comments",	
	"project-name-cst"=EXCLUDED."project-name-cst";
	 raise notice 'related Opp Ticket detail update  Completed time %', transaction_timestamp();

 update ticket_Detail
  set "Opportunity Owner : Manager" = subquery."OpportunityOwnerManager"
  from(
  SELECT ( SELECT (rdu_salesusers.firstname::varchar || ' '::varchar) || rdu_salesusers.lastname::varchar
           FROM rdu_salesusers
          WHERE rdu_salesusers.id = rdu_salesuser_transition_history.userid
         LIMIT 1)::varchar as "User" ,
		 
		 ( SELECT (rdu_salesusers.firstname::varchar || ' '::varchar) || rdu_salesusers.lastname::varchar
           FROM rdu_salesusers
          WHERE rdu_salesusers.id = rdu_salesuser_transition_history.newuserid
         LIMIT 1)::varchar as "OpportunityOwnerManager" ,
		( SELECT (rdu_salesusers.emailaddress) 
           FROM rdu_salesusers
          WHERE rdu_salesusers.id = rdu_salesuser_transition_history.userid
         LIMIT 1)::varchar as "UserEmail",
		 rdu_salesuser_transition_history.startdate,
		 (case when (enddate is null ) then now()::date + interval '100 years' else enddate::date end) as enddate
		 FROM rdu_salesuser_transition_history 
where 
--userid in (select rdu_salesusers.id FROM rdu_salesusers where
--		(rdu_salesusers.firstname || ' ' || rdu_salesusers.lastname) in ('Vallary Atieno Ouma'))
--and startdate::date <= '2022-07-01'  and '2022-08-01' <= (case when (enddate is null ) then now()::date + interval '100 years' else enddate::date end)
--and 
transitiontypeid = 1) subquery

where ticket_detail.id = Any(newids) and  ticket_detail.email=subquery."UserEmail" and subquery.startdate <= ( case when ticket_detail.status = 'Closed' then ticket_detail.closed_on else ticket_detail.resolution_due_on   end)::date and ( case when ticket_detail.status = 'Closed' then ticket_detail.closed_on else ticket_detail.resolution_due_on   end)::date <= subquery.enddate	 ;
   insert into history_ticket_detail (id,ticket_id ,
updatetype,
	"Edit Date" ,
"Edited By" ,
	is_active ,
	"Description" ,
    "FieldName" ,
    "NewString" ,
"OldString" ,
    "FieldApiName"  )
	select id,ticket_id ,
case when "Description" is null then "FieldName" else 'Description' end as updatetype,
	"Edit Date" ,
"Edited By" ,
	is_active ,
	"Description" ,
    "FieldName" ,
    "NewString" ,
"OldString" ,
    "FieldApiName"  
from public.dblink(
'host=35.236.243.204 port=5432 user=salesopreaduser password=b9c!l9M4#zQ dbname=org-538',

format(
'SELECT t.id,
t.ticket_id, 

t.last_modified_on as "Edit Date", 
requester.name "Edited By",
t.is_active,
fields."Description"
,fields."FieldName"
,fields."NewString" as "New Value"
,fields."OldString" as "Old Value"
,fields."FieldApiName"
	FROM (select * from public.ticket_change_log where ticket_id in (%s) ) t
	 LEFT JOIN users requester ON requester.id = t.last_modified_by
	 , jsonb_array_elements(t.change_logs) AS f(doc)
	,jsonb_to_record(f.doc) fields("Description" varchar,
    "FieldName" varchar,
    "NewString" varchar,
"OldString" varchar,
    "FieldApiName" varchar)
',array_to_string(newids,','))
) as ticket_detail(id bigint,
ticket_id bigint,
	"Edit Date" timestamp with time zone,
"Edited By" varchar,
	is_active boolean,
	"Description" varchar,
    "FieldName" varchar,
    "NewString" varchar,
"OldString" varchar,
    "FieldApiName" varchar
)
ON CONFLICT ("id",ticket_id,updatetype) 
DO 
   UPDATE SET id = EXCLUDED.id,ticket_id = EXCLUDED.ticket_id ,
updatetype = EXCLUDED.updatetype,
	"Edit Date" = EXCLUDED."Edit Date" ,
"Edited By" = EXCLUDED."Edited By" ,
	is_active  = EXCLUDED.is_active,
	"Description" = EXCLUDED."Description" ,
    "FieldName" = EXCLUDED."FieldName" ,
    "NewString" = EXCLUDED."NewString" ,
"OldString" = EXCLUDED."OldString" ,
    "FieldApiName" = EXCLUDED."FieldApiName";
	
	update ticket_Detail 
set "Current Opportunity Owner Manager" =subquery."Current Opportunity Owner Manager",
manageremail = subquery.manageremail
from (
select users.emailaddress,( SELECT (rdu_salesusers.firstname::text || ' '::text) || rdu_salesusers.lastname::text
           FROM rdu_salesusers
          WHERE rdu_salesusers.id = sr.immediatemanagerid
         LIMIT 1) as "Current Opportunity Owner Manager",
	
	( SELECT rdu_salesusers.emailaddress
           FROM rdu_salesusers
          WHERE rdu_salesusers.id = sr.immediatemanagerid
         LIMIT 1) as manageremail
	from rdu_salesusers users  LEFT JOIN rdu_salesuser_relationship sr ON users.id = sr.userid and sr.isactive =true
)subquery

where ticket_detail.email=subquery.emailaddress and ticket_Detail.id = Any(newids);
insert into child_task_ticket_Detail (
parentid,id,
  cf_assigned_to,
cf_task_status,
cf_due_date,
cf_completed_datetime,
cf_related_to,
cf_task_record_type,
cf_task_subtype,
cf_task_type,
cf_reminder_set,
cf_day_log,
cf_time_activity_logged,
cf_call_type,
cf_call_result,
cf_comments,
priority,
Subject,
cf_task_name,
cf_external_reference_id)

select * from get_related_task_ticket_detail(array_to_string(newids,','))
ON CONFLICT ("parentid","id") 
DO 
   UPDATE SET parentid=EXCLUDED.parentid,
   id=EXCLUDED.id,
  cf_assigned_to=EXCLUDED.cf_assigned_to,
cf_task_status=EXCLUDED.cf_task_status,
cf_due_date=EXCLUDED.cf_due_date,
cf_completed_datetime=EXCLUDED.cf_completed_datetime,
cf_related_to=EXCLUDED.cf_related_to,
cf_task_record_type=EXCLUDED.cf_task_record_type,
cf_task_subtype=EXCLUDED.cf_task_subtype,
cf_task_type=EXCLUDED.cf_task_type,
cf_reminder_set=EXCLUDED.cf_reminder_set,
cf_day_log=EXCLUDED.cf_day_log,
cf_time_activity_logged=EXCLUDED.cf_time_activity_logged,
cf_call_type=EXCLUDED.cf_call_type,
cf_call_result=EXCLUDED.cf_call_result,
cf_comments=EXCLUDED.cf_comments,
priority=EXCLUDED.priority,
Subject=EXCLUDED.Subject,
cf_task_name=EXCLUDED.cf_task_name,
cf_external_reference_id=EXCLUDED.cf_external_reference_id;
  RAISE INFO 'history table Records updated  : % ', reclen;
update ticket_Detail set "Current Opportunity Owner Manager" =null 
where email in ('danielj@syncfusion.com');

update ticket_Detail set "Current Opportunity Owner Manager" ='Batrice Ramsey'
where email in ('natashalizz@syncfusion.com');

update ticket_Detail set "Current Opportunity Owner Manager" ='Ryan Madison'
where email='faithongoche@syncfusion.com';

update ticket_Detail set "Current Opportunity Owner Manager" ='Ryan Madison'
where email in ('terrydama@syncfusion.com@syncfusion.com');

update ticket_Detail set "Current Opportunity Owner Manager" ='Ryan Madison'
where email in ('sherylakinyio@syncfusion.com');
update ticket_Detail set "Current Opportunity Owner Manager" ='Ryan Madison'
where email in ('jacintahmideri@syncfusion.com');

update ticket_Detail set "Current Opportunity Owner Manager" ='Sandy Lill'
where email='daniellem@syncfusion.com';
update ticket_Detail set cf_manager_at_time_of_sale = sub.cf_manager_at_time_of_sale
from (
	select * FROM dblink('host=35.236.243.204 port=5432 user=salesopreaduser password=b9c!l9M4#zQ dbname=org-538'::text, 
		format('select t.id,mats.name as cf_manager_at_time_of_sale  FROM (select * from ticket_detail where  id in (%s) and is_active=true ) t,
						  jsonb_to_record(t.custom_fields) fields("1332" varchar)
LEFT Join users mats on mats.email=fields."1332"
						 '	,array_to_string(newids,','))   ) ticket_detail(id bigint,cf_manager_at_time_of_sale varchar)
)sub
where ticket_Detail.id = sub.id;

insert into child_beta_quote_ticket_Detail ("parentid","id","org_id","brand_id","org_brand_id","brand_name","Opportunity Name","is_visible_in_customer_portal","requested_by","requester","assigned_to_user_id","assignee","AR Rep","assigned_to_group_id","group","contact_group_id","contact_group","resolution_due_on","ticket_status_id","status","ticket_source_id","source","update_count","note_count","attachment_count","work_log_count","total_time_logged","total_billable_time_logged","first_response_due_on","next_response_due_on","last_replied_on","last_replied_by_id","last_replied_by","last_replied_by_user_type_id","last_replied_by_user_type","closed_on","closed_by","closed_by_name","created_on","created_by","creator","last_modified_on","last_modified_by","Last Modified By","is_spam","is_active","tsv","is_resolution_date_modified","last_status_changed_on","is_first_response_updated","ticket_type_option_id","ticket_category_option_id","ticket_priority_id","priority","subject","type","category","email","OpportunityOwner","unique_external_reference_id","agentid","isnotesprivate","notetype","assigned","cf_quote_line_items","cf_quote_number","cf_expiration_date","cf_order_form_for","cf_net_amount","cf_tax","cf_grand_total","cf_quote_name","cf_bq_email","cf_phone","cf_fax","cf_bq_status","contactname","Account Name","cf_bill_to_name","cf_ship_to_name","cf_bq_billing_street","cf_bq_billing_city","cf_bq_billing_state","cf_bq_billing_country","cf_bq_billing_postal_code","cf_bq_shipping_street","cf_bq_shipping_city","cf_bq_shipping_state","cf_shipping_country","cf_shipping_postal_code","cf_external_reference_id","cf_email_subject")
select * from get_related_beta_quote_ticket_detail(
	array_to_string(newids,',')
)
ON CONFLICT ("parentid","id") 
DO 
   UPDATE SET "parentid"=EXCLUDED.parentid ,"id"=EXCLUDED.id ,"org_id"=EXCLUDED.org_id,"brand_id"=EXCLUDED.brand_id ,"org_brand_id"=EXCLUDED.org_brand_id ,"brand_name"=EXCLUDED.brand_name ,"Opportunity Name"=EXCLUDED."Opportunity Name" ,"is_visible_in_customer_portal"=EXCLUDED.is_visible_in_customer_portal ,"requested_by"=EXCLUDED.requested_by ,"requester"=EXCLUDED.requester ,"assigned_to_user_id"=EXCLUDED.assigned_to_user_id ,"assignee"=EXCLUDED.assignee ,"AR Rep"=EXCLUDED."AR Rep" ,"assigned_to_group_id"=EXCLUDED.assigned_to_group_id ,"group"=EXCLUDED.group ,"contact_group_id"=EXCLUDED.contact_group_id ,"contact_group"=EXCLUDED.contact_group ,"resolution_due_on"=EXCLUDED.resolution_due_on ,"ticket_status_id"=EXCLUDED.ticket_status_id ,"status"=EXCLUDED.status ,"ticket_source_id"=EXCLUDED.ticket_source_id ,"source"=EXCLUDED.source ,"update_count"=EXCLUDED.update_count ,"note_count"=EXCLUDED.note_count ,"attachment_count"=EXCLUDED.attachment_count ,"work_log_count"=EXCLUDED.work_log_count ,"total_time_logged"=EXCLUDED.total_time_logged ,"total_billable_time_logged"=EXCLUDED.total_billable_time_logged ,"first_response_due_on"=EXCLUDED.first_response_due_on ,"next_response_due_on"=EXCLUDED.next_response_due_on ,"last_replied_on"=EXCLUDED.last_replied_on ,"last_replied_by_id"=EXCLUDED.last_replied_by_id ,"last_replied_by"=EXCLUDED.last_replied_by ,"last_replied_by_user_type_id"=EXCLUDED.last_replied_by_user_type_id ,"last_replied_by_user_type"=EXCLUDED.last_replied_by_user_type ,"closed_on"=EXCLUDED.closed_on ,"closed_by"=EXCLUDED.closed_by ,"closed_by_name"=EXCLUDED.closed_by_name ,"created_on"=EXCLUDED.created_on ,"created_by"=EXCLUDED.created_by ,"creator"=EXCLUDED.creator ,"last_modified_on"=EXCLUDED.last_modified_on ,"last_modified_by"=EXCLUDED.last_modified_by ,"Last Modified By"=EXCLUDED."Last Modified By" ,"is_spam"=EXCLUDED.is_spam ,"is_active"=EXCLUDED.is_active ,"tsv"=EXCLUDED.tsv ,"is_resolution_date_modified"=EXCLUDED.is_resolution_date_modified ,"last_status_changed_on"=EXCLUDED.last_status_changed_on ,"is_first_response_updated"=EXCLUDED.is_first_response_updated ,"ticket_type_option_id"=EXCLUDED.ticket_type_option_id ,"ticket_category_option_id"=EXCLUDED.ticket_category_option_id ,"ticket_priority_id"=EXCLUDED.ticket_priority_id ,"priority"=EXCLUDED.priority ,"subject"=EXCLUDED.subject ,"type"=EXCLUDED.type ,"category"=EXCLUDED.category ,"email"=EXCLUDED.email ,"OpportunityOwner"=EXCLUDED."OpportunityOwner" ,"unique_external_reference_id"=EXCLUDED.unique_external_reference_id ,"agentid"=EXCLUDED.agentid ,"isnotesprivate"=EXCLUDED.isnotesprivate ,"notetype"=EXCLUDED.notetype ,"assigned"=EXCLUDED.assigned ,"cf_quote_line_items"=EXCLUDED.cf_quote_line_items ,"cf_quote_number"=EXCLUDED.cf_quote_number ,"cf_expiration_date"=EXCLUDED.cf_expiration_date ,"cf_order_form_for"=EXCLUDED.cf_order_form_for ,"cf_net_amount"=EXCLUDED.cf_net_amount ,"cf_tax"=EXCLUDED.cf_tax ,"cf_grand_total"=EXCLUDED.cf_grand_total ,"cf_quote_name"=EXCLUDED.cf_quote_name ,"cf_bq_email"=EXCLUDED.cf_bq_email ,"cf_phone"=EXCLUDED.cf_phone ,"cf_fax"=EXCLUDED.cf_fax ,"cf_bq_status"=EXCLUDED.cf_bq_status ,"contactname"=EXCLUDED.contactname ,"Account Name"=EXCLUDED."Account Name" ,"cf_bill_to_name"=EXCLUDED.cf_bill_to_name ,"cf_ship_to_name"=EXCLUDED.cf_ship_to_name ,"cf_bq_billing_street"=EXCLUDED.cf_bq_billing_street ,"cf_bq_billing_city"=EXCLUDED.cf_bq_billing_city ,"cf_bq_billing_state"=EXCLUDED.cf_bq_billing_state ,"cf_bq_billing_country"=EXCLUDED.cf_bq_billing_country ,"cf_bq_billing_postal_code"=EXCLUDED.cf_bq_billing_postal_code ,"cf_bq_shipping_street"=EXCLUDED.cf_bq_shipping_street ,"cf_bq_shipping_city"=EXCLUDED.cf_bq_shipping_city ,"cf_bq_shipping_state"=EXCLUDED.cf_bq_shipping_state ,"cf_shipping_country"=EXCLUDED.cf_shipping_country ,"cf_shipping_postal_code"=EXCLUDED.cf_shipping_postal_code ,"cf_external_reference_id"=EXCLUDED.cf_external_reference_id ,"cf_email_subject"=EXCLUDED.cf_email_subject;
  ELSE  
    raise notice 'No New Records';
	END IF;
	  raise notice 'Completed time %', transaction_timestamp();
	RAISE INFO 'Records updated  : % in ticket_detail', reclen;

END


$BODY$;
ALTER PROCEDURE public.incremental_refresh_ticket_detail(character varying)
    OWNER TO bolddeskuser;
